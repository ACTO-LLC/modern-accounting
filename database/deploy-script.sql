/*
Deployment script for AccountingDB

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "AccountingDB"
:setvar DefaultFilePrefix "AccountingDB"
:setvar DefaultDataPath ""
:setvar DefaultLogPath ""

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
/* Please run the below section of statements against the database name that the above [$(DatabaseName)] variable is assigned to. */
IF EXISTS (SELECT 1
           FROM   [sys].[databases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ANSI_NULLS ON,
                ANSI_PADDING ON,
                ANSI_WARNINGS ON,
                ARITHABORT ON,
                CONCAT_NULL_YIELDS_NULL ON,
                QUOTED_IDENTIFIER ON,
                ANSI_NULL_DEFAULT ON 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [sys].[databases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ALLOW_SNAPSHOT_ISOLATION OFF;
    END


GO
IF EXISTS (SELECT 1
           FROM   [sys].[databases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET CHANGE_TRACKING = OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [sys].[databases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET QUERY_STORE (QUERY_CAPTURE_MODE = ALL, CLEANUP_POLICY = (STALE_QUERY_THRESHOLD_DAYS = 367)) 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [sys].[databases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE SCOPED CONFIGURATION SET MAXDOP = 0;
    END


GO
IF EXISTS (SELECT 1
           FROM   [sys].[databases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET TEMPORAL_HISTORY_RETENTION OFF 
            WITH ROLLBACK IMMEDIATE;
    END


GO
PRINT N'Dropping Trigger [dbo].[TR_JournalEntryLines_EnforceBalance]...';


GO
DROP TRIGGER [dbo].[TR_JournalEntryLines_EnforceBalance];


GO
PRINT N'Dropping Index [dbo].[PlaidConnections].[IX_PlaidConnections_SyncStatus]...';


GO
DROP INDEX [IX_PlaidConnections_SyncStatus]
    ON [dbo].[PlaidConnections];


GO
PRINT N'Dropping Index [dbo].[PlaidConnections].[IX_PlaidConnections_Active]...';


GO
DROP INDEX [IX_PlaidConnections_Active]
    ON [dbo].[PlaidConnections];


GO
PRINT N'Dropping Index [dbo].[QBOConnections].[IX_QBOConnections_Active]...';


GO
DROP INDEX [IX_QBOConnections_Active]
    ON [dbo].[QBOConnections];


GO
PRINT N'Dropping Index [dbo].[VendorCredits].[IX_VendorCredits_Status]...';


GO
DROP INDEX [IX_VendorCredits_Status]
    ON [dbo].[VendorCredits];


GO
PRINT N'Dropping Index [dbo].[Accounts].[IX_Accounts_TenantId]...';


GO
DROP INDEX [IX_Accounts_TenantId]
    ON [dbo].[Accounts];


GO
PRINT N'Dropping Index [dbo].[BankTransactions].[IX_BankTransactions_BankTransactionId]...';


GO
DROP INDEX [IX_BankTransactions_BankTransactionId]
    ON [dbo].[BankTransactions];


GO
PRINT N'Dropping Index [dbo].[BankTransactions].[IX_BankTransactions_ImportId]...';


GO
DROP INDEX [IX_BankTransactions_ImportId]
    ON [dbo].[BankTransactions];


GO
PRINT N'Dropping Index [dbo].[Customers].[IX_Customers_TenantId]...';


GO
DROP INDEX [IX_Customers_TenantId]
    ON [dbo].[Customers];


GO
PRINT N'Dropping Index [dbo].[EmailReminderSettings].[IX_EmailReminderSettings_Active]...';


GO
DROP INDEX [IX_EmailReminderSettings_Active]
    ON [dbo].[EmailReminderSettings];


GO
PRINT N'Dropping Index [dbo].[EmailTemplates].[IX_EmailTemplates_Type_Default]...';


GO
DROP INDEX [IX_EmailTemplates_Type_Default]
    ON [dbo].[EmailTemplates];


GO
PRINT N'Dropping Index [dbo].[Vendors].[IX_Vendors_TenantId]...';


GO
DROP INDEX [IX_Vendors_TenantId]
    ON [dbo].[Vendors];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Accounts]...';


GO
ALTER TABLE [dbo].[Accounts] DROP CONSTRAINT [DF__Accounts__Create__72C60C4A];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Accounts]...';


GO
ALTER TABLE [dbo].[Accounts] DROP CONSTRAINT [DF__Accounts__IsActi__71D1E811];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Accounts]...';


GO
ALTER TABLE [dbo].[Accounts] DROP CONSTRAINT [DF__Accounts__Update__73BA3083];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Accounts]...';


GO
ALTER TABLE [dbo].[Accounts] DROP CONSTRAINT [DF__Accounts__Id__70DDC3D8];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Bills]...';


GO
ALTER TABLE [dbo].[Bills] DROP CONSTRAINT [DF__Bills__AmountPai__57DD0BE4];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Bills]...';


GO
ALTER TABLE [dbo].[Bills] DROP CONSTRAINT [DF__Bills__UpdatedAt__5AB9788F];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Bills]...';


GO
ALTER TABLE [dbo].[Bills] DROP CONSTRAINT [DF__Bills__CreatedAt__59C55456];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Bills]...';


GO
ALTER TABLE [dbo].[Bills] DROP CONSTRAINT [DF__Bills__TotalAmou__56E8E7AB];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Bills]...';


GO
ALTER TABLE [dbo].[Bills] DROP CONSTRAINT [DF__Bills__Status__58D1301D];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Bills]...';


GO
ALTER TABLE [dbo].[Bills] DROP CONSTRAINT [DF__Bills__Id__55F4C372];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Customers]...';


GO
ALTER TABLE [dbo].[Customers] DROP CONSTRAINT [DF__Customers__Updat__797309D9];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Customers]...';


GO
ALTER TABLE [dbo].[Customers] DROP CONSTRAINT [DF__Customers__Creat__787EE5A0];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Customers]...';


GO
ALTER TABLE [dbo].[Customers] DROP CONSTRAINT [DF__Customers__Count__7A672E12];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Customers]...';


GO
ALTER TABLE [dbo].[Customers] DROP CONSTRAINT [DF__Customers__Id__778AC167];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Employees]...';


GO
ALTER TABLE [dbo].[Employees] DROP CONSTRAINT [DF__Employees__BankV__190BB0C3];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Employees]...';


GO
ALTER TABLE [dbo].[Employees] DROP CONSTRAINT [DF__Employees__State__7BB05806];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Employees]...';


GO
ALTER TABLE [dbo].[Employees] DROP CONSTRAINT [DF__Employees__Id__76EBA2E9];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Employees]...';


GO
ALTER TABLE [dbo].[Employees] DROP CONSTRAINT [DF__Employees__Feder__7ABC33CD];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Employees]...';


GO
ALTER TABLE [dbo].[Employees] DROP CONSTRAINT [DF__Employees__Updat__7E8CC4B1];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Employees]...';


GO
ALTER TABLE [dbo].[Employees] DROP CONSTRAINT [DF__Employees__Creat__7D98A078];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Employees]...';


GO
ALTER TABLE [dbo].[Employees] DROP CONSTRAINT [DF__Employees__Statu__7CA47C3F];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Employees]...';


GO
ALTER TABLE [dbo].[Employees] DROP CONSTRAINT [DF__Employees__Feder__79C80F94];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Employees]...';


GO
ALTER TABLE [dbo].[Employees] DROP CONSTRAINT [DF__Employees__PayFr__78D3EB5B];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Employees]...';


GO
ALTER TABLE [dbo].[Employees] DROP CONSTRAINT [DF__Employees__PayTy__77DFC722];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Expenses]...';


GO
ALTER TABLE [dbo].[Expenses] DROP CONSTRAINT [DF__Expenses__Update__5A1A5A11];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Expenses]...';


GO
ALTER TABLE [dbo].[Expenses] DROP CONSTRAINT [DF__Expenses__Create__592635D8];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Expenses]...';


GO
ALTER TABLE [dbo].[Expenses] DROP CONSTRAINT [DF__Expenses__IsReim__573DED66];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Expenses]...';


GO
ALTER TABLE [dbo].[Expenses] DROP CONSTRAINT [DF__Expenses__Id__5649C92D];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Expenses]...';


GO
ALTER TABLE [dbo].[Expenses] DROP CONSTRAINT [DF__Expenses__Status__5832119F];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Expenses]...';


GO
ALTER TABLE [dbo].[Expenses] DROP CONSTRAINT [DF__Expenses__IsPers__758D6A5C];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Expenses_History]...';


GO
ALTER TABLE [dbo].[Expenses_History] DROP CONSTRAINT [DF__Expenses___IsPer__76818E95];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[IndustryTemplates]...';


GO
ALTER TABLE [dbo].[IndustryTemplates] DROP CONSTRAINT [DF__IndustryT__Creat__3F9B6DFF];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[IndustryTemplates]...';


GO
ALTER TABLE [dbo].[IndustryTemplates] DROP CONSTRAINT [DF__IndustryTemp__Id__3CBF0154];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[IndustryTemplates]...';


GO
ALTER TABLE [dbo].[IndustryTemplates] DROP CONSTRAINT [DF__IndustryT__IsAct__3EA749C6];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[IndustryTemplates]...';


GO
ALTER TABLE [dbo].[IndustryTemplates] DROP CONSTRAINT [DF__IndustryT__Updat__408F9238];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[IndustryTemplates]...';


GO
ALTER TABLE [dbo].[IndustryTemplates] DROP CONSTRAINT [DF__IndustryT__SortO__3DB3258D];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[MileageTrips]...';


GO
ALTER TABLE [dbo].[MileageTrips] DROP CONSTRAINT [DF__MileageTr__Updat__2E06CDA9];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[MileageTrips]...';


GO
ALTER TABLE [dbo].[MileageTrips] DROP CONSTRAINT [DF__MileageTrips__Id__2A363CC5];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[MileageTrips]...';


GO
ALTER TABLE [dbo].[MileageTrips] DROP CONSTRAINT [DF__MileageTr__IsRou__2B2A60FE];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[MileageTrips]...';


GO
ALTER TABLE [dbo].[MileageTrips] DROP CONSTRAINT [DF__MileageTr__Statu__2C1E8537];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[MileageTrips]...';


GO
ALTER TABLE [dbo].[MileageTrips] DROP CONSTRAINT [DF__MileageTr__Creat__2D12A970];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Payments]...';


GO
ALTER TABLE [dbo].[Payments] DROP CONSTRAINT [DF__Payments__TotalA__1975C517];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Payments]...';


GO
ALTER TABLE [dbo].[Payments] DROP CONSTRAINT [DF__Payments__Status__1A69E950];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Payments]...';


GO
ALTER TABLE [dbo].[Payments] DROP CONSTRAINT [DF__Payments__Create__1B5E0D89];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Payments]...';


GO
ALTER TABLE [dbo].[Payments] DROP CONSTRAINT [DF__Payments__Id__1881A0DE];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Payments]...';


GO
ALTER TABLE [dbo].[Payments] DROP CONSTRAINT [DF__Payments__Update__1C5231C2];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[PlaidAccounts]...';


GO
ALTER TABLE [dbo].[PlaidAccounts] DROP CONSTRAINT [DF__PlaidAcco__Creat__3D7E1B63];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[PlaidAccounts]...';


GO
ALTER TABLE [dbo].[PlaidAccounts] DROP CONSTRAINT [DF__PlaidAcco__Curre__3B95D2F1];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[PlaidAccounts]...';


GO
ALTER TABLE [dbo].[PlaidAccounts] DROP CONSTRAINT [DF__PlaidAcco__IsAct__3C89F72A];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[PlaidAccounts]...';


GO
ALTER TABLE [dbo].[PlaidAccounts] DROP CONSTRAINT [DF__PlaidAcco__Updat__3E723F9C];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[PlaidConnections]...';


GO
ALTER TABLE [dbo].[PlaidConnections] DROP CONSTRAINT [DF__PlaidConn__Creat__36D11DD4];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[PlaidConnections]...';


GO
ALTER TABLE [dbo].[PlaidConnections] DROP CONSTRAINT [DF__PlaidConn__IsAct__35DCF99B];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[PlaidConnections]...';


GO
ALTER TABLE [dbo].[PlaidConnections] DROP CONSTRAINT [DF__PlaidConn__SyncS__34E8D562];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[PlaidConnections]...';


GO
ALTER TABLE [dbo].[PlaidConnections] DROP CONSTRAINT [DF__PlaidConn__Updat__37C5420D];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[ProductsServices]...';


GO
ALTER TABLE [dbo].[ProductsServices] DROP CONSTRAINT [DF__ProductsS__Statu__04CFADEC];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[ProductsServices]...';


GO
ALTER TABLE [dbo].[ProductsServices] DROP CONSTRAINT [DF__ProductsS__Inven__07AC1A97];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[ProductsServices]...';


GO
ALTER TABLE [dbo].[ProductsServices] DROP CONSTRAINT [DF__ProductsS__Taxab__03DB89B3];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[ProductsServices]...';


GO
ALTER TABLE [dbo].[ProductsServices] DROP CONSTRAINT [DF__ProductsS__Quant__06B7F65E];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[ProductsServices]...';


GO
ALTER TABLE [dbo].[ProductsServices] DROP CONSTRAINT [DF__ProductsServ__Id__02E7657A];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[ProductsServices]...';


GO
ALTER TABLE [dbo].[ProductsServices] DROP CONSTRAINT [DF__ProductsS__Creat__05C3D225];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[QBOConnections]...';


GO
ALTER TABLE [dbo].[QBOConnections] DROP CONSTRAINT [DF__QBOConnec__Creat__14B10FFA];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[QBOConnections]...';


GO
ALTER TABLE [dbo].[QBOConnections] DROP CONSTRAINT [DF__QBOConnec__Envir__12C8C788];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[QBOConnections]...';


GO
ALTER TABLE [dbo].[QBOConnections] DROP CONSTRAINT [DF__QBOConnec__IsAct__13BCEBC1];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[QBOConnections]...';


GO
ALTER TABLE [dbo].[QBOConnections] DROP CONSTRAINT [DF__QBOConnec__Updat__15A53433];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[SalesReceipts]...';


GO
ALTER TABLE [dbo].[SalesReceipts] DROP CONSTRAINT [DF__SalesRece__Subto__5DB5E0CB];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[SalesReceipts]...';


GO
ALTER TABLE [dbo].[SalesReceipts] DROP CONSTRAINT [DF__SalesRece__Total__5F9E293D];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[SalesReceipts]...';


GO
ALTER TABLE [dbo].[SalesReceipts] DROP CONSTRAINT [DF__SalesRece__TaxAm__5EAA0504];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[SalesReceipts]...';


GO
ALTER TABLE [dbo].[SalesReceipts] DROP CONSTRAINT [DF__SalesRece__Updat__627A95E8];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[SalesReceipts]...';


GO
ALTER TABLE [dbo].[SalesReceipts] DROP CONSTRAINT [DF__SalesRece__Creat__618671AF];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[SalesReceipts]...';


GO
ALTER TABLE [dbo].[SalesReceipts] DROP CONSTRAINT [DF__SalesReceipt__Id__5CC1BC92];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[SalesReceipts]...';


GO
ALTER TABLE [dbo].[SalesReceipts] DROP CONSTRAINT [DF__SalesRece__Statu__60924D76];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[TaxRates]...';


GO
ALTER TABLE [dbo].[TaxRates] DROP CONSTRAINT [DF__TaxRates__Bracke__297722B6];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[TaxRates]...';


GO
ALTER TABLE [dbo].[TaxRates] DROP CONSTRAINT [DF__TaxRates__FlatAm__2A6B46EF];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[TaxRates]...';


GO
ALTER TABLE [dbo].[TaxRates] DROP CONSTRAINT [DF__TaxRates__IsActi__2B5F6B28];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[TaxRates]...';


GO
ALTER TABLE [dbo].[TaxRates] DROP CONSTRAINT [DF__TaxRates__Create__2C538F61];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[TaxRates]...';


GO
ALTER TABLE [dbo].[TaxRates] DROP CONSTRAINT [DF__TaxRates__Update__2D47B39A];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[TaxRates]...';


GO
ALTER TABLE [dbo].[TaxRates] DROP CONSTRAINT [DF__TaxRates__Id__2882FE7D];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[VendorCredits]...';


GO
ALTER TABLE [dbo].[VendorCredits] DROP CONSTRAINT [DF__VendorCre__Amoun__3A6CA48E];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[VendorCredits]...';


GO
ALTER TABLE [dbo].[VendorCredits] DROP CONSTRAINT [DF__VendorCre__Creat__3C54ED00];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[VendorCredits]...';


GO
ALTER TABLE [dbo].[VendorCredits] DROP CONSTRAINT [DF__VendorCre__Statu__3B60C8C7];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[VendorCredits]...';


GO
ALTER TABLE [dbo].[VendorCredits] DROP CONSTRAINT [DF__VendorCre__TaxAm__38845C1C];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[VendorCredits]...';


GO
ALTER TABLE [dbo].[VendorCredits] DROP CONSTRAINT [DF__VendorCre__Updat__3D491139];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Vendors]...';


GO
ALTER TABLE [dbo].[Vendors] DROP CONSTRAINT [DF__Vendors__Status__01142BA1];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Vendors]...';


GO
ALTER TABLE [dbo].[Vendors] DROP CONSTRAINT [DF__Vendors__Created__02084FDA];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Vendors]...';


GO
ALTER TABLE [dbo].[Vendors] DROP CONSTRAINT [DF__Vendors__Is1099V__00200768];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Vendors]...';


GO
ALTER TABLE [dbo].[Vendors] DROP CONSTRAINT [DF__Vendors__Updated__02FC7413];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Vendors]...';


GO
ALTER TABLE [dbo].[Vendors] DROP CONSTRAINT [DF__Vendors__Country__03F0984C];


GO
PRINT N'Dropping Default Constraint unnamed constraint on [dbo].[Vendors]...';


GO
ALTER TABLE [dbo].[Vendors] DROP CONSTRAINT [DF__Vendors__Id__7F2BE32F];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_ProductsServices_InventoryAssetAccount]...';


GO
ALTER TABLE [dbo].[ProductsServices] DROP CONSTRAINT [FK_ProductsServices_InventoryAssetAccount];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_Refunds_PaymentAccount]...';


GO
ALTER TABLE [dbo].[Refunds] DROP CONSTRAINT [FK_Refunds_PaymentAccount];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_Vendors_DefaultExpenseAccount]...';


GO
ALTER TABLE [dbo].[Vendors] DROP CONSTRAINT [FK_Vendors_DefaultExpenseAccount];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_BankTransactions_SourceAccount]...';


GO
ALTER TABLE [dbo].[BankTransactions] DROP CONSTRAINT [FK_BankTransactions_SourceAccount];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_Expenses_Accounts]...';


GO
ALTER TABLE [dbo].[Expenses] DROP CONSTRAINT [FK_Expenses_Accounts];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_BankRules_BankAccount]...';


GO
ALTER TABLE [dbo].[BankRules] DROP CONSTRAINT [FK_BankRules_BankAccount];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_VendorCreditLines_Accounts]...';


GO
ALTER TABLE [dbo].[VendorCreditLines] DROP CONSTRAINT [FK_VendorCreditLines_Accounts];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_Expenses_PaymentAccounts]...';


GO
ALTER TABLE [dbo].[Expenses] DROP CONSTRAINT [FK_Expenses_PaymentAccounts];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_BankRules_AssignAccount]...';


GO
ALTER TABLE [dbo].[BankRules] DROP CONSTRAINT [FK_BankRules_AssignAccount];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_JournalEntryLines_Accounts]...';


GO
ALTER TABLE [dbo].[JournalEntryLines] DROP CONSTRAINT [FK_JournalEntryLines_Accounts];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_SalesReceipts_DepositAccount]...';


GO
ALTER TABLE [dbo].[SalesReceipts] DROP CONSTRAINT [FK_SalesReceipts_DepositAccount];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_PlaidAccounts_LinkedAccount]...';


GO
ALTER TABLE [dbo].[PlaidAccounts] DROP CONSTRAINT [FK_PlaidAccounts_LinkedAccount];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_BankTransactions_SuggestedAccount]...';


GO
ALTER TABLE [dbo].[BankTransactions] DROP CONSTRAINT [FK_BankTransactions_SuggestedAccount];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_BankReconciliations_BankAccount]...';


GO
ALTER TABLE [dbo].[BankReconciliations] DROP CONSTRAINT [FK_BankReconciliations_BankAccount];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_Payments_Accounts]...';


GO
ALTER TABLE [dbo].[Payments] DROP CONSTRAINT [FK_Payments_Accounts];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_BillPayments_Accounts]...';


GO
ALTER TABLE [dbo].[BillPayments] DROP CONSTRAINT [FK_BillPayments_Accounts];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_CreditMemoLines_Accounts]...';


GO
ALTER TABLE [dbo].[CreditMemoLines] DROP CONSTRAINT [FK_CreditMemoLines_Accounts];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_AccountDefaults_Accounts]...';


GO
ALTER TABLE [dbo].[AccountDefaults] DROP CONSTRAINT [FK_AccountDefaults_Accounts];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_BillLines_Accounts]...';


GO
ALTER TABLE [dbo].[BillLines] DROP CONSTRAINT [FK_BillLines_Accounts];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_ProductsServices_IncomeAccount]...';


GO
ALTER TABLE [dbo].[ProductsServices] DROP CONSTRAINT [FK_ProductsServices_IncomeAccount];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_BankTransactions_ApprovedAccount]...';


GO
ALTER TABLE [dbo].[BankTransactions] DROP CONSTRAINT [FK_BankTransactions_ApprovedAccount];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_CustomerDeposits_DepositAccount]...';


GO
ALTER TABLE [dbo].[CustomerDeposits] DROP CONSTRAINT [FK_CustomerDeposits_DepositAccount];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_CustomerDeposits_LiabilityAccount]...';


GO
ALTER TABLE [dbo].[CustomerDeposits] DROP CONSTRAINT [FK_CustomerDeposits_LiabilityAccount];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_SalesReceiptLines_Accounts]...';


GO
ALTER TABLE [dbo].[SalesReceiptLines] DROP CONSTRAINT [FK_SalesReceiptLines_Accounts];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_ProductsServices_ExpenseAccount]...';


GO
ALTER TABLE [dbo].[ProductsServices] DROP CONSTRAINT [FK_ProductsServices_ExpenseAccount];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_InvoiceLines_RevenueAccount]...';


GO
ALTER TABLE [dbo].[InvoiceLines] DROP CONSTRAINT [FK_InvoiceLines_RevenueAccount];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_BankTransactionImports_Accounts]...';


GO
ALTER TABLE [dbo].[BankTransactionImports] DROP CONSTRAINT [FK_BankTransactionImports_Accounts];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_Bills_Vendors]...';


GO
ALTER TABLE [dbo].[Bills] DROP CONSTRAINT [FK_Bills_Vendors];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_PurchaseOrders_Bills]...';


GO
ALTER TABLE [dbo].[PurchaseOrders] DROP CONSTRAINT [FK_PurchaseOrders_Bills];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_BillLines_Bills]...';


GO
ALTER TABLE [dbo].[BillLines] DROP CONSTRAINT [FK_BillLines_Bills];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_BillPaymentApplications_Bills]...';


GO
ALTER TABLE [dbo].[BillPaymentApplications] DROP CONSTRAINT [FK_BillPaymentApplications_Bills];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_VendorCreditApplications_Bills]...';


GO
ALTER TABLE [dbo].[VendorCreditApplications] DROP CONSTRAINT [FK_VendorCreditApplications_Bills];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_MileageTrips_Customers]...';


GO
ALTER TABLE [dbo].[MileageTrips] DROP CONSTRAINT [FK_MileageTrips_Customers];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_Invoices_Customers]...';


GO
ALTER TABLE [dbo].[Invoices] DROP CONSTRAINT [FK_Invoices_Customers];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_Estimates_Customers]...';


GO
ALTER TABLE [dbo].[Estimates] DROP CONSTRAINT [FK_Estimates_Customers];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_SalesReceipts_Customers]...';


GO
ALTER TABLE [dbo].[SalesReceipts] DROP CONSTRAINT [FK_SalesReceipts_Customers];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_CreditMemos_Customers]...';


GO
ALTER TABLE [dbo].[CreditMemos] DROP CONSTRAINT [FK_CreditMemos_Customers];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_Payments_Customers]...';


GO
ALTER TABLE [dbo].[Payments] DROP CONSTRAINT [FK_Payments_Customers];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_Expenses_Customers]...';


GO
ALTER TABLE [dbo].[Expenses] DROP CONSTRAINT [FK_Expenses_Customers];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_BankRules_AssignCustomer]...';


GO
ALTER TABLE [dbo].[BankRules] DROP CONSTRAINT [FK_BankRules_AssignCustomer];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_CustomerDeposits_Customers]...';


GO
ALTER TABLE [dbo].[CustomerDeposits] DROP CONSTRAINT [FK_CustomerDeposits_Customers];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_TimeEntries_Customers]...';


GO
ALTER TABLE [dbo].[TimeEntries] DROP CONSTRAINT [FK_TimeEntries_Customers];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_Projects_Customers]...';


GO
ALTER TABLE [dbo].[Projects] DROP CONSTRAINT [FK_Projects_Customers];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_Refunds_Customers]...';


GO
ALTER TABLE [dbo].[Refunds] DROP CONSTRAINT [FK_Refunds_Customers];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_EmployeeWorkStates_Employee]...';


GO
ALTER TABLE [dbo].[EmployeeWorkStates] DROP CONSTRAINT [FK_EmployeeWorkStates_Employee];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_PayStubs_Employee]...';


GO
ALTER TABLE [dbo].[PayStubs] DROP CONSTRAINT [FK_PayStubs_Employee];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_Receipts_Expenses]...';


GO
ALTER TABLE [dbo].[Receipts] DROP CONSTRAINT [FK_Receipts_Expenses];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_Expenses_Projects]...';


GO
ALTER TABLE [dbo].[Expenses] DROP CONSTRAINT [FK_Expenses_Projects];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_Expenses_Classes]...';


GO
ALTER TABLE [dbo].[Expenses] DROP CONSTRAINT [FK_Expenses_Classes];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_Expenses_BankTransactions]...';


GO
ALTER TABLE [dbo].[Expenses] DROP CONSTRAINT [FK_Expenses_BankTransactions];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_Expenses_JournalEntries]...';


GO
ALTER TABLE [dbo].[Expenses] DROP CONSTRAINT [FK_Expenses_JournalEntries];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_Expenses_Vendors]...';


GO
ALTER TABLE [dbo].[Expenses] DROP CONSTRAINT [FK_Expenses_Vendors];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_MileageTrips_Projects]...';


GO
ALTER TABLE [dbo].[MileageTrips] DROP CONSTRAINT [FK_MileageTrips_Projects];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_MileageTrips_Vehicles]...';


GO
ALTER TABLE [dbo].[MileageTrips] DROP CONSTRAINT [FK_MileageTrips_Vehicles];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_BankTransactions_MatchedPayment]...';


GO
ALTER TABLE [dbo].[BankTransactions] DROP CONSTRAINT [FK_BankTransactions_MatchedPayment];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_PaymentApplications_Payments]...';


GO
ALTER TABLE [dbo].[PaymentApplications] DROP CONSTRAINT [FK_PaymentApplications_Payments];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_InventoryTransactions_Product]...';


GO
ALTER TABLE [dbo].[InventoryTransactions] DROP CONSTRAINT [FK_InventoryTransactions_Product];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_PurchaseOrderLines_ProductsServices]...';


GO
ALTER TABLE [dbo].[PurchaseOrderLines] DROP CONSTRAINT [FK_PurchaseOrderLines_ProductsServices];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_ProductsServices_DefaultLocation]...';


GO
ALTER TABLE [dbo].[ProductsServices] DROP CONSTRAINT [FK_ProductsServices_DefaultLocation];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_VendorCreditLines_ProductsServices]...';


GO
ALTER TABLE [dbo].[VendorCreditLines] DROP CONSTRAINT [FK_VendorCreditLines_ProductsServices];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_EstimateLines_ProductsServices]...';


GO
ALTER TABLE [dbo].[EstimateLines] DROP CONSTRAINT [FK_EstimateLines_ProductsServices];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_CreditMemoLines_ProductsServices]...';


GO
ALTER TABLE [dbo].[CreditMemoLines] DROP CONSTRAINT [FK_CreditMemoLines_ProductsServices];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_SalesReceiptLines_ProductsServices]...';


GO
ALTER TABLE [dbo].[SalesReceiptLines] DROP CONSTRAINT [FK_SalesReceiptLines_ProductsServices];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_InvoiceLines_ProductsServices]...';


GO
ALTER TABLE [dbo].[InvoiceLines] DROP CONSTRAINT [FK_InvoiceLines_ProductsServices];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_SalesReceiptLines_SalesReceipts]...';


GO
ALTER TABLE [dbo].[SalesReceiptLines] DROP CONSTRAINT [FK_SalesReceiptLines_SalesReceipts];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_SalesReceipts_TaxRates]...';


GO
ALTER TABLE [dbo].[SalesReceipts] DROP CONSTRAINT [FK_SalesReceipts_TaxRates];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_SalesReceipts_JournalEntries]...';


GO
ALTER TABLE [dbo].[SalesReceipts] DROP CONSTRAINT [FK_SalesReceipts_JournalEntries];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_SalesReceipts_Classes]...';


GO
ALTER TABLE [dbo].[SalesReceipts] DROP CONSTRAINT [FK_SalesReceipts_Classes];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_SalesReceipts_Locations]...';


GO
ALTER TABLE [dbo].[SalesReceipts] DROP CONSTRAINT [FK_SalesReceipts_Locations];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_SalesReceiptLines_TaxRates]...';


GO
ALTER TABLE [dbo].[SalesReceiptLines] DROP CONSTRAINT [FK_SalesReceiptLines_TaxRates];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_Invoices_TaxRates]...';


GO
ALTER TABLE [dbo].[Invoices] DROP CONSTRAINT [FK_Invoices_TaxRates];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_TaxCalcSettings_TaxRates]...';


GO
ALTER TABLE [dbo].[TaxCalculationSettings] DROP CONSTRAINT [FK_TaxCalcSettings_TaxRates];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_VendorCredits_Vendors]...';


GO
ALTER TABLE [dbo].[VendorCredits] DROP CONSTRAINT [FK_VendorCredits_Vendors];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_PurchaseOrders_Vendors]...';


GO
ALTER TABLE [dbo].[PurchaseOrders] DROP CONSTRAINT [FK_PurchaseOrders_Vendors];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_BankRules_AssignVendor]...';


GO
ALTER TABLE [dbo].[BankRules] DROP CONSTRAINT [FK_BankRules_AssignVendor];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_BillPayments_Vendors]...';


GO
ALTER TABLE [dbo].[BillPayments] DROP CONSTRAINT [FK_BillPayments_Vendors];


GO
PRINT N'Dropping Foreign Key [dbo].[FK_BankTransactions_Import]...';


GO
ALTER TABLE [dbo].[BankTransactions] DROP CONSTRAINT [FK_BankTransactions_Import];


GO
PRINT N'Dropping Foreign Key unnamed constraint on [dbo].[EmailReminderSettings]...';


GO
ALTER TABLE [dbo].[EmailReminderSettings] DROP CONSTRAINT [FK__EmailRemi__Templ__542C7691];


GO
PRINT N'Dropping Foreign Key unnamed constraint on [dbo].[SubmissionAttachments]...';


GO
ALTER TABLE [dbo].[SubmissionAttachments] DROP CONSTRAINT [FK__Submissio__Submi__6319B466];


GO
PRINT N'Dropping Unique Constraint unnamed constraint on [dbo].[PlaidConnections]...';


GO
ALTER TABLE [dbo].[PlaidConnections] DROP CONSTRAINT [UQ__PlaidCon__727E838A80C6035E];


GO
PRINT N'Dropping Unique Constraint unnamed constraint on [dbo].[QBOConnections]...';


GO
ALTER TABLE [dbo].[QBOConnections] DROP CONSTRAINT [UQ__QBOConne__E377A15B6D7D2447];


GO
PRINT N'Dropping Check Constraint [dbo].[CK_ProductsServices_Status]...';


GO
ALTER TABLE [dbo].[ProductsServices] DROP CONSTRAINT [CK_ProductsServices_Status];


GO
PRINT N'Dropping Check Constraint [dbo].[CK_ProductsServices_Type]...';


GO
ALTER TABLE [dbo].[ProductsServices] DROP CONSTRAINT [CK_ProductsServices_Type];


GO
PRINT N'Dropping Check Constraint [dbo].[CK_ProductsServices_ValuationMethod]...';


GO
ALTER TABLE [dbo].[ProductsServices] DROP CONSTRAINT [CK_ProductsServices_ValuationMethod];


GO
PRINT N'Dropping Check Constraint [dbo].[CK_VendorCredits_Status]...';


GO
ALTER TABLE [dbo].[VendorCredits] DROP CONSTRAINT [CK_VendorCredits_Status];


GO
PRINT N'Dropping Check Constraint [dbo].[CK_AuditLog_Action]...';


GO
ALTER TABLE [dbo].[AuditLog] DROP CONSTRAINT [CK_AuditLog_Action];


GO
PRINT N'Dropping Check Constraint [dbo].[CK_BankRules_MatchField]...';


GO
ALTER TABLE [dbo].[BankRules] DROP CONSTRAINT [CK_BankRules_MatchField];


GO
PRINT N'Dropping Check Constraint [dbo].[CK_BankRules_MatchType]...';


GO
ALTER TABLE [dbo].[BankRules] DROP CONSTRAINT [CK_BankRules_MatchType];


GO
PRINT N'Dropping Check Constraint [dbo].[CK_BankRules_TransactionType]...';


GO
ALTER TABLE [dbo].[BankRules] DROP CONSTRAINT [CK_BankRules_TransactionType];


GO
PRINT N'Dropping Check Constraint [dbo].[CK_CreditMemos_Status]...';


GO
ALTER TABLE [dbo].[CreditMemos] DROP CONSTRAINT [CK_CreditMemos_Status];


GO
PRINT N'Dropping Check Constraint [dbo].[CK_CustomerDeposits_Status]...';


GO
ALTER TABLE [dbo].[CustomerDeposits] DROP CONSTRAINT [CK_CustomerDeposits_Status];


GO
PRINT N'Dropping Check Constraint [dbo].[CK_InventoryLocations_Status]...';


GO
ALTER TABLE [dbo].[InventoryLocations] DROP CONSTRAINT [CK_InventoryLocations_Status];


GO
PRINT N'Dropping Check Constraint [dbo].[CK_InventoryTransactions_TransactionType]...';


GO
ALTER TABLE [dbo].[InventoryTransactions] DROP CONSTRAINT [CK_InventoryTransactions_TransactionType];


GO
PRINT N'Dropping Check Constraint [dbo].[CHK_RecurringSchedules_Status]...';


GO
ALTER TABLE [dbo].[RecurringSchedules] DROP CONSTRAINT [CHK_RecurringSchedules_Status];


GO
PRINT N'Dropping Check Constraint [dbo].[CHK_RecurringSchedules_TransactionType]...';


GO
ALTER TABLE [dbo].[RecurringSchedules] DROP CONSTRAINT [CHK_RecurringSchedules_TransactionType];


GO
PRINT N'Dropping Check Constraint [dbo].[CHK_RecurringTemplates_Frequency]...';


GO
ALTER TABLE [dbo].[RecurringTemplates] DROP CONSTRAINT [CHK_RecurringTemplates_Frequency];


GO
PRINT N'Dropping Check Constraint [dbo].[CHK_RecurringTemplates_Status]...';


GO
ALTER TABLE [dbo].[RecurringTemplates] DROP CONSTRAINT [CHK_RecurringTemplates_Status];


GO
PRINT N'Dropping Check Constraint [dbo].[CHK_RecurringTemplates_TransactionType]...';


GO
ALTER TABLE [dbo].[RecurringTemplates] DROP CONSTRAINT [CHK_RecurringTemplates_TransactionType];


GO
PRINT N'Dropping Check Constraint [dbo].[CK_Refunds_Status]...';


GO
ALTER TABLE [dbo].[Refunds] DROP CONSTRAINT [CK_Refunds_Status];


GO
PRINT N'Dropping Check Constraint [dbo].[CK_TaxCalcSettings_Method]...';


GO
ALTER TABLE [dbo].[TaxCalculationSettings] DROP CONSTRAINT [CK_TaxCalcSettings_Method];


GO
PRINT N'Dropping Check Constraint [dbo].[CK_Tenants_SubscriptionTier]...';


GO
ALTER TABLE [dbo].[Tenants] DROP CONSTRAINT [CK_Tenants_SubscriptionTier];


GO
PRINT N'Dropping Check Constraint [dbo].[CK_Users_AuthProvider]...';


GO
ALTER TABLE [dbo].[Users] DROP CONSTRAINT [CK_Users_AuthProvider];


GO
PRINT N'Dropping Check Constraint unnamed constraint on [dbo].[Deployments]...';


GO
ALTER TABLE [dbo].[Deployments] DROP CONSTRAINT [CK__Deploymen__Statu__4EDDB18F];


GO
PRINT N'Dropping Check Constraint unnamed constraint on [dbo].[Enhancements]...';


GO
ALTER TABLE [dbo].[Enhancements] DROP CONSTRAINT [CK__Enhanceme__Statu__4A18FC72];


GO
PRINT N'Dropping Check Constraint [dbo].[CK_JournalEntryLines_DebitCreditExclusivity]...';


GO
ALTER TABLE [dbo].[JournalEntryLines] DROP CONSTRAINT [CK_JournalEntryLines_DebitCreditExclusivity];


GO
PRINT N'Dropping Check Constraint unnamed constraint on [dbo].[Submissions]...';


GO
ALTER TABLE [dbo].[Submissions] DROP CONSTRAINT [CK__Submission__Type__59904A2C];


GO
PRINT N'Dropping Check Constraint unnamed constraint on [dbo].[Submissions]...';


GO
ALTER TABLE [dbo].[Submissions] DROP CONSTRAINT [CK__Submissio__Statu__5D60DB10];


GO
PRINT N'Dropping Check Constraint unnamed constraint on [dbo].[Submissions]...';


GO
ALTER TABLE [dbo].[Submissions] DROP CONSTRAINT [CK__Submissio__Prior__5B78929E];


GO
PRINT N'Dropping system-versioning from [dbo].[Companies]...';


GO
IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'Companies'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[Companies] SET (SYSTEM_VERSIONING = OFF);
    END


GO
PRINT N'Dropping system-versioning from [dbo].[Accounts]...';


GO
IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'Accounts'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[Accounts] SET (SYSTEM_VERSIONING = OFF);
    END


GO
PRINT N'Dropping system-versioning from [dbo].[Bills]...';


GO
IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'Bills'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[Bills] SET (SYSTEM_VERSIONING = OFF);
    END


GO
PRINT N'Dropping system-versioning from [dbo].[Customers]...';


GO
IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'Customers'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[Customers] SET (SYSTEM_VERSIONING = OFF);
    END


GO
PRINT N'Dropping system-versioning from [dbo].[Expenses]...';


GO
IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'Expenses'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[Expenses] SET (SYSTEM_VERSIONING = OFF);
    END


GO
PRINT N'Dropping system-versioning from [dbo].[MileageTrips]...';


GO
IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'MileageTrips'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[MileageTrips] SET (SYSTEM_VERSIONING = OFF);
    END


GO
PRINT N'Dropping system-versioning from [dbo].[Payments]...';


GO
IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'Payments'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[Payments] SET (SYSTEM_VERSIONING = OFF);
    END


GO
PRINT N'Dropping system-versioning from [dbo].[ProductsServices]...';


GO
IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'ProductsServices'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[ProductsServices] SET (SYSTEM_VERSIONING = OFF);
    END


GO
PRINT N'Dropping system-versioning from [dbo].[SalesReceipts]...';


GO
IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'SalesReceipts'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[SalesReceipts] SET (SYSTEM_VERSIONING = OFF);
    END


GO
PRINT N'Dropping system-versioning from [dbo].[Vendors]...';


GO
IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'Vendors'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[Vendors] SET (SYSTEM_VERSIONING = OFF);
    END


GO
PRINT N'Starting rebuilding table [dbo].[Accounts_History]...';


GO
CREATE TABLE [dbo].[tmp_ms_xx_Accounts_History] (
    [Id]               UNIQUEIDENTIFIER NOT NULL,
    [Code]             NVARCHAR (50)    NOT NULL,
    [Name]             NVARCHAR (200)   NOT NULL,
    [Type]             NVARCHAR (50)    NOT NULL,
    [Subtype]          NVARCHAR (50)    NULL,
    [CashFlowCategory] NVARCHAR (50)    NULL,
    [AccountNumber]    NVARCHAR (50)    NULL,
    [Description]      NVARCHAR (MAX)   NULL,
    [IsActive]         BIT              NOT NULL,
    [CreatedAt]        DATETIME2 (7)    NOT NULL,
    [UpdatedAt]        DATETIME2 (7)    NOT NULL,
    [TenantId]         UNIQUEIDENTIFIER NULL,
    [SourceSystem]     NVARCHAR (50)    NULL,
    [SourceId]         NVARCHAR (100)   NULL,
    [ValidFrom]        DATETIME2 (7)    NOT NULL,
    [ValidTo]          DATETIME2 (7)    NOT NULL
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_ix_Accounts_History1]
    ON [dbo].[tmp_ms_xx_Accounts_History]([ValidTo] ASC, [ValidFrom] ASC);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Accounts_History])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_Accounts_History] ([ValidTo], [ValidFrom], [Id], [Code], [Name], [Type], [Subtype], [CashFlowCategory], [AccountNumber], [Description], [IsActive], [CreatedAt], [UpdatedAt], [TenantId], [SourceSystem], [SourceId])
        SELECT   [ValidTo],
                 [ValidFrom],
                 [Id],
                 [Code],
                 [Name],
                 [Type],
                 [Subtype],
                 [CashFlowCategory],
                 [AccountNumber],
                 [Description],
                 [IsActive],
                 [CreatedAt],
                 [UpdatedAt],
                 [TenantId],
                 [SourceSystem],
                 [SourceId]
        FROM     [dbo].[Accounts_History]
        ORDER BY [ValidTo] ASC, [ValidFrom] ASC;
    END

IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'Accounts'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[Accounts] SET (SYSTEM_VERSIONING = OFF);
    END

DROP TABLE [dbo].[Accounts_History];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Accounts_History]', N'Accounts_History';

EXECUTE sp_rename N'[dbo].[Accounts_History].[tmp_ms_xx_index_ix_Accounts_History1]', N'ix_Accounts_History', N'INDEX';


GO
PRINT N'Starting rebuilding table [dbo].[Bills_History]...';


GO
CREATE TABLE [dbo].[tmp_ms_xx_Bills_History] (
    [Id]             UNIQUEIDENTIFIER NOT NULL,
    [VendorId]       UNIQUEIDENTIFIER NOT NULL,
    [BillNumber]     NVARCHAR (50)    NULL,
    [BillDate]       DATE             NOT NULL,
    [DueDate]        DATE             NOT NULL,
    [TotalAmount]    DECIMAL (19, 4)  NOT NULL,
    [AmountPaid]     DECIMAL (19, 4)  NOT NULL,
    [Status]         NVARCHAR (20)    NOT NULL,
    [Terms]          NVARCHAR (50)    NULL,
    [Memo]           NVARCHAR (500)   NULL,
    [CreatedAt]      DATETIME2 (7)    NOT NULL,
    [UpdatedAt]      DATETIME2 (7)    NOT NULL,
    [TenantId]       UNIQUEIDENTIFIER NULL,
    [JournalEntryId] UNIQUEIDENTIFIER NULL,
    [PostedAt]       DATETIME2 (7)    NULL,
    [PostedBy]       NVARCHAR (100)   NULL,
    [SourceSystem]   NVARCHAR (50)    NULL,
    [SourceId]       NVARCHAR (100)   NULL,
    [ValidFrom]      DATETIME2 (7)    NOT NULL,
    [ValidTo]        DATETIME2 (7)    NOT NULL
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_ix_Bills_History1]
    ON [dbo].[tmp_ms_xx_Bills_History]([ValidTo] ASC, [ValidFrom] ASC);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Bills_History])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_Bills_History] ([ValidTo], [ValidFrom], [Id], [VendorId], [BillNumber], [BillDate], [DueDate], [TotalAmount], [AmountPaid], [Status], [Terms], [Memo], [CreatedAt], [UpdatedAt], [TenantId], [JournalEntryId], [PostedAt], [PostedBy], [SourceSystem], [SourceId])
        SELECT   [ValidTo],
                 [ValidFrom],
                 [Id],
                 [VendorId],
                 [BillNumber],
                 [BillDate],
                 [DueDate],
                 [TotalAmount],
                 [AmountPaid],
                 [Status],
                 [Terms],
                 [Memo],
                 [CreatedAt],
                 [UpdatedAt],
                 [TenantId],
                 [JournalEntryId],
                 [PostedAt],
                 [PostedBy],
                 [SourceSystem],
                 [SourceId]
        FROM     [dbo].[Bills_History]
        ORDER BY [ValidTo] ASC, [ValidFrom] ASC;
    END

IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'Bills'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[Bills] SET (SYSTEM_VERSIONING = OFF);
    END

DROP TABLE [dbo].[Bills_History];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Bills_History]', N'Bills_History';

EXECUTE sp_rename N'[dbo].[Bills_History].[tmp_ms_xx_index_ix_Bills_History1]', N'ix_Bills_History', N'INDEX';


GO
PRINT N'Altering Table [dbo].[Companies]...';


GO
ALTER TABLE [dbo].[Companies] DISABLE CHANGE_TRACKING;


GO
PRINT N'Starting rebuilding table [dbo].[Customers_History]...';


GO
CREATE TABLE [dbo].[tmp_ms_xx_Customers_History] (
    [Id]           UNIQUEIDENTIFIER NOT NULL,
    [Name]         NVARCHAR (100)   NOT NULL,
    [Email]        NVARCHAR (100)   NULL,
    [Phone]        NVARCHAR (20)    NULL,
    [Address]      NVARCHAR (200)   NULL,
    [CreatedAt]    DATETIME2 (7)    NOT NULL,
    [UpdatedAt]    DATETIME2 (7)    NOT NULL,
    [TenantId]     UNIQUEIDENTIFIER NULL,
    [AddressLine1] NVARCHAR (100)   NULL,
    [AddressLine2] NVARCHAR (100)   NULL,
    [City]         NVARCHAR (50)    NULL,
    [State]        NVARCHAR (50)    NULL,
    [PostalCode]   NVARCHAR (20)    NULL,
    [Country]      NVARCHAR (50)    NULL,
    [SourceSystem] NVARCHAR (50)    NULL,
    [SourceId]     NVARCHAR (100)   NULL,
    [ValidFrom]    DATETIME2 (7)    NOT NULL,
    [ValidTo]      DATETIME2 (7)    NOT NULL
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_ix_Customers_History1]
    ON [dbo].[tmp_ms_xx_Customers_History]([ValidTo] ASC, [ValidFrom] ASC);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Customers_History])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_Customers_History] ([ValidTo], [ValidFrom], [Id], [Name], [Email], [Phone], [Address], [CreatedAt], [UpdatedAt], [TenantId], [AddressLine1], [AddressLine2], [City], [State], [PostalCode], [Country], [SourceSystem], [SourceId])
        SELECT   [ValidTo],
                 [ValidFrom],
                 [Id],
                 [Name],
                 [Email],
                 [Phone],
                 [Address],
                 [CreatedAt],
                 [UpdatedAt],
                 [TenantId],
                 [AddressLine1],
                 [AddressLine2],
                 [City],
                 [State],
                 [PostalCode],
                 [Country],
                 [SourceSystem],
                 [SourceId]
        FROM     [dbo].[Customers_History]
        ORDER BY [ValidTo] ASC, [ValidFrom] ASC;
    END

IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'Customers'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[Customers] SET (SYSTEM_VERSIONING = OFF);
    END

DROP TABLE [dbo].[Customers_History];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Customers_History]', N'Customers_History';

EXECUTE sp_rename N'[dbo].[Customers_History].[tmp_ms_xx_index_ix_Customers_History1]', N'ix_Customers_History', N'INDEX';


GO
PRINT N'Starting rebuilding table [dbo].[Employees_History]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Employees_History] (
    [Id]                     UNIQUEIDENTIFIER NOT NULL,
    [EmployeeNumber]         NVARCHAR (20)    NOT NULL,
    [FirstName]              NVARCHAR (50)    NOT NULL,
    [LastName]               NVARCHAR (50)    NOT NULL,
    [Email]                  NVARCHAR (100)   NULL,
    [Phone]                  NVARCHAR (20)    NULL,
    [SSNLast4]               NVARCHAR (4)     NULL,
    [DateOfBirth]            DATE             NULL,
    [HireDate]               DATE             NOT NULL,
    [TerminationDate]        DATE             NULL,
    [PayType]                NVARCHAR (20)    NOT NULL,
    [PayRate]                DECIMAL (18, 2)  NOT NULL,
    [PayFrequency]           NVARCHAR (20)    NOT NULL,
    [FederalFilingStatus]    NVARCHAR (30)    NOT NULL,
    [FederalAllowances]      INT              NOT NULL,
    [StateCode]              NVARCHAR (2)     NULL,
    [StateFilingStatus]      NVARCHAR (30)    NULL,
    [StateAllowances]        INT              NOT NULL,
    [BankRoutingNumber]      NVARCHAR (9)     NULL,
    [BankAccountNumber]      NVARCHAR (50)    NULL,
    [BankAccountType]        NVARCHAR (20)    NULL,
    [Address]                NVARCHAR (200)   NULL,
    [City]                   NVARCHAR (100)   NULL,
    [State]                  NVARCHAR (2)     NULL,
    [ZipCode]                NVARCHAR (10)    NULL,
    [Status]                 NVARCHAR (20)    NOT NULL,
    [CreatedAt]              DATETIME2 (7)    NOT NULL,
    [UpdatedAt]              DATETIME2 (7)    NOT NULL,
    [PlaidItemId]            NVARCHAR (100)   NULL,
    [PlaidAccountId]         NVARCHAR (100)   NULL,
    [BankVerificationStatus] NVARCHAR (20)    NOT NULL,
    [BankVerifiedAt]         DATETIME2 (7)    NULL,
    [BankInstitutionName]    NVARCHAR (200)   NULL,
    [ValidFrom]              DATETIME2 (7)    NOT NULL,
    [ValidTo]                DATETIME2 (7)    NOT NULL
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_ix_Employees_History1]
    ON [dbo].[tmp_ms_xx_Employees_History]([ValidTo] ASC, [ValidFrom] ASC);

UPDATE [dbo].[Employees_History]
SET    [BankVerificationStatus] = N''
WHERE  [BankVerificationStatus] IS NULL;

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Employees_History])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_Employees_History] ([ValidTo], [ValidFrom], [Id], [EmployeeNumber], [FirstName], [LastName], [Email], [Phone], [SSNLast4], [DateOfBirth], [HireDate], [TerminationDate], [PayType], [PayRate], [PayFrequency], [FederalFilingStatus], [FederalAllowances], [StateCode], [StateFilingStatus], [StateAllowances], [BankRoutingNumber], [BankAccountNumber], [BankAccountType], [Address], [City], [State], [ZipCode], [Status], [CreatedAt], [UpdatedAt], [PlaidItemId], [PlaidAccountId], [BankVerificationStatus], [BankVerifiedAt], [BankInstitutionName])
        SELECT   [ValidTo],
                 [ValidFrom],
                 [Id],
                 [EmployeeNumber],
                 [FirstName],
                 [LastName],
                 [Email],
                 [Phone],
                 [SSNLast4],
                 [DateOfBirth],
                 [HireDate],
                 [TerminationDate],
                 [PayType],
                 [PayRate],
                 [PayFrequency],
                 [FederalFilingStatus],
                 [FederalAllowances],
                 [StateCode],
                 [StateFilingStatus],
                 [StateAllowances],
                 [BankRoutingNumber],
                 [BankAccountNumber],
                 [BankAccountType],
                 [Address],
                 [City],
                 [State],
                 [ZipCode],
                 [Status],
                 [CreatedAt],
                 [UpdatedAt],
                 [PlaidItemId],
                 [PlaidAccountId],
                 [BankVerificationStatus],
                 [BankVerifiedAt],
                 [BankInstitutionName]
        FROM     [dbo].[Employees_History]
        ORDER BY [ValidTo] ASC, [ValidFrom] ASC;
    END

DROP TABLE [dbo].[Employees_History];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Employees_History]', N'Employees_History';

EXECUTE sp_rename N'[dbo].[Employees_History].[tmp_ms_xx_index_ix_Employees_History1]', N'ix_Employees_History', N'INDEX';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Starting rebuilding table [dbo].[Expenses_History]...';


GO
CREATE TABLE [dbo].[tmp_ms_xx_Expenses_History] (
    [Id]                UNIQUEIDENTIFIER NOT NULL,
    [ExpenseNumber]     NVARCHAR (50)    NULL,
    [ExpenseDate]       DATE             NOT NULL,
    [VendorId]          UNIQUEIDENTIFIER NULL,
    [VendorName]        NVARCHAR (255)   NULL,
    [AccountId]         UNIQUEIDENTIFIER NOT NULL,
    [Amount]            DECIMAL (19, 4)  NOT NULL,
    [PaymentAccountId]  UNIQUEIDENTIFIER NULL,
    [PaymentMethod]     NVARCHAR (50)    NULL,
    [Description]       NVARCHAR (500)   NULL,
    [Reference]         NVARCHAR (100)   NULL,
    [IsReimbursable]    BIT              NOT NULL,
    [ReimbursedDate]    DATE             NULL,
    [CustomerId]        UNIQUEIDENTIFIER NULL,
    [ProjectId]         UNIQUEIDENTIFIER NULL,
    [ClassId]           UNIQUEIDENTIFIER NULL,
    [BankTransactionId] UNIQUEIDENTIFIER NULL,
    [Status]            NVARCHAR (20)    NOT NULL,
    [IsPersonal]        BIT              NOT NULL,
    [JournalEntryId]    UNIQUEIDENTIFIER NULL,
    [CreatedBy]         NVARCHAR (255)   NULL,
    [CreatedAt]         DATETIME2 (7)    NOT NULL,
    [UpdatedAt]         DATETIME2 (7)    NOT NULL,
    [ValidFrom]         DATETIME2 (7)    NOT NULL,
    [ValidTo]           DATETIME2 (7)    NOT NULL
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_ix_Expenses_History1]
    ON [dbo].[tmp_ms_xx_Expenses_History]([ValidTo] ASC, [ValidFrom] ASC);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Expenses_History])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_Expenses_History] ([ValidTo], [ValidFrom], [Id], [ExpenseNumber], [ExpenseDate], [VendorId], [VendorName], [AccountId], [Amount], [PaymentAccountId], [PaymentMethod], [Description], [Reference], [IsReimbursable], [ReimbursedDate], [CustomerId], [ProjectId], [ClassId], [BankTransactionId], [Status], [JournalEntryId], [CreatedBy], [CreatedAt], [UpdatedAt], [IsPersonal])
        SELECT   [ValidTo],
                 [ValidFrom],
                 [Id],
                 [ExpenseNumber],
                 [ExpenseDate],
                 [VendorId],
                 [VendorName],
                 [AccountId],
                 [Amount],
                 [PaymentAccountId],
                 [PaymentMethod],
                 [Description],
                 [Reference],
                 [IsReimbursable],
                 [ReimbursedDate],
                 [CustomerId],
                 [ProjectId],
                 [ClassId],
                 [BankTransactionId],
                 [Status],
                 [JournalEntryId],
                 [CreatedBy],
                 [CreatedAt],
                 [UpdatedAt],
                 [IsPersonal]
        FROM     [dbo].[Expenses_History]
        ORDER BY [ValidTo] ASC, [ValidFrom] ASC;
    END

IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'Expenses'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[Expenses] SET (SYSTEM_VERSIONING = OFF);
    END

DROP TABLE [dbo].[Expenses_History];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Expenses_History]', N'Expenses_History';

EXECUTE sp_rename N'[dbo].[Expenses_History].[tmp_ms_xx_index_ix_Expenses_History1]', N'ix_Expenses_History', N'INDEX';


GO
PRINT N'Starting rebuilding table [dbo].[IndustryTemplates]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_IndustryTemplates] (
    [Id]              UNIQUEIDENTIFIER DEFAULT NEWID() NOT NULL,
    [Code]            NVARCHAR (50)    NOT NULL,
    [Name]            NVARCHAR (200)   NOT NULL,
    [Description]     NVARCHAR (1000)  NULL,
    [Category]        NVARCHAR (100)   NULL,
    [COATemplate]     NVARCHAR (MAX)   NOT NULL,
    [DefaultSettings] NVARCHAR (MAX)   NULL,
    [FeatureFlags]    NVARCHAR (MAX)   NULL,
    [Keywords]        NVARCHAR (MAX)   NULL,
    [SortOrder]       INT              DEFAULT 0 NOT NULL,
    [IsActive]        BIT              DEFAULT 1 NOT NULL,
    [CreatedAt]       DATETIME2 (7)    DEFAULT SYSDATETIME() NOT NULL,
    [UpdatedAt]       DATETIME2 (7)    DEFAULT SYSDATETIME() NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UQ_IndustryTemplates_Code1] UNIQUE NONCLUSTERED ([Code] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[IndustryTemplates])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_IndustryTemplates] ([Id], [Code], [Name], [Description], [Category], [COATemplate], [DefaultSettings], [FeatureFlags], [SortOrder], [IsActive], [CreatedAt], [UpdatedAt], [Keywords])
        SELECT   [Id],
                 [Code],
                 [Name],
                 [Description],
                 [Category],
                 [COATemplate],
                 [DefaultSettings],
                 [FeatureFlags],
                 [SortOrder],
                 [IsActive],
                 [CreatedAt],
                 [UpdatedAt],
                 [Keywords]
        FROM     [dbo].[IndustryTemplates]
        ORDER BY [Id] ASC;
    END

DROP TABLE [dbo].[IndustryTemplates];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_IndustryTemplates]', N'IndustryTemplates';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UQ_IndustryTemplates_Code1]', N'UQ_IndustryTemplates_Code', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating Index [dbo].[IndustryTemplates].[IX_IndustryTemplates_Category]...';


GO
CREATE NONCLUSTERED INDEX [IX_IndustryTemplates_Category]
    ON [dbo].[IndustryTemplates]([Category] ASC);


GO
PRINT N'Creating Index [dbo].[IndustryTemplates].[IX_IndustryTemplates_IsActive]...';


GO
CREATE NONCLUSTERED INDEX [IX_IndustryTemplates_IsActive]
    ON [dbo].[IndustryTemplates]([IsActive] ASC) WHERE [IsActive] = 1;


GO
PRINT N'Starting rebuilding table [dbo].[MileageTrips_History]...';


GO
CREATE TABLE [dbo].[tmp_ms_xx_MileageTrips_History] (
    [Id]               UNIQUEIDENTIFIER NOT NULL,
    [VehicleId]        UNIQUEIDENTIFIER NULL,
    [TripDate]         DATE             NOT NULL,
    [StartLocation]    NVARCHAR (255)   NULL,
    [EndLocation]      NVARCHAR (255)   NULL,
    [StartOdometer]    INT              NULL,
    [EndOdometer]      INT              NULL,
    [Distance]         DECIMAL (10, 2)  NOT NULL,
    [Purpose]          NVARCHAR (500)   NULL,
    [Category]         NVARCHAR (20)    NOT NULL,
    [RatePerMile]      DECIMAL (6, 4)   NULL,
    [DeductibleAmount] DECIMAL (10, 2)  NULL,
    [CustomerId]       UNIQUEIDENTIFIER NULL,
    [ProjectId]        UNIQUEIDENTIFIER NULL,
    [Notes]            NVARCHAR (1000)  NULL,
    [IsRoundTrip]      BIT              NOT NULL,
    [Status]           NVARCHAR (20)    NOT NULL,
    [IsPersonal]       BIT              NOT NULL,
    [CreatedBy]        NVARCHAR (255)   NULL,
    [CreatedAt]        DATETIME2 (7)    NOT NULL,
    [UpdatedAt]        DATETIME2 (7)    NOT NULL,
    [ValidFrom]        DATETIME2 (7)    NOT NULL,
    [ValidTo]          DATETIME2 (7)    NOT NULL
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_ix_MileageTrips_History1]
    ON [dbo].[tmp_ms_xx_MileageTrips_History]([ValidTo] ASC, [ValidFrom] ASC);

ALTER TABLE [dbo].[tmp_ms_xx_MileageTrips_History]
    ADD CONSTRAINT [SD_MileageTrips_History_63eb442b9399419588b37be1abd947fd] DEFAULT 0 FOR [IsPersonal];

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[MileageTrips_History])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_MileageTrips_History] ([ValidTo], [ValidFrom], [Id], [VehicleId], [TripDate], [StartLocation], [EndLocation], [StartOdometer], [EndOdometer], [Distance], [Purpose], [Category], [RatePerMile], [DeductibleAmount], [CustomerId], [ProjectId], [Notes], [IsRoundTrip], [Status], [CreatedBy], [CreatedAt], [UpdatedAt])
        SELECT   [ValidTo],
                 [ValidFrom],
                 [Id],
                 [VehicleId],
                 [TripDate],
                 [StartLocation],
                 [EndLocation],
                 [StartOdometer],
                 [EndOdometer],
                 [Distance],
                 [Purpose],
                 [Category],
                 [RatePerMile],
                 [DeductibleAmount],
                 [CustomerId],
                 [ProjectId],
                 [Notes],
                 [IsRoundTrip],
                 [Status],
                 [CreatedBy],
                 [CreatedAt],
                 [UpdatedAt]
        FROM     [dbo].[MileageTrips_History]
        ORDER BY [ValidTo] ASC, [ValidFrom] ASC;
    END

ALTER TABLE [dbo].[tmp_ms_xx_MileageTrips_History] DROP CONSTRAINT [SD_MileageTrips_History_63eb442b9399419588b37be1abd947fd];

IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'MileageTrips'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[MileageTrips] SET (SYSTEM_VERSIONING = OFF);
    END

DROP TABLE [dbo].[MileageTrips_History];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_MileageTrips_History]', N'MileageTrips_History';

EXECUTE sp_rename N'[dbo].[MileageTrips_History].[tmp_ms_xx_index_ix_MileageTrips_History1]', N'ix_MileageTrips_History', N'INDEX';


GO
PRINT N'Starting rebuilding table [dbo].[Payments_History]...';


GO
CREATE TABLE [dbo].[tmp_ms_xx_Payments_History] (
    [Id]               UNIQUEIDENTIFIER NOT NULL,
    [PaymentNumber]    NVARCHAR (50)    NULL,
    [CustomerId]       UNIQUEIDENTIFIER NOT NULL,
    [PaymentDate]      DATE             NOT NULL,
    [TotalAmount]      DECIMAL (19, 4)  NOT NULL,
    [PaymentMethod]    NVARCHAR (50)    NULL,
    [DepositAccountId] UNIQUEIDENTIFIER NULL,
    [Memo]             NVARCHAR (500)   NULL,
    [Status]           NVARCHAR (20)    NOT NULL,
    [SourceSystem]     NVARCHAR (50)    NULL,
    [SourceId]         NVARCHAR (100)   NULL,
    [CreatedAt]        DATETIME2 (7)    NOT NULL,
    [UpdatedAt]        DATETIME2 (7)    NOT NULL,
    [JournalEntryId]   UNIQUEIDENTIFIER NULL,
    [ValidFrom]        DATETIME2 (7)    NOT NULL,
    [ValidTo]          DATETIME2 (7)    NOT NULL
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_ix_Payments_History1]
    ON [dbo].[tmp_ms_xx_Payments_History]([ValidTo] ASC, [ValidFrom] ASC);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Payments_History])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_Payments_History] ([ValidTo], [ValidFrom], [Id], [PaymentNumber], [CustomerId], [PaymentDate], [TotalAmount], [PaymentMethod], [DepositAccountId], [Memo], [Status], [SourceSystem], [SourceId], [CreatedAt], [UpdatedAt])
        SELECT   [ValidTo],
                 [ValidFrom],
                 [Id],
                 [PaymentNumber],
                 [CustomerId],
                 [PaymentDate],
                 [TotalAmount],
                 [PaymentMethod],
                 [DepositAccountId],
                 [Memo],
                 [Status],
                 [SourceSystem],
                 [SourceId],
                 [CreatedAt],
                 [UpdatedAt]
        FROM     [dbo].[Payments_History]
        ORDER BY [ValidTo] ASC, [ValidFrom] ASC;
    END

IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'Payments'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[Payments] SET (SYSTEM_VERSIONING = OFF);
    END

DROP TABLE [dbo].[Payments_History];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Payments_History]', N'Payments_History';

EXECUTE sp_rename N'[dbo].[Payments_History].[tmp_ms_xx_index_ix_Payments_History1]', N'ix_Payments_History', N'INDEX';


GO
PRINT N'Altering Table [dbo].[PlaidAccounts]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

UPDATE [dbo].[PlaidAccounts]
SET    [CreatedAt] = CONVERT(DateTime2, '')
WHERE  [CreatedAt] IS NULL;

ALTER TABLE [dbo].[PlaidAccounts] ALTER COLUMN [CreatedAt] DATETIME2 (7) NOT NULL;

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;

BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

UPDATE [dbo].[PlaidAccounts]
SET    [CurrencyCode] = N''
WHERE  [CurrencyCode] IS NULL;

ALTER TABLE [dbo].[PlaidAccounts] ALTER COLUMN [CurrencyCode] NVARCHAR (10) NOT NULL;

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;

BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

UPDATE [dbo].[PlaidAccounts]
SET    [IsActive] = 0
WHERE  [IsActive] IS NULL;

ALTER TABLE [dbo].[PlaidAccounts] ALTER COLUMN [IsActive] BIT NOT NULL;

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;

BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

UPDATE [dbo].[PlaidAccounts]
SET    [UpdatedAt] = CONVERT(DateTime2, '')
WHERE  [UpdatedAt] IS NULL;

ALTER TABLE [dbo].[PlaidAccounts] ALTER COLUMN [UpdatedAt] DATETIME2 (7) NOT NULL;

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Altering Table [dbo].[PlaidConnections]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

UPDATE [dbo].[PlaidConnections]
SET    [CreatedAt] = CONVERT(DateTime2, '')
WHERE  [CreatedAt] IS NULL;

ALTER TABLE [dbo].[PlaidConnections] ALTER COLUMN [CreatedAt] DATETIME2 (7) NOT NULL;

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;

BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

UPDATE [dbo].[PlaidConnections]
SET    [IsActive] = 0
WHERE  [IsActive] IS NULL;

ALTER TABLE [dbo].[PlaidConnections] ALTER COLUMN [IsActive] BIT NOT NULL;

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;

BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

UPDATE [dbo].[PlaidConnections]
SET    [SyncStatus] = N''
WHERE  [SyncStatus] IS NULL;

ALTER TABLE [dbo].[PlaidConnections] ALTER COLUMN [SyncStatus] NVARCHAR (20) NOT NULL;

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;

BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

UPDATE [dbo].[PlaidConnections]
SET    [UpdatedAt] = CONVERT(DateTime2, '')
WHERE  [UpdatedAt] IS NULL;

ALTER TABLE [dbo].[PlaidConnections] ALTER COLUMN [UpdatedAt] DATETIME2 (7) NOT NULL;

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating Unique Constraint [dbo].[UQ_PlaidConnections_ItemId]...';


GO
ALTER TABLE [dbo].[PlaidConnections]
    ADD CONSTRAINT [UQ_PlaidConnections_ItemId] UNIQUE NONCLUSTERED ([ItemId] ASC);


GO
PRINT N'Creating Index [dbo].[PlaidConnections].[IX_PlaidConnections_SyncStatus]...';


GO
CREATE NONCLUSTERED INDEX [IX_PlaidConnections_SyncStatus]
    ON [dbo].[PlaidConnections]([SyncStatus] ASC, [IsActive] ASC);


GO
PRINT N'Creating Index [dbo].[PlaidConnections].[IX_PlaidConnections_Active]...';


GO
CREATE NONCLUSTERED INDEX [IX_PlaidConnections_Active]
    ON [dbo].[PlaidConnections]([IsActive] ASC) WHERE IsActive = 1;


GO
PRINT N'Starting rebuilding table [dbo].[ProductsServices_History]...';


GO
CREATE TABLE [dbo].[tmp_ms_xx_ProductsServices_History] (
    [Id]                       UNIQUEIDENTIFIER NOT NULL,
    [Name]                     NVARCHAR (200)   NOT NULL,
    [SKU]                      NVARCHAR (50)    NULL,
    [Type]                     NVARCHAR (20)    NOT NULL,
    [Description]              NVARCHAR (MAX)   NULL,
    [SalesPrice]               DECIMAL (18, 2)  NULL,
    [PurchaseCost]             DECIMAL (18, 2)  NULL,
    [IncomeAccountId]          UNIQUEIDENTIFIER NULL,
    [ExpenseAccountId]         UNIQUEIDENTIFIER NULL,
    [InventoryAssetAccountId]  UNIQUEIDENTIFIER NULL,
    [Category]                 NVARCHAR (100)   NULL,
    [Taxable]                  BIT              NOT NULL,
    [Status]                   NVARCHAR (20)    NOT NULL,
    [CreatedAt]                DATETIME2 (7)    NOT NULL,
    [QuantityOnHand]           DECIMAL (18, 4)  NULL,
    [ReorderPoint]             DECIMAL (18, 4)  NULL,
    [InventoryValuationMethod] NVARCHAR (20)    NULL,
    [DefaultLocationId]        UNIQUEIDENTIFIER NULL,
    [TenantId]                 UNIQUEIDENTIFIER NULL,
    [SourceSystem]             NVARCHAR (50)    NULL,
    [SourceId]                 NVARCHAR (100)   NULL,
    [ValidFrom]                DATETIME2 (7)    NOT NULL,
    [ValidTo]                  DATETIME2 (7)    NOT NULL
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_ix_ProductsServices_History1]
    ON [dbo].[tmp_ms_xx_ProductsServices_History]([ValidTo] ASC, [ValidFrom] ASC);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[ProductsServices_History])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_ProductsServices_History] ([ValidTo], [ValidFrom], [Id], [Name], [SKU], [Type], [Description], [SalesPrice], [PurchaseCost], [IncomeAccountId], [ExpenseAccountId], [InventoryAssetAccountId], [Category], [Taxable], [Status], [CreatedAt], [QuantityOnHand], [ReorderPoint], [InventoryValuationMethod], [DefaultLocationId], [TenantId], [SourceSystem], [SourceId])
        SELECT   [ValidTo],
                 [ValidFrom],
                 [Id],
                 [Name],
                 [SKU],
                 [Type],
                 [Description],
                 [SalesPrice],
                 [PurchaseCost],
                 [IncomeAccountId],
                 [ExpenseAccountId],
                 [InventoryAssetAccountId],
                 [Category],
                 [Taxable],
                 [Status],
                 [CreatedAt],
                 [QuantityOnHand],
                 [ReorderPoint],
                 [InventoryValuationMethod],
                 [DefaultLocationId],
                 [TenantId],
                 [SourceSystem],
                 [SourceId]
        FROM     [dbo].[ProductsServices_History]
        ORDER BY [ValidTo] ASC, [ValidFrom] ASC;
    END

IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'ProductsServices'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[ProductsServices] SET (SYSTEM_VERSIONING = OFF);
    END

DROP TABLE [dbo].[ProductsServices_History];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_ProductsServices_History]', N'ProductsServices_History';

EXECUTE sp_rename N'[dbo].[ProductsServices_History].[tmp_ms_xx_index_ix_ProductsServices_History1]', N'ix_ProductsServices_History', N'INDEX';


GO
PRINT N'Altering Table [dbo].[QBOConnections]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

UPDATE [dbo].[QBOConnections]
SET    [CreatedAt] = CONVERT(DateTime2, '')
WHERE  [CreatedAt] IS NULL;

ALTER TABLE [dbo].[QBOConnections] ALTER COLUMN [CreatedAt] DATETIME2 (7) NOT NULL;

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;

BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

UPDATE [dbo].[QBOConnections]
SET    [Environment] = N''
WHERE  [Environment] IS NULL;

ALTER TABLE [dbo].[QBOConnections] ALTER COLUMN [Environment] NVARCHAR (20) NOT NULL;

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;

BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

UPDATE [dbo].[QBOConnections]
SET    [IsActive] = 0
WHERE  [IsActive] IS NULL;

ALTER TABLE [dbo].[QBOConnections] ALTER COLUMN [IsActive] BIT NOT NULL;

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;

BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

UPDATE [dbo].[QBOConnections]
SET    [UpdatedAt] = CONVERT(DateTime2, '')
WHERE  [UpdatedAt] IS NULL;

ALTER TABLE [dbo].[QBOConnections] ALTER COLUMN [UpdatedAt] DATETIME2 (7) NOT NULL;

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating Unique Constraint [dbo].[UQ_QBOConnections_RealmId]...';


GO
ALTER TABLE [dbo].[QBOConnections]
    ADD CONSTRAINT [UQ_QBOConnections_RealmId] UNIQUE NONCLUSTERED ([RealmId] ASC);


GO
PRINT N'Creating Index [dbo].[QBOConnections].[IX_QBOConnections_Active]...';


GO
CREATE NONCLUSTERED INDEX [IX_QBOConnections_Active]
    ON [dbo].[QBOConnections]([IsActive] ASC) WHERE [IsActive] = 1;


GO
PRINT N'Starting rebuilding table [dbo].[SalesReceipts_History]...';


GO
CREATE TABLE [dbo].[tmp_ms_xx_SalesReceipts_History] (
    [Id]                 UNIQUEIDENTIFIER NOT NULL,
    [SalesReceiptNumber] NVARCHAR (50)    NOT NULL,
    [CustomerId]         UNIQUEIDENTIFIER NULL,
    [SaleDate]           DATE             NOT NULL,
    [DepositAccountId]   UNIQUEIDENTIFIER NOT NULL,
    [PaymentMethod]      NVARCHAR (50)    NULL,
    [Reference]          NVARCHAR (100)   NULL,
    [Subtotal]           DECIMAL (19, 4)  NOT NULL,
    [TaxRateId]          UNIQUEIDENTIFIER NULL,
    [TaxAmount]          DECIMAL (19, 4)  NOT NULL,
    [TotalAmount]        DECIMAL (19, 4)  NOT NULL,
    [Memo]               NVARCHAR (500)   NULL,
    [Status]             NVARCHAR (20)    NOT NULL,
    [JournalEntryId]     UNIQUEIDENTIFIER NULL,
    [ClassId]            UNIQUEIDENTIFIER NULL,
    [LocationId]         UNIQUEIDENTIFIER NULL,
    [SourceSystem]       NVARCHAR (50)    NULL,
    [SourceId]           NVARCHAR (100)   NULL,
    [TenantId]           UNIQUEIDENTIFIER NULL,
    [IsPersonal]         BIT              NOT NULL,
    [CreatedAt]          DATETIME2 (7)    NOT NULL,
    [UpdatedAt]          DATETIME2 (7)    NOT NULL,
    [ValidFrom]          DATETIME2 (7)    NOT NULL,
    [ValidTo]            DATETIME2 (7)    NOT NULL
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_ix_SalesReceipts_History1]
    ON [dbo].[tmp_ms_xx_SalesReceipts_History]([ValidTo] ASC, [ValidFrom] ASC);

ALTER TABLE [dbo].[tmp_ms_xx_SalesReceipts_History]
    ADD CONSTRAINT [SD_SalesReceipts_History_0e40ea8fa8bc4e0ca458a07e43d42bfb] DEFAULT 0 FOR [IsPersonal];

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[SalesReceipts_History])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_SalesReceipts_History] ([ValidTo], [ValidFrom], [Id], [SalesReceiptNumber], [CustomerId], [SaleDate], [DepositAccountId], [PaymentMethod], [Reference], [Subtotal], [TaxRateId], [TaxAmount], [TotalAmount], [Memo], [Status], [JournalEntryId], [ClassId], [LocationId], [SourceSystem], [SourceId], [TenantId], [CreatedAt], [UpdatedAt])
        SELECT   [ValidTo],
                 [ValidFrom],
                 [Id],
                 [SalesReceiptNumber],
                 [CustomerId],
                 [SaleDate],
                 [DepositAccountId],
                 [PaymentMethod],
                 [Reference],
                 [Subtotal],
                 [TaxRateId],
                 [TaxAmount],
                 [TotalAmount],
                 [Memo],
                 [Status],
                 [JournalEntryId],
                 [ClassId],
                 [LocationId],
                 [SourceSystem],
                 [SourceId],
                 [TenantId],
                 [CreatedAt],
                 [UpdatedAt]
        FROM     [dbo].[SalesReceipts_History]
        ORDER BY [ValidTo] ASC, [ValidFrom] ASC;
    END

ALTER TABLE [dbo].[tmp_ms_xx_SalesReceipts_History] DROP CONSTRAINT [SD_SalesReceipts_History_0e40ea8fa8bc4e0ca458a07e43d42bfb];

IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'SalesReceipts'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[SalesReceipts] SET (SYSTEM_VERSIONING = OFF);
    END

DROP TABLE [dbo].[SalesReceipts_History];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_SalesReceipts_History]', N'SalesReceipts_History';

EXECUTE sp_rename N'[dbo].[SalesReceipts_History].[tmp_ms_xx_index_ix_SalesReceipts_History1]', N'ix_SalesReceipts_History', N'INDEX';


GO
PRINT N'Starting rebuilding table [dbo].[TaxRates]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_TaxRates] (
    [Id]            UNIQUEIDENTIFIER DEFAULT NEWID() NOT NULL,
    [Name]          NVARCHAR (100)   NULL,
    [TaxType]       NVARCHAR (30)    NOT NULL,
    [StateCode]     NVARCHAR (2)     NULL,
    [FilingStatus]  NVARCHAR (30)    NULL,
    [BracketMin]    DECIMAL (18, 2)  DEFAULT 0 NOT NULL,
    [BracketMax]    DECIMAL (18, 2)  NULL,
    [Rate]          DECIMAL (8, 6)   NOT NULL,
    [FlatAmount]    DECIMAL (18, 2)  DEFAULT 0 NOT NULL,
    [EffectiveYear] INT              NOT NULL,
    [IsActive]      BIT              DEFAULT 1 NOT NULL,
    [CreatedAt]     DATETIME2 (7)    DEFAULT SYSDATETIME() NOT NULL,
    [UpdatedAt]     DATETIME2 (7)    DEFAULT SYSDATETIME() NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[TaxRates])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_TaxRates] ([Id], [TaxType], [StateCode], [FilingStatus], [BracketMin], [BracketMax], [Rate], [FlatAmount], [EffectiveYear], [IsActive], [CreatedAt], [UpdatedAt])
        SELECT   [Id],
                 [TaxType],
                 [StateCode],
                 [FilingStatus],
                 [BracketMin],
                 [BracketMax],
                 [Rate],
                 [FlatAmount],
                 [EffectiveYear],
                 [IsActive],
                 [CreatedAt],
                 [UpdatedAt]
        FROM     [dbo].[TaxRates]
        ORDER BY [Id] ASC;
    END

DROP TABLE [dbo].[TaxRates];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_TaxRates]', N'TaxRates';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating Index [dbo].[TaxRates].[IX_TaxRates_Lookup]...';


GO
CREATE NONCLUSTERED INDEX [IX_TaxRates_Lookup]
    ON [dbo].[TaxRates]([TaxType] ASC, [StateCode] ASC, [FilingStatus] ASC, [EffectiveYear] ASC, [IsActive] ASC);


GO
PRINT N'Altering Table [dbo].[VendorCredits]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

UPDATE [dbo].[VendorCredits]
SET    [AmountApplied] = 0
WHERE  [AmountApplied] IS NULL;

ALTER TABLE [dbo].[VendorCredits] ALTER COLUMN [AmountApplied] DECIMAL (19, 4) NOT NULL;

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;

BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

UPDATE [dbo].[VendorCredits]
SET    [CreatedAt] = CONVERT(DateTime2, '')
WHERE  [CreatedAt] IS NULL;

ALTER TABLE [dbo].[VendorCredits] ALTER COLUMN [CreatedAt] DATETIME2 (7) NOT NULL;

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;

BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

UPDATE [dbo].[VendorCredits]
SET    [Status] = N''
WHERE  [Status] IS NULL;

ALTER TABLE [dbo].[VendorCredits] ALTER COLUMN [Status] NVARCHAR (20) NOT NULL;

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;

BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

UPDATE [dbo].[VendorCredits]
SET    [TaxAmount] = 0
WHERE  [TaxAmount] IS NULL;

ALTER TABLE [dbo].[VendorCredits] ALTER COLUMN [TaxAmount] DECIMAL (19, 4) NOT NULL;

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;

BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

UPDATE [dbo].[VendorCredits]
SET    [UpdatedAt] = CONVERT(DateTime2, '')
WHERE  [UpdatedAt] IS NULL;

ALTER TABLE [dbo].[VendorCredits] ALTER COLUMN [UpdatedAt] DATETIME2 (7) NOT NULL;

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating Index [dbo].[VendorCredits].[IX_VendorCredits_Status]...';


GO
CREATE NONCLUSTERED INDEX [IX_VendorCredits_Status]
    ON [dbo].[VendorCredits]([Status] ASC);


GO
PRINT N'Starting rebuilding table [dbo].[Vendors_History]...';


GO
CREATE TABLE [dbo].[tmp_ms_xx_Vendors_History] (
    [Id]                      UNIQUEIDENTIFIER NOT NULL,
    [Name]                    NVARCHAR (100)   NOT NULL,
    [Email]                   NVARCHAR (100)   NULL,
    [Phone]                   NVARCHAR (20)    NULL,
    [Address]                 NVARCHAR (500)   NULL,
    [PaymentTerms]            NVARCHAR (50)    NULL,
    [TaxId]                   NVARCHAR (50)    NULL,
    [Is1099Vendor]            BIT              NOT NULL,
    [DefaultExpenseAccountId] UNIQUEIDENTIFIER NULL,
    [Status]                  NVARCHAR (20)    NOT NULL,
    [CreatedAt]               DATETIME2 (7)    NOT NULL,
    [UpdatedAt]               DATETIME2 (7)    NOT NULL,
    [TenantId]                UNIQUEIDENTIFIER NULL,
    [AddressLine1]            NVARCHAR (100)   NULL,
    [AddressLine2]            NVARCHAR (100)   NULL,
    [City]                    NVARCHAR (50)    NULL,
    [State]                   NVARCHAR (50)    NULL,
    [PostalCode]              NVARCHAR (20)    NULL,
    [Country]                 NVARCHAR (50)    NULL,
    [SourceSystem]            NVARCHAR (50)    NULL,
    [SourceId]                NVARCHAR (100)   NULL,
    [ValidFrom]               DATETIME2 (7)    NOT NULL,
    [ValidTo]                 DATETIME2 (7)    NOT NULL
);

CREATE CLUSTERED INDEX [tmp_ms_xx_index_ix_Vendors_History1]
    ON [dbo].[tmp_ms_xx_Vendors_History]([ValidTo] ASC, [ValidFrom] ASC);

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Vendors_History])
    BEGIN
        INSERT INTO [dbo].[tmp_ms_xx_Vendors_History] ([ValidTo], [ValidFrom], [Id], [Name], [Email], [Phone], [Address], [PaymentTerms], [TaxId], [Is1099Vendor], [DefaultExpenseAccountId], [Status], [CreatedAt], [UpdatedAt], [TenantId], [AddressLine1], [AddressLine2], [City], [State], [PostalCode], [Country], [SourceSystem], [SourceId])
        SELECT   [ValidTo],
                 [ValidFrom],
                 [Id],
                 [Name],
                 [Email],
                 [Phone],
                 [Address],
                 [PaymentTerms],
                 [TaxId],
                 [Is1099Vendor],
                 [DefaultExpenseAccountId],
                 [Status],
                 [CreatedAt],
                 [UpdatedAt],
                 [TenantId],
                 [AddressLine1],
                 [AddressLine2],
                 [City],
                 [State],
                 [PostalCode],
                 [Country],
                 [SourceSystem],
                 [SourceId]
        FROM     [dbo].[Vendors_History]
        ORDER BY [ValidTo] ASC, [ValidFrom] ASC;
    END

IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'Vendors'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[Vendors] SET (SYSTEM_VERSIONING = OFF);
    END

DROP TABLE [dbo].[Vendors_History];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Vendors_History]', N'Vendors_History';

EXECUTE sp_rename N'[dbo].[Vendors_History].[tmp_ms_xx_index_ix_Vendors_History1]', N'ix_Vendors_History', N'INDEX';


GO
PRINT N'Creating Table [dbo].[YearEndCloseEntries]...';


GO
CREATE TABLE [dbo].[YearEndCloseEntries] (
    [Id]                        UNIQUEIDENTIFIER                                   NOT NULL,
    [AccountingPeriodId]        UNIQUEIDENTIFIER                                   NOT NULL,
    [FiscalYear]                INT                                                NOT NULL,
    [CloseDate]                 DATE                                               NOT NULL,
    [RetainedEarningsAccountId] UNIQUEIDENTIFIER                                   NOT NULL,
    [JournalEntryId]            UNIQUEIDENTIFIER                                   NOT NULL,
    [NetIncome]                 DECIMAL (19, 4)                                    NOT NULL,
    [TotalRevenue]              DECIMAL (19, 4)                                    NOT NULL,
    [TotalExpenses]             DECIMAL (19, 4)                                    NOT NULL,
    [Status]                    NVARCHAR (20)                                      NOT NULL,
    [CreatedBy]                 NVARCHAR (255)                                     NOT NULL,
    [CreatedAt]                 DATETIME2 (7)                                      NOT NULL,
    [TenantId]                  UNIQUEIDENTIFIER                                   NULL,
    [ValidFrom]                 DATETIME2 (7) GENERATED ALWAYS AS ROW START HIDDEN NOT NULL,
    [ValidTo]                   DATETIME2 (7) GENERATED ALWAYS AS ROW END HIDDEN   NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC),
    CONSTRAINT [UQ_YearEndCloseEntries_FiscalYear] UNIQUE NONCLUSTERED ([FiscalYear] ASC),
    PERIOD FOR SYSTEM_TIME ([ValidFrom], [ValidTo])
)
WITH (SYSTEM_VERSIONING = ON (HISTORY_TABLE=[dbo].[YearEndCloseEntries_History], DATA_CONSISTENCY_CHECK=ON));


GO
PRINT N'Starting rebuilding table [dbo].[Accounts]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Accounts] (
    [Id]               UNIQUEIDENTIFIER                                   DEFAULT NEWID() NOT NULL,
    [Code]             NVARCHAR (50)                                      NOT NULL,
    [Name]             NVARCHAR (200)                                     NOT NULL,
    [Type]             NVARCHAR (50)                                      NOT NULL,
    [Subtype]          NVARCHAR (50)                                      NULL,
    [CashFlowCategory] NVARCHAR (50)                                      NULL,
    [AccountNumber]    NVARCHAR (50)                                      NULL,
    [Description]      NVARCHAR (MAX)                                     NULL,
    [IsActive]         BIT                                                DEFAULT 1 NOT NULL,
    [CreatedAt]        DATETIME2 (7)                                      DEFAULT SYSDATETIME() NOT NULL,
    [UpdatedAt]        DATETIME2 (7)                                      DEFAULT SYSDATETIME() NOT NULL,
    [TenantId]         UNIQUEIDENTIFIER                                   NULL,
    [SourceSystem]     NVARCHAR (50)                                      NULL,
    [SourceId]         NVARCHAR (100)                                     NULL,
    [ValidFrom]        DATETIME2 (7) GENERATED ALWAYS AS ROW START HIDDEN NOT NULL,
    [ValidTo]          DATETIME2 (7) GENERATED ALWAYS AS ROW END HIDDEN   NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC),
    CONSTRAINT [tmp_ms_xx_constraint_UQ_Accounts_Code1] UNIQUE NONCLUSTERED ([Code] ASC),
    PERIOD FOR SYSTEM_TIME ([ValidFrom], [ValidTo])
)
WITH (SYSTEM_VERSIONING = ON (HISTORY_TABLE=[dbo].[Accounts_History], DATA_CONSISTENCY_CHECK=ON));

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Accounts])
    BEGIN
        IF EXISTS (SELECT TOP 1 1 
                   FROM   [sys].[tables]
                   WHERE  [name] = N'tmp_ms_xx_Accounts'
                          AND SCHEMA_NAME(schema_id) = N'dbo'
                          AND temporal_type = 2)
            BEGIN
                ALTER TABLE [dbo].[tmp_ms_xx_Accounts] SET (SYSTEM_VERSIONING = OFF);
            END
        IF EXISTS (SELECT TOP 1 1 
                   FROM   [sys].[periods]
                   WHERE  [period_type] = 1
                          AND OBJECT_ID('[dbo].[tmp_ms_xx_Accounts]', 'U') = object_id)
            BEGIN
                ALTER TABLE [dbo].[tmp_ms_xx_Accounts] DROP PERIOD FOR SYSTEM_TIME;
            END
        INSERT INTO [dbo].[tmp_ms_xx_Accounts] ([Id], [Code], [Name], [Type], [Subtype], [CashFlowCategory], [AccountNumber], [Description], [IsActive], [CreatedAt], [UpdatedAt], [TenantId], [ValidFrom], [ValidTo], [SourceSystem], [SourceId])
        SELECT   [Id],
                 [Code],
                 [Name],
                 [Type],
                 [Subtype],
                 [CashFlowCategory],
                 [AccountNumber],
                 [Description],
                 [IsActive],
                 [CreatedAt],
                 [UpdatedAt],
                 [TenantId],
                 [ValidFrom],
                 [ValidTo],
                 [SourceSystem],
                 [SourceId]
        FROM     [dbo].[Accounts]
        ORDER BY [Id] ASC;
        ALTER TABLE [dbo].[tmp_ms_xx_Accounts]
            ADD PERIOD FOR SYSTEM_TIME ([ValidFrom], [ValidTo]);
        ALTER TABLE [dbo].[tmp_ms_xx_Accounts] ALTER COLUMN [ValidFrom] ADD HIDDEN;
        ALTER TABLE [dbo].[tmp_ms_xx_Accounts] ALTER COLUMN [ValidTo] ADD HIDDEN;
        ALTER TABLE [dbo].[tmp_ms_xx_Accounts] SET (SYSTEM_VERSIONING = ON (HISTORY_TABLE=[dbo].[Accounts_History], DATA_CONSISTENCY_CHECK=ON));
    END

IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'Accounts'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[Accounts] SET (SYSTEM_VERSIONING = OFF);
    END

DROP TABLE [dbo].[Accounts];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Accounts]', N'Accounts';

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_constraint_UQ_Accounts_Code1]', N'UQ_Accounts_Code', N'OBJECT';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating Index [dbo].[Accounts].[IX_Accounts_Source]...';


GO
CREATE NONCLUSTERED INDEX [IX_Accounts_Source]
    ON [dbo].[Accounts]([SourceSystem] ASC, [SourceId] ASC) WHERE [SourceSystem] IS NOT NULL;


GO
PRINT N'Starting rebuilding table [dbo].[Bills]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Bills] (
    [Id]             UNIQUEIDENTIFIER                                   DEFAULT NEWID() NOT NULL,
    [VendorId]       UNIQUEIDENTIFIER                                   NOT NULL,
    [BillNumber]     NVARCHAR (50)                                      NULL,
    [BillDate]       DATE                                               NOT NULL,
    [DueDate]        DATE                                               NOT NULL,
    [TotalAmount]    DECIMAL (19, 4)                                    DEFAULT 0 NOT NULL,
    [AmountPaid]     DECIMAL (19, 4)                                    DEFAULT 0 NOT NULL,
    [Status]         NVARCHAR (20)                                      DEFAULT 'Open' NOT NULL,
    [Terms]          NVARCHAR (50)                                      NULL,
    [Memo]           NVARCHAR (500)                                     NULL,
    [CreatedAt]      DATETIME2 (7)                                      DEFAULT SYSDATETIME() NOT NULL,
    [UpdatedAt]      DATETIME2 (7)                                      DEFAULT SYSDATETIME() NOT NULL,
    [TenantId]       UNIQUEIDENTIFIER                                   NULL,
    [JournalEntryId] UNIQUEIDENTIFIER                                   NULL,
    [PostedAt]       DATETIME2 (7)                                      NULL,
    [PostedBy]       NVARCHAR (100)                                     NULL,
    [SourceSystem]   NVARCHAR (50)                                      NULL,
    [SourceId]       NVARCHAR (100)                                     NULL,
    [ValidFrom]      DATETIME2 (7) GENERATED ALWAYS AS ROW START HIDDEN NOT NULL,
    [ValidTo]        DATETIME2 (7) GENERATED ALWAYS AS ROW END HIDDEN   NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC),
    PERIOD FOR SYSTEM_TIME ([ValidFrom], [ValidTo])
)
WITH (SYSTEM_VERSIONING = ON (HISTORY_TABLE=[dbo].[Bills_History], DATA_CONSISTENCY_CHECK=ON));

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Bills])
    BEGIN
        IF EXISTS (SELECT TOP 1 1 
                   FROM   [sys].[tables]
                   WHERE  [name] = N'tmp_ms_xx_Bills'
                          AND SCHEMA_NAME(schema_id) = N'dbo'
                          AND temporal_type = 2)
            BEGIN
                ALTER TABLE [dbo].[tmp_ms_xx_Bills] SET (SYSTEM_VERSIONING = OFF);
            END
        IF EXISTS (SELECT TOP 1 1 
                   FROM   [sys].[periods]
                   WHERE  [period_type] = 1
                          AND OBJECT_ID('[dbo].[tmp_ms_xx_Bills]', 'U') = object_id)
            BEGIN
                ALTER TABLE [dbo].[tmp_ms_xx_Bills] DROP PERIOD FOR SYSTEM_TIME;
            END
        INSERT INTO [dbo].[tmp_ms_xx_Bills] ([Id], [VendorId], [BillNumber], [BillDate], [DueDate], [TotalAmount], [AmountPaid], [Status], [Terms], [Memo], [CreatedAt], [UpdatedAt], [TenantId], [JournalEntryId], [PostedAt], [PostedBy], [ValidFrom], [ValidTo], [SourceSystem], [SourceId])
        SELECT   [Id],
                 [VendorId],
                 [BillNumber],
                 [BillDate],
                 [DueDate],
                 [TotalAmount],
                 [AmountPaid],
                 [Status],
                 [Terms],
                 [Memo],
                 [CreatedAt],
                 [UpdatedAt],
                 [TenantId],
                 [JournalEntryId],
                 [PostedAt],
                 [PostedBy],
                 [ValidFrom],
                 [ValidTo],
                 [SourceSystem],
                 [SourceId]
        FROM     [dbo].[Bills]
        ORDER BY [Id] ASC;
        ALTER TABLE [dbo].[tmp_ms_xx_Bills]
            ADD PERIOD FOR SYSTEM_TIME ([ValidFrom], [ValidTo]);
        ALTER TABLE [dbo].[tmp_ms_xx_Bills] ALTER COLUMN [ValidFrom] ADD HIDDEN;
        ALTER TABLE [dbo].[tmp_ms_xx_Bills] ALTER COLUMN [ValidTo] ADD HIDDEN;
        ALTER TABLE [dbo].[tmp_ms_xx_Bills] SET (SYSTEM_VERSIONING = ON (HISTORY_TABLE=[dbo].[Bills_History], DATA_CONSISTENCY_CHECK=ON));
    END

IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'Bills'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[Bills] SET (SYSTEM_VERSIONING = OFF);
    END

DROP TABLE [dbo].[Bills];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Bills]', N'Bills';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating Index [dbo].[Bills].[IX_Bills_BillNumber]...';


GO
CREATE NONCLUSTERED INDEX [IX_Bills_BillNumber]
    ON [dbo].[Bills]([BillNumber] ASC);


GO
PRINT N'Creating Index [dbo].[Bills].[IX_Bills_DueDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Bills_DueDate]
    ON [dbo].[Bills]([DueDate] ASC);


GO
PRINT N'Creating Index [dbo].[Bills].[IX_Bills_Source]...';


GO
CREATE NONCLUSTERED INDEX [IX_Bills_Source]
    ON [dbo].[Bills]([SourceSystem] ASC, [SourceId] ASC) WHERE [SourceSystem] IS NOT NULL;


GO
PRINT N'Creating Index [dbo].[Bills].[IX_Bills_Status]...';


GO
CREATE NONCLUSTERED INDEX [IX_Bills_Status]
    ON [dbo].[Bills]([Status] ASC);


GO
PRINT N'Creating Index [dbo].[Bills].[IX_Bills_VendorId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Bills_VendorId]
    ON [dbo].[Bills]([VendorId] ASC);


GO
ALTER TABLE [dbo].[Bills] ENABLE CHANGE_TRACKING WITH (TRACK_COLUMNS_UPDATED = ON);


GO
PRINT N'Starting rebuilding table [dbo].[Customers]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Customers] (
    [Id]           UNIQUEIDENTIFIER                                   DEFAULT NEWID() NOT NULL,
    [Name]         NVARCHAR (100)                                     NOT NULL,
    [Email]        NVARCHAR (100)                                     NULL,
    [Phone]        NVARCHAR (20)                                      NULL,
    [Address]      NVARCHAR (200)                                     NULL,
    [CreatedAt]    DATETIME2 (7)                                      DEFAULT SYSDATETIME() NOT NULL,
    [UpdatedAt]    DATETIME2 (7)                                      DEFAULT SYSDATETIME() NOT NULL,
    [TenantId]     UNIQUEIDENTIFIER                                   NULL,
    [AddressLine1] NVARCHAR (100)                                     NULL,
    [AddressLine2] NVARCHAR (100)                                     NULL,
    [City]         NVARCHAR (50)                                      NULL,
    [State]        NVARCHAR (50)                                      NULL,
    [PostalCode]   NVARCHAR (20)                                      NULL,
    [Country]      NVARCHAR (50)                                      DEFAULT ('US') NULL,
    [SourceSystem] NVARCHAR (50)                                      NULL,
    [SourceId]     NVARCHAR (100)                                     NULL,
    [ValidFrom]    DATETIME2 (7) GENERATED ALWAYS AS ROW START HIDDEN NOT NULL,
    [ValidTo]      DATETIME2 (7) GENERATED ALWAYS AS ROW END HIDDEN   NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC),
    PERIOD FOR SYSTEM_TIME ([ValidFrom], [ValidTo])
)
WITH (SYSTEM_VERSIONING = ON (HISTORY_TABLE=[dbo].[Customers_History], DATA_CONSISTENCY_CHECK=ON));

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Customers])
    BEGIN
        IF EXISTS (SELECT TOP 1 1 
                   FROM   [sys].[tables]
                   WHERE  [name] = N'tmp_ms_xx_Customers'
                          AND SCHEMA_NAME(schema_id) = N'dbo'
                          AND temporal_type = 2)
            BEGIN
                ALTER TABLE [dbo].[tmp_ms_xx_Customers] SET (SYSTEM_VERSIONING = OFF);
            END
        IF EXISTS (SELECT TOP 1 1 
                   FROM   [sys].[periods]
                   WHERE  [period_type] = 1
                          AND OBJECT_ID('[dbo].[tmp_ms_xx_Customers]', 'U') = object_id)
            BEGIN
                ALTER TABLE [dbo].[tmp_ms_xx_Customers] DROP PERIOD FOR SYSTEM_TIME;
            END
        INSERT INTO [dbo].[tmp_ms_xx_Customers] ([Id], [Name], [Email], [Phone], [Address], [CreatedAt], [UpdatedAt], [TenantId], [AddressLine1], [AddressLine2], [City], [State], [PostalCode], [Country], [ValidFrom], [ValidTo], [SourceSystem], [SourceId])
        SELECT   [Id],
                 [Name],
                 [Email],
                 [Phone],
                 [Address],
                 [CreatedAt],
                 [UpdatedAt],
                 [TenantId],
                 [AddressLine1],
                 [AddressLine2],
                 [City],
                 [State],
                 [PostalCode],
                 [Country],
                 [ValidFrom],
                 [ValidTo],
                 [SourceSystem],
                 [SourceId]
        FROM     [dbo].[Customers]
        ORDER BY [Id] ASC;
        ALTER TABLE [dbo].[tmp_ms_xx_Customers]
            ADD PERIOD FOR SYSTEM_TIME ([ValidFrom], [ValidTo]);
        ALTER TABLE [dbo].[tmp_ms_xx_Customers] ALTER COLUMN [ValidFrom] ADD HIDDEN;
        ALTER TABLE [dbo].[tmp_ms_xx_Customers] ALTER COLUMN [ValidTo] ADD HIDDEN;
        ALTER TABLE [dbo].[tmp_ms_xx_Customers] SET (SYSTEM_VERSIONING = ON (HISTORY_TABLE=[dbo].[Customers_History], DATA_CONSISTENCY_CHECK=ON));
    END

IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'Customers'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[Customers] SET (SYSTEM_VERSIONING = OFF);
    END

DROP TABLE [dbo].[Customers];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Customers]', N'Customers';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating Index [dbo].[Customers].[IX_Customers_Source]...';


GO
CREATE NONCLUSTERED INDEX [IX_Customers_Source]
    ON [dbo].[Customers]([SourceSystem] ASC, [SourceId] ASC) WHERE [SourceSystem] IS NOT NULL;


GO
ALTER TABLE [dbo].[Customers] ENABLE CHANGE_TRACKING WITH (TRACK_COLUMNS_UPDATED = ON);


GO
PRINT N'Starting rebuilding table [dbo].[Employees]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Employees] (
    [Id]                     UNIQUEIDENTIFIER                                   DEFAULT NEWID() NOT NULL,
    [EmployeeNumber]         NVARCHAR (20)                                      NOT NULL,
    [FirstName]              NVARCHAR (50)                                      NOT NULL,
    [LastName]               NVARCHAR (50)                                      NOT NULL,
    [Email]                  NVARCHAR (100)                                     NULL,
    [Phone]                  NVARCHAR (20)                                      NULL,
    [SSNLast4]               NVARCHAR (4)                                       NULL,
    [DateOfBirth]            DATE                                               NULL,
    [HireDate]               DATE                                               NOT NULL,
    [TerminationDate]        DATE                                               NULL,
    [PayType]                NVARCHAR (20)                                      DEFAULT 'Hourly' NOT NULL,
    [PayRate]                DECIMAL (18, 2)                                    NOT NULL,
    [PayFrequency]           NVARCHAR (20)                                      DEFAULT 'Biweekly' NOT NULL,
    [FederalFilingStatus]    NVARCHAR (30)                                      DEFAULT 'Single' NOT NULL,
    [FederalAllowances]      INT                                                DEFAULT 0 NOT NULL,
    [StateCode]              NVARCHAR (2)                                       NULL,
    [StateFilingStatus]      NVARCHAR (30)                                      NULL,
    [StateAllowances]        INT                                                DEFAULT 0 NOT NULL,
    [BankRoutingNumber]      NVARCHAR (9)                                       NULL,
    [BankAccountNumber]      NVARCHAR (50)                                      NULL,
    [BankAccountType]        NVARCHAR (20)                                      NULL,
    [Address]                NVARCHAR (200)                                     NULL,
    [City]                   NVARCHAR (100)                                     NULL,
    [State]                  NVARCHAR (2)                                       NULL,
    [ZipCode]                NVARCHAR (10)                                      NULL,
    [Status]                 NVARCHAR (20)                                      DEFAULT 'Active' NOT NULL,
    [CreatedAt]              DATETIME2 (7)                                      DEFAULT SYSDATETIME() NOT NULL,
    [UpdatedAt]              DATETIME2 (7)                                      DEFAULT SYSDATETIME() NOT NULL,
    [PlaidItemId]            NVARCHAR (100)                                     NULL,
    [PlaidAccountId]         NVARCHAR (100)                                     NULL,
    [BankVerificationStatus] NVARCHAR (20)                                      DEFAULT ('Unverified') NOT NULL,
    [BankVerifiedAt]         DATETIME2 (7)                                      NULL,
    [BankInstitutionName]    NVARCHAR (200)                                     NULL,
    [ValidFrom]              DATETIME2 (7) GENERATED ALWAYS AS ROW START HIDDEN NOT NULL,
    [ValidTo]                DATETIME2 (7) GENERATED ALWAYS AS ROW END HIDDEN   NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC),
    PERIOD FOR SYSTEM_TIME ([ValidFrom], [ValidTo])
)
WITH (SYSTEM_VERSIONING = ON (HISTORY_TABLE=[dbo].[Employees_History], DATA_CONSISTENCY_CHECK=ON));

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Employees])
    BEGIN
        IF EXISTS (SELECT TOP 1 1 
                   FROM   [sys].[tables]
                   WHERE  [name] = N'tmp_ms_xx_Employees'
                          AND SCHEMA_NAME(schema_id) = N'dbo'
                          AND temporal_type = 2)
            BEGIN
                ALTER TABLE [dbo].[tmp_ms_xx_Employees] SET (SYSTEM_VERSIONING = OFF);
            END
        IF EXISTS (SELECT TOP 1 1 
                   FROM   [sys].[periods]
                   WHERE  [period_type] = 1
                          AND OBJECT_ID('[dbo].[tmp_ms_xx_Employees]', 'U') = object_id)
            BEGIN
                ALTER TABLE [dbo].[tmp_ms_xx_Employees] DROP PERIOD FOR SYSTEM_TIME;
            END
        INSERT INTO [dbo].[tmp_ms_xx_Employees] ([Id], [EmployeeNumber], [FirstName], [LastName], [Email], [Phone], [SSNLast4], [DateOfBirth], [HireDate], [TerminationDate], [PayType], [PayRate], [PayFrequency], [FederalFilingStatus], [FederalAllowances], [StateCode], [StateFilingStatus], [StateAllowances], [BankRoutingNumber], [BankAccountNumber], [BankAccountType], [Address], [City], [State], [ZipCode], [Status], [CreatedAt], [UpdatedAt], [ValidFrom], [ValidTo], [PlaidItemId], [PlaidAccountId], [BankVerificationStatus], [BankVerifiedAt], [BankInstitutionName])
        SELECT   [Id],
                 [EmployeeNumber],
                 [FirstName],
                 [LastName],
                 [Email],
                 [Phone],
                 [SSNLast4],
                 [DateOfBirth],
                 [HireDate],
                 [TerminationDate],
                 [PayType],
                 [PayRate],
                 [PayFrequency],
                 [FederalFilingStatus],
                 [FederalAllowances],
                 [StateCode],
                 [StateFilingStatus],
                 [StateAllowances],
                 [BankRoutingNumber],
                 [BankAccountNumber],
                 [BankAccountType],
                 [Address],
                 [City],
                 [State],
                 [ZipCode],
                 [Status],
                 [CreatedAt],
                 [UpdatedAt],
                 [ValidFrom],
                 [ValidTo],
                 [PlaidItemId],
                 [PlaidAccountId],
                 [BankVerificationStatus],
                 [BankVerifiedAt],
                 [BankInstitutionName]
        FROM     [dbo].[Employees]
        ORDER BY [Id] ASC;
        ALTER TABLE [dbo].[tmp_ms_xx_Employees]
            ADD PERIOD FOR SYSTEM_TIME ([ValidFrom], [ValidTo]);
        ALTER TABLE [dbo].[tmp_ms_xx_Employees] ALTER COLUMN [ValidFrom] ADD HIDDEN;
        ALTER TABLE [dbo].[tmp_ms_xx_Employees] ALTER COLUMN [ValidTo] ADD HIDDEN;
        ALTER TABLE [dbo].[tmp_ms_xx_Employees] SET (SYSTEM_VERSIONING = ON (HISTORY_TABLE=[dbo].[Employees_History], DATA_CONSISTENCY_CHECK=ON));
    END

DROP TABLE [dbo].[Employees];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Employees]', N'Employees';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating Index [dbo].[Employees].[IX_Employees_EmployeeNumber]...';


GO
CREATE UNIQUE NONCLUSTERED INDEX [IX_Employees_EmployeeNumber]
    ON [dbo].[Employees]([EmployeeNumber] ASC);


GO
PRINT N'Creating Index [dbo].[Employees].[IX_Employees_LastName_FirstName]...';


GO
CREATE NONCLUSTERED INDEX [IX_Employees_LastName_FirstName]
    ON [dbo].[Employees]([LastName] ASC, [FirstName] ASC);


GO
PRINT N'Creating Index [dbo].[Employees].[IX_Employees_Status]...';


GO
CREATE NONCLUSTERED INDEX [IX_Employees_Status]
    ON [dbo].[Employees]([Status] ASC);


GO
PRINT N'Starting rebuilding table [dbo].[Expenses]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Expenses] (
    [Id]                UNIQUEIDENTIFIER                                   DEFAULT NEWID() NOT NULL,
    [ExpenseNumber]     NVARCHAR (50)                                      NULL,
    [ExpenseDate]       DATE                                               NOT NULL,
    [VendorId]          UNIQUEIDENTIFIER                                   NULL,
    [VendorName]        NVARCHAR (255)                                     NULL,
    [AccountId]         UNIQUEIDENTIFIER                                   NOT NULL,
    [Amount]            DECIMAL (19, 4)                                    NOT NULL,
    [PaymentAccountId]  UNIQUEIDENTIFIER                                   NULL,
    [PaymentMethod]     NVARCHAR (50)                                      NULL,
    [Description]       NVARCHAR (500)                                     NULL,
    [Reference]         NVARCHAR (100)                                     NULL,
    [IsReimbursable]    BIT                                                DEFAULT 0 NOT NULL,
    [ReimbursedDate]    DATE                                               NULL,
    [CustomerId]        UNIQUEIDENTIFIER                                   NULL,
    [ProjectId]         UNIQUEIDENTIFIER                                   NULL,
    [ClassId]           UNIQUEIDENTIFIER                                   NULL,
    [BankTransactionId] UNIQUEIDENTIFIER                                   NULL,
    [Status]            NVARCHAR (20)                                      DEFAULT 'Recorded' NOT NULL,
    [IsPersonal]        BIT                                                DEFAULT 0 NOT NULL,
    [JournalEntryId]    UNIQUEIDENTIFIER                                   NULL,
    [CreatedBy]         NVARCHAR (255)                                     NULL,
    [CreatedAt]         DATETIME2 (7)                                      DEFAULT SYSDATETIME() NOT NULL,
    [UpdatedAt]         DATETIME2 (7)                                      DEFAULT SYSDATETIME() NOT NULL,
    [ValidFrom]         DATETIME2 (7) GENERATED ALWAYS AS ROW START HIDDEN NOT NULL,
    [ValidTo]           DATETIME2 (7) GENERATED ALWAYS AS ROW END HIDDEN   NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC),
    PERIOD FOR SYSTEM_TIME ([ValidFrom], [ValidTo])
)
WITH (SYSTEM_VERSIONING = ON (HISTORY_TABLE=[dbo].[Expenses_History], DATA_CONSISTENCY_CHECK=ON));

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Expenses])
    BEGIN
        IF EXISTS (SELECT TOP 1 1 
                   FROM   [sys].[tables]
                   WHERE  [name] = N'tmp_ms_xx_Expenses'
                          AND SCHEMA_NAME(schema_id) = N'dbo'
                          AND temporal_type = 2)
            BEGIN
                ALTER TABLE [dbo].[tmp_ms_xx_Expenses] SET (SYSTEM_VERSIONING = OFF);
            END
        IF EXISTS (SELECT TOP 1 1 
                   FROM   [sys].[periods]
                   WHERE  [period_type] = 1
                          AND OBJECT_ID('[dbo].[tmp_ms_xx_Expenses]', 'U') = object_id)
            BEGIN
                ALTER TABLE [dbo].[tmp_ms_xx_Expenses] DROP PERIOD FOR SYSTEM_TIME;
            END
        INSERT INTO [dbo].[tmp_ms_xx_Expenses] ([Id], [ExpenseNumber], [ExpenseDate], [VendorId], [VendorName], [AccountId], [Amount], [PaymentAccountId], [PaymentMethod], [Description], [Reference], [IsReimbursable], [ReimbursedDate], [CustomerId], [ProjectId], [ClassId], [BankTransactionId], [Status], [JournalEntryId], [CreatedBy], [CreatedAt], [UpdatedAt], [ValidFrom], [ValidTo], [IsPersonal])
        SELECT   [Id],
                 [ExpenseNumber],
                 [ExpenseDate],
                 [VendorId],
                 [VendorName],
                 [AccountId],
                 [Amount],
                 [PaymentAccountId],
                 [PaymentMethod],
                 [Description],
                 [Reference],
                 [IsReimbursable],
                 [ReimbursedDate],
                 [CustomerId],
                 [ProjectId],
                 [ClassId],
                 [BankTransactionId],
                 [Status],
                 [JournalEntryId],
                 [CreatedBy],
                 [CreatedAt],
                 [UpdatedAt],
                 [ValidFrom],
                 [ValidTo],
                 [IsPersonal]
        FROM     [dbo].[Expenses]
        ORDER BY [Id] ASC;
        ALTER TABLE [dbo].[tmp_ms_xx_Expenses]
            ADD PERIOD FOR SYSTEM_TIME ([ValidFrom], [ValidTo]);
        ALTER TABLE [dbo].[tmp_ms_xx_Expenses] ALTER COLUMN [ValidFrom] ADD HIDDEN;
        ALTER TABLE [dbo].[tmp_ms_xx_Expenses] ALTER COLUMN [ValidTo] ADD HIDDEN;
        ALTER TABLE [dbo].[tmp_ms_xx_Expenses] SET (SYSTEM_VERSIONING = ON (HISTORY_TABLE=[dbo].[Expenses_History], DATA_CONSISTENCY_CHECK=ON));
    END

IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'Expenses'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[Expenses] SET (SYSTEM_VERSIONING = OFF);
    END

DROP TABLE [dbo].[Expenses];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Expenses]', N'Expenses';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating Index [dbo].[Expenses].[IX_Expenses_AccountId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Expenses_AccountId]
    ON [dbo].[Expenses]([AccountId] ASC);


GO
PRINT N'Creating Index [dbo].[Expenses].[IX_Expenses_CustomerId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Expenses_CustomerId]
    ON [dbo].[Expenses]([CustomerId] ASC) WHERE CustomerId IS NOT NULL;


GO
PRINT N'Creating Index [dbo].[Expenses].[IX_Expenses_ExpenseDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Expenses_ExpenseDate]
    ON [dbo].[Expenses]([ExpenseDate] DESC);


GO
PRINT N'Creating Index [dbo].[Expenses].[IX_Expenses_IsPersonal]...';


GO
CREATE NONCLUSTERED INDEX [IX_Expenses_IsPersonal]
    ON [dbo].[Expenses]([IsPersonal] ASC);


GO
PRINT N'Creating Index [dbo].[Expenses].[IX_Expenses_IsReimbursable]...';


GO
CREATE NONCLUSTERED INDEX [IX_Expenses_IsReimbursable]
    ON [dbo].[Expenses]([IsReimbursable] ASC) WHERE IsReimbursable = 1;


GO
PRINT N'Creating Index [dbo].[Expenses].[IX_Expenses_ProjectId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Expenses_ProjectId]
    ON [dbo].[Expenses]([ProjectId] ASC) WHERE ProjectId IS NOT NULL;


GO
PRINT N'Creating Index [dbo].[Expenses].[IX_Expenses_Status]...';


GO
CREATE NONCLUSTERED INDEX [IX_Expenses_Status]
    ON [dbo].[Expenses]([Status] ASC);


GO
PRINT N'Creating Index [dbo].[Expenses].[IX_Expenses_VendorId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Expenses_VendorId]
    ON [dbo].[Expenses]([VendorId] ASC);


GO
ALTER TABLE [dbo].[Expenses] ENABLE CHANGE_TRACKING WITH (TRACK_COLUMNS_UPDATED = ON);


GO
PRINT N'Starting rebuilding table [dbo].[MileageTrips]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_MileageTrips] (
    [Id]               UNIQUEIDENTIFIER                                   DEFAULT NEWID() NOT NULL,
    [VehicleId]        UNIQUEIDENTIFIER                                   NULL,
    [TripDate]         DATE                                               NOT NULL,
    [StartLocation]    NVARCHAR (255)                                     NULL,
    [EndLocation]      NVARCHAR (255)                                     NULL,
    [StartOdometer]    INT                                                NULL,
    [EndOdometer]      INT                                                NULL,
    [Distance]         DECIMAL (10, 2)                                    NOT NULL,
    [Purpose]          NVARCHAR (500)                                     NULL,
    [Category]         NVARCHAR (20)                                      NOT NULL,
    [RatePerMile]      DECIMAL (6, 4)                                     NULL,
    [DeductibleAmount] DECIMAL (10, 2)                                    NULL,
    [CustomerId]       UNIQUEIDENTIFIER                                   NULL,
    [ProjectId]        UNIQUEIDENTIFIER                                   NULL,
    [Notes]            NVARCHAR (1000)                                    NULL,
    [IsRoundTrip]      BIT                                                DEFAULT 0 NOT NULL,
    [Status]           NVARCHAR (20)                                      DEFAULT 'Recorded' NOT NULL,
    [IsPersonal]       BIT                                                DEFAULT 0 NOT NULL,
    [CreatedBy]        NVARCHAR (255)                                     NULL,
    [CreatedAt]        DATETIME2 (7)                                      DEFAULT SYSDATETIME() NOT NULL,
    [UpdatedAt]        DATETIME2 (7)                                      DEFAULT SYSDATETIME() NOT NULL,
    [ValidFrom]        DATETIME2 (7) GENERATED ALWAYS AS ROW START HIDDEN NOT NULL,
    [ValidTo]          DATETIME2 (7) GENERATED ALWAYS AS ROW END HIDDEN   NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC),
    PERIOD FOR SYSTEM_TIME ([ValidFrom], [ValidTo])
)
WITH (SYSTEM_VERSIONING = ON (HISTORY_TABLE=[dbo].[MileageTrips_History], DATA_CONSISTENCY_CHECK=ON));

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[MileageTrips])
    BEGIN
        IF EXISTS (SELECT TOP 1 1 
                   FROM   [sys].[tables]
                   WHERE  [name] = N'tmp_ms_xx_MileageTrips'
                          AND SCHEMA_NAME(schema_id) = N'dbo'
                          AND temporal_type = 2)
            BEGIN
                ALTER TABLE [dbo].[tmp_ms_xx_MileageTrips] SET (SYSTEM_VERSIONING = OFF);
            END
        IF EXISTS (SELECT TOP 1 1 
                   FROM   [sys].[periods]
                   WHERE  [period_type] = 1
                          AND OBJECT_ID('[dbo].[tmp_ms_xx_MileageTrips]', 'U') = object_id)
            BEGIN
                ALTER TABLE [dbo].[tmp_ms_xx_MileageTrips] DROP PERIOD FOR SYSTEM_TIME;
            END
        INSERT INTO [dbo].[tmp_ms_xx_MileageTrips] ([Id], [VehicleId], [TripDate], [StartLocation], [EndLocation], [StartOdometer], [EndOdometer], [Distance], [Purpose], [Category], [RatePerMile], [DeductibleAmount], [CustomerId], [ProjectId], [Notes], [IsRoundTrip], [Status], [CreatedBy], [CreatedAt], [UpdatedAt], [ValidFrom], [ValidTo])
        SELECT   [Id],
                 [VehicleId],
                 [TripDate],
                 [StartLocation],
                 [EndLocation],
                 [StartOdometer],
                 [EndOdometer],
                 [Distance],
                 [Purpose],
                 [Category],
                 [RatePerMile],
                 [DeductibleAmount],
                 [CustomerId],
                 [ProjectId],
                 [Notes],
                 [IsRoundTrip],
                 [Status],
                 [CreatedBy],
                 [CreatedAt],
                 [UpdatedAt],
                 [ValidFrom],
                 [ValidTo]
        FROM     [dbo].[MileageTrips]
        ORDER BY [Id] ASC;
        ALTER TABLE [dbo].[tmp_ms_xx_MileageTrips]
            ADD PERIOD FOR SYSTEM_TIME ([ValidFrom], [ValidTo]);
        ALTER TABLE [dbo].[tmp_ms_xx_MileageTrips] ALTER COLUMN [ValidFrom] ADD HIDDEN;
        ALTER TABLE [dbo].[tmp_ms_xx_MileageTrips] ALTER COLUMN [ValidTo] ADD HIDDEN;
        ALTER TABLE [dbo].[tmp_ms_xx_MileageTrips] SET (SYSTEM_VERSIONING = ON (HISTORY_TABLE=[dbo].[MileageTrips_History], DATA_CONSISTENCY_CHECK=ON));
    END

IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'MileageTrips'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[MileageTrips] SET (SYSTEM_VERSIONING = OFF);
    END

DROP TABLE [dbo].[MileageTrips];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_MileageTrips]', N'MileageTrips';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating Index [dbo].[MileageTrips].[IX_MileageTrips_Category]...';


GO
CREATE NONCLUSTERED INDEX [IX_MileageTrips_Category]
    ON [dbo].[MileageTrips]([Category] ASC);


GO
PRINT N'Creating Index [dbo].[MileageTrips].[IX_MileageTrips_CustomerId]...';


GO
CREATE NONCLUSTERED INDEX [IX_MileageTrips_CustomerId]
    ON [dbo].[MileageTrips]([CustomerId] ASC) WHERE CustomerId IS NOT NULL;


GO
PRINT N'Creating Index [dbo].[MileageTrips].[IX_MileageTrips_ProjectId]...';


GO
CREATE NONCLUSTERED INDEX [IX_MileageTrips_ProjectId]
    ON [dbo].[MileageTrips]([ProjectId] ASC) WHERE ProjectId IS NOT NULL;


GO
PRINT N'Creating Index [dbo].[MileageTrips].[IX_MileageTrips_Status]...';


GO
CREATE NONCLUSTERED INDEX [IX_MileageTrips_Status]
    ON [dbo].[MileageTrips]([Status] ASC);


GO
PRINT N'Creating Index [dbo].[MileageTrips].[IX_MileageTrips_TripDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_MileageTrips_TripDate]
    ON [dbo].[MileageTrips]([TripDate] DESC);


GO
PRINT N'Creating Index [dbo].[MileageTrips].[IX_MileageTrips_VehicleId]...';


GO
CREATE NONCLUSTERED INDEX [IX_MileageTrips_VehicleId]
    ON [dbo].[MileageTrips]([VehicleId] ASC) WHERE VehicleId IS NOT NULL;


GO
ALTER TABLE [dbo].[MileageTrips] ENABLE CHANGE_TRACKING WITH (TRACK_COLUMNS_UPDATED = ON);


GO
PRINT N'Starting rebuilding table [dbo].[Payments]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Payments] (
    [Id]               UNIQUEIDENTIFIER                                   DEFAULT NEWID() NOT NULL,
    [PaymentNumber]    NVARCHAR (50)                                      NULL,
    [CustomerId]       UNIQUEIDENTIFIER                                   NOT NULL,
    [PaymentDate]      DATE                                               NOT NULL,
    [TotalAmount]      DECIMAL (19, 4)                                    DEFAULT 0 NOT NULL,
    [PaymentMethod]    NVARCHAR (50)                                      NULL,
    [DepositAccountId] UNIQUEIDENTIFIER                                   NULL,
    [Memo]             NVARCHAR (500)                                     NULL,
    [Status]           NVARCHAR (20)                                      DEFAULT 'Completed' NOT NULL,
    [SourceSystem]     NVARCHAR (50)                                      NULL,
    [SourceId]         NVARCHAR (100)                                     NULL,
    [CreatedAt]        DATETIME2 (7)                                      DEFAULT SYSDATETIME() NOT NULL,
    [UpdatedAt]        DATETIME2 (7)                                      DEFAULT SYSDATETIME() NOT NULL,
    [JournalEntryId]   UNIQUEIDENTIFIER                                   NULL,
    [ValidFrom]        DATETIME2 (7) GENERATED ALWAYS AS ROW START HIDDEN NOT NULL,
    [ValidTo]          DATETIME2 (7) GENERATED ALWAYS AS ROW END HIDDEN   NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC),
    PERIOD FOR SYSTEM_TIME ([ValidFrom], [ValidTo])
)
WITH (SYSTEM_VERSIONING = ON (HISTORY_TABLE=[dbo].[Payments_History], DATA_CONSISTENCY_CHECK=ON));

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Payments])
    BEGIN
        IF EXISTS (SELECT TOP 1 1 
                   FROM   [sys].[tables]
                   WHERE  [name] = N'tmp_ms_xx_Payments'
                          AND SCHEMA_NAME(schema_id) = N'dbo'
                          AND temporal_type = 2)
            BEGIN
                ALTER TABLE [dbo].[tmp_ms_xx_Payments] SET (SYSTEM_VERSIONING = OFF);
            END
        IF EXISTS (SELECT TOP 1 1 
                   FROM   [sys].[periods]
                   WHERE  [period_type] = 1
                          AND OBJECT_ID('[dbo].[tmp_ms_xx_Payments]', 'U') = object_id)
            BEGIN
                ALTER TABLE [dbo].[tmp_ms_xx_Payments] DROP PERIOD FOR SYSTEM_TIME;
            END
        INSERT INTO [dbo].[tmp_ms_xx_Payments] ([Id], [PaymentNumber], [CustomerId], [PaymentDate], [TotalAmount], [PaymentMethod], [DepositAccountId], [Memo], [Status], [SourceSystem], [SourceId], [CreatedAt], [UpdatedAt], [ValidFrom], [ValidTo])
        SELECT   [Id],
                 [PaymentNumber],
                 [CustomerId],
                 [PaymentDate],
                 [TotalAmount],
                 [PaymentMethod],
                 [DepositAccountId],
                 [Memo],
                 [Status],
                 [SourceSystem],
                 [SourceId],
                 [CreatedAt],
                 [UpdatedAt],
                 [ValidFrom],
                 [ValidTo]
        FROM     [dbo].[Payments]
        ORDER BY [Id] ASC;
        ALTER TABLE [dbo].[tmp_ms_xx_Payments]
            ADD PERIOD FOR SYSTEM_TIME ([ValidFrom], [ValidTo]);
        ALTER TABLE [dbo].[tmp_ms_xx_Payments] ALTER COLUMN [ValidFrom] ADD HIDDEN;
        ALTER TABLE [dbo].[tmp_ms_xx_Payments] ALTER COLUMN [ValidTo] ADD HIDDEN;
        ALTER TABLE [dbo].[tmp_ms_xx_Payments] SET (SYSTEM_VERSIONING = ON (HISTORY_TABLE=[dbo].[Payments_History], DATA_CONSISTENCY_CHECK=ON));
    END

IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'Payments'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[Payments] SET (SYSTEM_VERSIONING = OFF);
    END

DROP TABLE [dbo].[Payments];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Payments]', N'Payments';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating Index [dbo].[Payments].[IX_Payments_CustomerId]...';


GO
CREATE NONCLUSTERED INDEX [IX_Payments_CustomerId]
    ON [dbo].[Payments]([CustomerId] ASC);


GO
PRINT N'Creating Index [dbo].[Payments].[IX_Payments_PaymentDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_Payments_PaymentDate]
    ON [dbo].[Payments]([PaymentDate] ASC);


GO
PRINT N'Creating Index [dbo].[Payments].[IX_Payments_Source]...';


GO
CREATE NONCLUSTERED INDEX [IX_Payments_Source]
    ON [dbo].[Payments]([SourceSystem] ASC, [SourceId] ASC) WHERE [SourceSystem] IS NOT NULL;


GO
PRINT N'Starting rebuilding table [dbo].[ProductsServices]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_ProductsServices] (
    [Id]                       UNIQUEIDENTIFIER                                   DEFAULT NEWID() NOT NULL,
    [Name]                     NVARCHAR (200)                                     NOT NULL,
    [SKU]                      NVARCHAR (50)                                      NULL,
    [Type]                     NVARCHAR (20)                                      NOT NULL,
    [Description]              NVARCHAR (MAX)                                     NULL,
    [SalesPrice]               DECIMAL (18, 2)                                    NULL,
    [PurchaseCost]             DECIMAL (18, 2)                                    NULL,
    [IncomeAccountId]          UNIQUEIDENTIFIER                                   NULL,
    [ExpenseAccountId]         UNIQUEIDENTIFIER                                   NULL,
    [InventoryAssetAccountId]  UNIQUEIDENTIFIER                                   NULL,
    [Category]                 NVARCHAR (100)                                     NULL,
    [Taxable]                  BIT                                                DEFAULT 1 NOT NULL,
    [Status]                   NVARCHAR (20)                                      DEFAULT 'Active' NOT NULL,
    [CreatedAt]                DATETIME2 (7)                                      DEFAULT SYSDATETIME() NOT NULL,
    [QuantityOnHand]           DECIMAL (18, 4)                                    DEFAULT 0 NULL,
    [ReorderPoint]             DECIMAL (18, 4)                                    NULL,
    [InventoryValuationMethod] NVARCHAR (20)                                      DEFAULT 'AverageCost' NULL,
    [DefaultLocationId]        UNIQUEIDENTIFIER                                   NULL,
    [TenantId]                 UNIQUEIDENTIFIER                                   NULL,
    [SourceSystem]             NVARCHAR (50)                                      NULL,
    [SourceId]                 NVARCHAR (100)                                     NULL,
    [ValidFrom]                DATETIME2 (7) GENERATED ALWAYS AS ROW START HIDDEN NOT NULL,
    [ValidTo]                  DATETIME2 (7) GENERATED ALWAYS AS ROW END HIDDEN   NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC),
    PERIOD FOR SYSTEM_TIME ([ValidFrom], [ValidTo])
)
WITH (SYSTEM_VERSIONING = ON (HISTORY_TABLE=[dbo].[ProductsServices_History], DATA_CONSISTENCY_CHECK=ON));

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[ProductsServices])
    BEGIN
        IF EXISTS (SELECT TOP 1 1 
                   FROM   [sys].[tables]
                   WHERE  [name] = N'tmp_ms_xx_ProductsServices'
                          AND SCHEMA_NAME(schema_id) = N'dbo'
                          AND temporal_type = 2)
            BEGIN
                ALTER TABLE [dbo].[tmp_ms_xx_ProductsServices] SET (SYSTEM_VERSIONING = OFF);
            END
        IF EXISTS (SELECT TOP 1 1 
                   FROM   [sys].[periods]
                   WHERE  [period_type] = 1
                          AND OBJECT_ID('[dbo].[tmp_ms_xx_ProductsServices]', 'U') = object_id)
            BEGIN
                ALTER TABLE [dbo].[tmp_ms_xx_ProductsServices] DROP PERIOD FOR SYSTEM_TIME;
            END
        INSERT INTO [dbo].[tmp_ms_xx_ProductsServices] ([Id], [Name], [SKU], [Type], [Description], [SalesPrice], [PurchaseCost], [IncomeAccountId], [ExpenseAccountId], [InventoryAssetAccountId], [Category], [Taxable], [Status], [CreatedAt], [QuantityOnHand], [ReorderPoint], [InventoryValuationMethod], [DefaultLocationId], [TenantId], [ValidFrom], [ValidTo], [SourceSystem], [SourceId])
        SELECT   [Id],
                 [Name],
                 [SKU],
                 [Type],
                 [Description],
                 [SalesPrice],
                 [PurchaseCost],
                 [IncomeAccountId],
                 [ExpenseAccountId],
                 [InventoryAssetAccountId],
                 [Category],
                 [Taxable],
                 [Status],
                 [CreatedAt],
                 [QuantityOnHand],
                 [ReorderPoint],
                 [InventoryValuationMethod],
                 [DefaultLocationId],
                 [TenantId],
                 [ValidFrom],
                 [ValidTo],
                 [SourceSystem],
                 [SourceId]
        FROM     [dbo].[ProductsServices]
        ORDER BY [Id] ASC;
        ALTER TABLE [dbo].[tmp_ms_xx_ProductsServices]
            ADD PERIOD FOR SYSTEM_TIME ([ValidFrom], [ValidTo]);
        ALTER TABLE [dbo].[tmp_ms_xx_ProductsServices] ALTER COLUMN [ValidFrom] ADD HIDDEN;
        ALTER TABLE [dbo].[tmp_ms_xx_ProductsServices] ALTER COLUMN [ValidTo] ADD HIDDEN;
        ALTER TABLE [dbo].[tmp_ms_xx_ProductsServices] SET (SYSTEM_VERSIONING = ON (HISTORY_TABLE=[dbo].[ProductsServices_History], DATA_CONSISTENCY_CHECK=ON));
    END

IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'ProductsServices'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[ProductsServices] SET (SYSTEM_VERSIONING = OFF);
    END

DROP TABLE [dbo].[ProductsServices];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_ProductsServices]', N'ProductsServices';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating Index [dbo].[ProductsServices].[IX_ProductsServices_QuantityOnHand]...';


GO
CREATE NONCLUSTERED INDEX [IX_ProductsServices_QuantityOnHand]
    ON [dbo].[ProductsServices]([QuantityOnHand] ASC) WHERE [Type] = 'Inventory';


GO
PRINT N'Creating Index [dbo].[ProductsServices].[IX_ProductsServices_SKU]...';


GO
CREATE NONCLUSTERED INDEX [IX_ProductsServices_SKU]
    ON [dbo].[ProductsServices]([SKU] ASC) WHERE [SKU] IS NOT NULL;


GO
PRINT N'Creating Index [dbo].[ProductsServices].[IX_ProductsServices_Source]...';


GO
CREATE NONCLUSTERED INDEX [IX_ProductsServices_Source]
    ON [dbo].[ProductsServices]([SourceSystem] ASC, [SourceId] ASC) WHERE [SourceSystem] IS NOT NULL;


GO
PRINT N'Creating Index [dbo].[ProductsServices].[IX_ProductsServices_Status]...';


GO
CREATE NONCLUSTERED INDEX [IX_ProductsServices_Status]
    ON [dbo].[ProductsServices]([Status] ASC);


GO
PRINT N'Creating Index [dbo].[ProductsServices].[IX_ProductsServices_Type]...';


GO
CREATE NONCLUSTERED INDEX [IX_ProductsServices_Type]
    ON [dbo].[ProductsServices]([Type] ASC);


GO
PRINT N'Starting rebuilding table [dbo].[SalesReceipts]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_SalesReceipts] (
    [Id]                 UNIQUEIDENTIFIER                                   DEFAULT NEWID() NOT NULL,
    [SalesReceiptNumber] NVARCHAR (50)                                      NOT NULL,
    [CustomerId]         UNIQUEIDENTIFIER                                   NULL,
    [SaleDate]           DATE                                               NOT NULL,
    [DepositAccountId]   UNIQUEIDENTIFIER                                   NOT NULL,
    [PaymentMethod]      NVARCHAR (50)                                      NULL,
    [Reference]          NVARCHAR (100)                                     NULL,
    [Subtotal]           DECIMAL (19, 4)                                    DEFAULT 0 NOT NULL,
    [TaxRateId]          UNIQUEIDENTIFIER                                   NULL,
    [TaxAmount]          DECIMAL (19, 4)                                    DEFAULT 0 NOT NULL,
    [TotalAmount]        DECIMAL (19, 4)                                    DEFAULT 0 NOT NULL,
    [Memo]               NVARCHAR (500)                                     NULL,
    [Status]             NVARCHAR (20)                                      DEFAULT 'Completed' NOT NULL,
    [JournalEntryId]     UNIQUEIDENTIFIER                                   NULL,
    [ClassId]            UNIQUEIDENTIFIER                                   NULL,
    [LocationId]         UNIQUEIDENTIFIER                                   NULL,
    [SourceSystem]       NVARCHAR (50)                                      NULL,
    [SourceId]           NVARCHAR (100)                                     NULL,
    [TenantId]           UNIQUEIDENTIFIER                                   NULL,
    [IsPersonal]         BIT                                                DEFAULT 0 NOT NULL,
    [CreatedAt]          DATETIME2 (7)                                      DEFAULT SYSDATETIME() NOT NULL,
    [UpdatedAt]          DATETIME2 (7)                                      DEFAULT SYSDATETIME() NOT NULL,
    [ValidFrom]          DATETIME2 (7) GENERATED ALWAYS AS ROW START HIDDEN NOT NULL,
    [ValidTo]            DATETIME2 (7) GENERATED ALWAYS AS ROW END HIDDEN   NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC),
    PERIOD FOR SYSTEM_TIME ([ValidFrom], [ValidTo])
)
WITH (SYSTEM_VERSIONING = ON (HISTORY_TABLE=[dbo].[SalesReceipts_History], DATA_CONSISTENCY_CHECK=ON));

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[SalesReceipts])
    BEGIN
        IF EXISTS (SELECT TOP 1 1 
                   FROM   [sys].[tables]
                   WHERE  [name] = N'tmp_ms_xx_SalesReceipts'
                          AND SCHEMA_NAME(schema_id) = N'dbo'
                          AND temporal_type = 2)
            BEGIN
                ALTER TABLE [dbo].[tmp_ms_xx_SalesReceipts] SET (SYSTEM_VERSIONING = OFF);
            END
        IF EXISTS (SELECT TOP 1 1 
                   FROM   [sys].[periods]
                   WHERE  [period_type] = 1
                          AND OBJECT_ID('[dbo].[tmp_ms_xx_SalesReceipts]', 'U') = object_id)
            BEGIN
                ALTER TABLE [dbo].[tmp_ms_xx_SalesReceipts] DROP PERIOD FOR SYSTEM_TIME;
            END
        INSERT INTO [dbo].[tmp_ms_xx_SalesReceipts] ([Id], [SalesReceiptNumber], [CustomerId], [SaleDate], [DepositAccountId], [PaymentMethod], [Reference], [Subtotal], [TaxRateId], [TaxAmount], [TotalAmount], [Memo], [Status], [JournalEntryId], [ClassId], [LocationId], [SourceSystem], [SourceId], [TenantId], [CreatedAt], [UpdatedAt], [ValidFrom], [ValidTo])
        SELECT   [Id],
                 [SalesReceiptNumber],
                 [CustomerId],
                 [SaleDate],
                 [DepositAccountId],
                 [PaymentMethod],
                 [Reference],
                 [Subtotal],
                 [TaxRateId],
                 [TaxAmount],
                 [TotalAmount],
                 [Memo],
                 [Status],
                 [JournalEntryId],
                 [ClassId],
                 [LocationId],
                 [SourceSystem],
                 [SourceId],
                 [TenantId],
                 [CreatedAt],
                 [UpdatedAt],
                 [ValidFrom],
                 [ValidTo]
        FROM     [dbo].[SalesReceipts]
        ORDER BY [Id] ASC;
        ALTER TABLE [dbo].[tmp_ms_xx_SalesReceipts]
            ADD PERIOD FOR SYSTEM_TIME ([ValidFrom], [ValidTo]);
        ALTER TABLE [dbo].[tmp_ms_xx_SalesReceipts] ALTER COLUMN [ValidFrom] ADD HIDDEN;
        ALTER TABLE [dbo].[tmp_ms_xx_SalesReceipts] ALTER COLUMN [ValidTo] ADD HIDDEN;
        ALTER TABLE [dbo].[tmp_ms_xx_SalesReceipts] SET (SYSTEM_VERSIONING = ON (HISTORY_TABLE=[dbo].[SalesReceipts_History], DATA_CONSISTENCY_CHECK=ON));
    END

IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'SalesReceipts'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[SalesReceipts] SET (SYSTEM_VERSIONING = OFF);
    END

DROP TABLE [dbo].[SalesReceipts];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_SalesReceipts]', N'SalesReceipts';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating Index [dbo].[SalesReceipts].[IX_SalesReceipts_CustomerId]...';


GO
CREATE NONCLUSTERED INDEX [IX_SalesReceipts_CustomerId]
    ON [dbo].[SalesReceipts]([CustomerId] ASC) WHERE [CustomerId] IS NOT NULL;


GO
PRINT N'Creating Index [dbo].[SalesReceipts].[IX_SalesReceipts_DepositAccountId]...';


GO
CREATE NONCLUSTERED INDEX [IX_SalesReceipts_DepositAccountId]
    ON [dbo].[SalesReceipts]([DepositAccountId] ASC);


GO
PRINT N'Creating Index [dbo].[SalesReceipts].[IX_SalesReceipts_SaleDate]...';


GO
CREATE NONCLUSTERED INDEX [IX_SalesReceipts_SaleDate]
    ON [dbo].[SalesReceipts]([SaleDate] DESC);


GO
PRINT N'Creating Index [dbo].[SalesReceipts].[IX_SalesReceipts_Source]...';


GO
CREATE NONCLUSTERED INDEX [IX_SalesReceipts_Source]
    ON [dbo].[SalesReceipts]([SourceSystem] ASC, [SourceId] ASC) WHERE [SourceSystem] IS NOT NULL;


GO
PRINT N'Creating Index [dbo].[SalesReceipts].[IX_SalesReceipts_Status]...';


GO
CREATE NONCLUSTERED INDEX [IX_SalesReceipts_Status]
    ON [dbo].[SalesReceipts]([Status] ASC);


GO
PRINT N'Creating Index [dbo].[SalesReceipts].[IX_SalesReceipts_TenantId]...';


GO
CREATE NONCLUSTERED INDEX [IX_SalesReceipts_TenantId]
    ON [dbo].[SalesReceipts]([TenantId] ASC) WHERE [TenantId] IS NOT NULL;


GO
ALTER TABLE [dbo].[SalesReceipts] ENABLE CHANGE_TRACKING WITH (TRACK_COLUMNS_UPDATED = ON);


GO
PRINT N'Starting rebuilding table [dbo].[Vendors]...';


GO
BEGIN TRANSACTION;

SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;

SET XACT_ABORT ON;

CREATE TABLE [dbo].[tmp_ms_xx_Vendors] (
    [Id]                      UNIQUEIDENTIFIER                                   DEFAULT NEWID() NOT NULL,
    [Name]                    NVARCHAR (100)                                     NOT NULL,
    [Email]                   NVARCHAR (100)                                     NULL,
    [Phone]                   NVARCHAR (20)                                      NULL,
    [Address]                 NVARCHAR (500)                                     NULL,
    [PaymentTerms]            NVARCHAR (50)                                      NULL,
    [TaxId]                   NVARCHAR (50)                                      NULL,
    [Is1099Vendor]            BIT                                                DEFAULT 0 NOT NULL,
    [DefaultExpenseAccountId] UNIQUEIDENTIFIER                                   NULL,
    [Status]                  NVARCHAR (20)                                      DEFAULT 'Active' NOT NULL,
    [CreatedAt]               DATETIME2 (7)                                      DEFAULT SYSDATETIME() NOT NULL,
    [UpdatedAt]               DATETIME2 (7)                                      DEFAULT SYSDATETIME() NOT NULL,
    [TenantId]                UNIQUEIDENTIFIER                                   NULL,
    [AddressLine1]            NVARCHAR (100)                                     NULL,
    [AddressLine2]            NVARCHAR (100)                                     NULL,
    [City]                    NVARCHAR (50)                                      NULL,
    [State]                   NVARCHAR (50)                                      NULL,
    [PostalCode]              NVARCHAR (20)                                      NULL,
    [Country]                 NVARCHAR (50)                                      DEFAULT ('US') NULL,
    [SourceSystem]            NVARCHAR (50)                                      NULL,
    [SourceId]                NVARCHAR (100)                                     NULL,
    [ValidFrom]               DATETIME2 (7) GENERATED ALWAYS AS ROW START HIDDEN NOT NULL,
    [ValidTo]                 DATETIME2 (7) GENERATED ALWAYS AS ROW END HIDDEN   NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC),
    PERIOD FOR SYSTEM_TIME ([ValidFrom], [ValidTo])
)
WITH (SYSTEM_VERSIONING = ON (HISTORY_TABLE=[dbo].[Vendors_History], DATA_CONSISTENCY_CHECK=ON));

IF EXISTS (SELECT TOP 1 1 
           FROM   [dbo].[Vendors])
    BEGIN
        IF EXISTS (SELECT TOP 1 1 
                   FROM   [sys].[tables]
                   WHERE  [name] = N'tmp_ms_xx_Vendors'
                          AND SCHEMA_NAME(schema_id) = N'dbo'
                          AND temporal_type = 2)
            BEGIN
                ALTER TABLE [dbo].[tmp_ms_xx_Vendors] SET (SYSTEM_VERSIONING = OFF);
            END
        IF EXISTS (SELECT TOP 1 1 
                   FROM   [sys].[periods]
                   WHERE  [period_type] = 1
                          AND OBJECT_ID('[dbo].[tmp_ms_xx_Vendors]', 'U') = object_id)
            BEGIN
                ALTER TABLE [dbo].[tmp_ms_xx_Vendors] DROP PERIOD FOR SYSTEM_TIME;
            END
        INSERT INTO [dbo].[tmp_ms_xx_Vendors] ([Id], [Name], [Email], [Phone], [Address], [PaymentTerms], [TaxId], [Is1099Vendor], [DefaultExpenseAccountId], [Status], [CreatedAt], [UpdatedAt], [TenantId], [AddressLine1], [AddressLine2], [City], [State], [PostalCode], [Country], [ValidFrom], [ValidTo], [SourceSystem], [SourceId])
        SELECT   [Id],
                 [Name],
                 [Email],
                 [Phone],
                 [Address],
                 [PaymentTerms],
                 [TaxId],
                 [Is1099Vendor],
                 [DefaultExpenseAccountId],
                 [Status],
                 [CreatedAt],
                 [UpdatedAt],
                 [TenantId],
                 [AddressLine1],
                 [AddressLine2],
                 [City],
                 [State],
                 [PostalCode],
                 [Country],
                 [ValidFrom],
                 [ValidTo],
                 [SourceSystem],
                 [SourceId]
        FROM     [dbo].[Vendors]
        ORDER BY [Id] ASC;
        ALTER TABLE [dbo].[tmp_ms_xx_Vendors]
            ADD PERIOD FOR SYSTEM_TIME ([ValidFrom], [ValidTo]);
        ALTER TABLE [dbo].[tmp_ms_xx_Vendors] ALTER COLUMN [ValidFrom] ADD HIDDEN;
        ALTER TABLE [dbo].[tmp_ms_xx_Vendors] ALTER COLUMN [ValidTo] ADD HIDDEN;
        ALTER TABLE [dbo].[tmp_ms_xx_Vendors] SET (SYSTEM_VERSIONING = ON (HISTORY_TABLE=[dbo].[Vendors_History], DATA_CONSISTENCY_CHECK=ON));
    END

IF EXISTS (SELECT TOP 1 1 
           FROM   [sys].[tables]
           WHERE  [name] = N'Vendors'
                  AND SCHEMA_NAME(schema_id) = N'dbo'
                  AND temporal_type = 2)
    BEGIN
        ALTER TABLE [dbo].[Vendors] SET (SYSTEM_VERSIONING = OFF);
    END

DROP TABLE [dbo].[Vendors];

EXECUTE sp_rename N'[dbo].[tmp_ms_xx_Vendors]', N'Vendors';

COMMIT TRANSACTION;

SET TRANSACTION ISOLATION LEVEL READ COMMITTED;


GO
PRINT N'Creating Index [dbo].[Vendors].[IX_Vendors_Is1099Vendor]...';


GO
CREATE NONCLUSTERED INDEX [IX_Vendors_Is1099Vendor]
    ON [dbo].[Vendors]([Is1099Vendor] ASC) WHERE [Is1099Vendor] = 1;


GO
PRINT N'Creating Index [dbo].[Vendors].[IX_Vendors_Name]...';


GO
CREATE NONCLUSTERED INDEX [IX_Vendors_Name]
    ON [dbo].[Vendors]([Name] ASC);


GO
PRINT N'Creating Index [dbo].[Vendors].[IX_Vendors_Source]...';


GO
CREATE NONCLUSTERED INDEX [IX_Vendors_Source]
    ON [dbo].[Vendors]([SourceSystem] ASC, [SourceId] ASC) WHERE [SourceSystem] IS NOT NULL;


GO
PRINT N'Creating Index [dbo].[Vendors].[IX_Vendors_Status]...';


GO
CREATE NONCLUSTERED INDEX [IX_Vendors_Status]
    ON [dbo].[Vendors]([Status] ASC);


GO
ALTER TABLE [dbo].[Vendors] ENABLE CHANGE_TRACKING WITH (TRACK_COLUMNS_UPDATED = OFF);


GO
PRINT N'Adding system-versioning to [dbo].[Companies]...';


GO
ALTER TABLE [dbo].[Companies] SET (SYSTEM_VERSIONING = ON (HISTORY_TABLE=[dbo].[Companies_History], DATA_CONSISTENCY_CHECK=ON));


GO
PRINT N'Creating Default Constraint unnamed constraint on [dbo].[PlaidAccounts]...';


GO
ALTER TABLE [dbo].[PlaidAccounts]
    ADD DEFAULT GETUTCDATE() FOR [CreatedAt];


GO
PRINT N'Creating Default Constraint unnamed constraint on [dbo].[PlaidAccounts]...';


GO
ALTER TABLE [dbo].[PlaidAccounts]
    ADD DEFAULT 'USD' FOR [CurrencyCode];


GO
PRINT N'Creating Default Constraint unnamed constraint on [dbo].[PlaidAccounts]...';


GO
ALTER TABLE [dbo].[PlaidAccounts]
    ADD DEFAULT 1 FOR [IsActive];


GO
PRINT N'Creating Default Constraint unnamed constraint on [dbo].[PlaidAccounts]...';


GO
ALTER TABLE [dbo].[PlaidAccounts]
    ADD DEFAULT GETUTCDATE() FOR [UpdatedAt];


GO
PRINT N'Creating Default Constraint unnamed constraint on [dbo].[PlaidConnections]...';


GO
ALTER TABLE [dbo].[PlaidConnections]
    ADD DEFAULT GETUTCDATE() FOR [CreatedAt];


GO
PRINT N'Creating Default Constraint unnamed constraint on [dbo].[PlaidConnections]...';


GO
ALTER TABLE [dbo].[PlaidConnections]
    ADD DEFAULT 1 FOR [IsActive];


GO
PRINT N'Creating Default Constraint unnamed constraint on [dbo].[PlaidConnections]...';


GO
ALTER TABLE [dbo].[PlaidConnections]
    ADD DEFAULT 'Pending' FOR [SyncStatus];


GO
PRINT N'Creating Default Constraint unnamed constraint on [dbo].[PlaidConnections]...';


GO
ALTER TABLE [dbo].[PlaidConnections]
    ADD DEFAULT GETUTCDATE() FOR [UpdatedAt];


GO
PRINT N'Creating Default Constraint unnamed constraint on [dbo].[QBOConnections]...';


GO
ALTER TABLE [dbo].[QBOConnections]
    ADD DEFAULT GETUTCDATE() FOR [CreatedAt];


GO
PRINT N'Creating Default Constraint unnamed constraint on [dbo].[QBOConnections]...';


GO
ALTER TABLE [dbo].[QBOConnections]
    ADD DEFAULT 'sandbox' FOR [Environment];


GO
PRINT N'Creating Default Constraint unnamed constraint on [dbo].[QBOConnections]...';


GO
ALTER TABLE [dbo].[QBOConnections]
    ADD DEFAULT 1 FOR [IsActive];


GO
PRINT N'Creating Default Constraint unnamed constraint on [dbo].[QBOConnections]...';


GO
ALTER TABLE [dbo].[QBOConnections]
    ADD DEFAULT GETUTCDATE() FOR [UpdatedAt];


GO
PRINT N'Creating Default Constraint unnamed constraint on [dbo].[VendorCredits]...';


GO
ALTER TABLE [dbo].[VendorCredits]
    ADD DEFAULT 0 FOR [AmountApplied];


GO
PRINT N'Creating Default Constraint unnamed constraint on [dbo].[VendorCredits]...';


GO
ALTER TABLE [dbo].[VendorCredits]
    ADD DEFAULT SYSDATETIME() FOR [CreatedAt];


GO
PRINT N'Creating Default Constraint unnamed constraint on [dbo].[VendorCredits]...';


GO
ALTER TABLE [dbo].[VendorCredits]
    ADD DEFAULT 'Open' FOR [Status];


GO
PRINT N'Creating Default Constraint unnamed constraint on [dbo].[VendorCredits]...';


GO
ALTER TABLE [dbo].[VendorCredits]
    ADD DEFAULT 0 FOR [TaxAmount];


GO
PRINT N'Creating Default Constraint unnamed constraint on [dbo].[VendorCredits]...';


GO
ALTER TABLE [dbo].[VendorCredits]
    ADD DEFAULT SYSDATETIME() FOR [UpdatedAt];


GO
PRINT N'Creating Default Constraint unnamed constraint on [dbo].[YearEndCloseEntries]...';


GO
ALTER TABLE [dbo].[YearEndCloseEntries]
    ADD DEFAULT NEWID() FOR [Id];


GO
PRINT N'Creating Default Constraint unnamed constraint on [dbo].[YearEndCloseEntries]...';


GO
ALTER TABLE [dbo].[YearEndCloseEntries]
    ADD DEFAULT 0 FOR [TotalExpenses];


GO
PRINT N'Creating Default Constraint unnamed constraint on [dbo].[YearEndCloseEntries]...';


GO
ALTER TABLE [dbo].[YearEndCloseEntries]
    ADD DEFAULT 0 FOR [TotalRevenue];


GO
PRINT N'Creating Default Constraint unnamed constraint on [dbo].[YearEndCloseEntries]...';


GO
ALTER TABLE [dbo].[YearEndCloseEntries]
    ADD DEFAULT SYSDATETIME() FOR [CreatedAt];


GO
PRINT N'Creating Default Constraint unnamed constraint on [dbo].[YearEndCloseEntries]...';


GO
ALTER TABLE [dbo].[YearEndCloseEntries]
    ADD DEFAULT 'Posted' FOR [Status];


GO
PRINT N'Creating Foreign Key [dbo].[FK_ProductsServices_InventoryAssetAccount]...';


GO
ALTER TABLE [dbo].[ProductsServices] WITH NOCHECK
    ADD CONSTRAINT [FK_ProductsServices_InventoryAssetAccount] FOREIGN KEY ([InventoryAssetAccountId]) REFERENCES [dbo].[Accounts] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_Refunds_PaymentAccount]...';


GO
ALTER TABLE [dbo].[Refunds] WITH NOCHECK
    ADD CONSTRAINT [FK_Refunds_PaymentAccount] FOREIGN KEY ([PaymentAccountId]) REFERENCES [dbo].[Accounts] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_Vendors_DefaultExpenseAccount]...';


GO
ALTER TABLE [dbo].[Vendors] WITH NOCHECK
    ADD CONSTRAINT [FK_Vendors_DefaultExpenseAccount] FOREIGN KEY ([DefaultExpenseAccountId]) REFERENCES [dbo].[Accounts] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_BankTransactions_SourceAccount]...';


GO
ALTER TABLE [dbo].[BankTransactions] WITH NOCHECK
    ADD CONSTRAINT [FK_BankTransactions_SourceAccount] FOREIGN KEY ([SourceAccountId]) REFERENCES [dbo].[Accounts] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_Expenses_Accounts]...';


GO
ALTER TABLE [dbo].[Expenses] WITH NOCHECK
    ADD CONSTRAINT [FK_Expenses_Accounts] FOREIGN KEY ([AccountId]) REFERENCES [dbo].[Accounts] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_BankRules_BankAccount]...';


GO
ALTER TABLE [dbo].[BankRules] WITH NOCHECK
    ADD CONSTRAINT [FK_BankRules_BankAccount] FOREIGN KEY ([BankAccountId]) REFERENCES [dbo].[Accounts] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_VendorCreditLines_Accounts]...';


GO
ALTER TABLE [dbo].[VendorCreditLines] WITH NOCHECK
    ADD CONSTRAINT [FK_VendorCreditLines_Accounts] FOREIGN KEY ([AccountId]) REFERENCES [dbo].[Accounts] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_Expenses_PaymentAccounts]...';


GO
ALTER TABLE [dbo].[Expenses] WITH NOCHECK
    ADD CONSTRAINT [FK_Expenses_PaymentAccounts] FOREIGN KEY ([PaymentAccountId]) REFERENCES [dbo].[Accounts] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_BankRules_AssignAccount]...';


GO
ALTER TABLE [dbo].[BankRules] WITH NOCHECK
    ADD CONSTRAINT [FK_BankRules_AssignAccount] FOREIGN KEY ([AssignAccountId]) REFERENCES [dbo].[Accounts] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_SalesReceipts_DepositAccount]...';


GO
ALTER TABLE [dbo].[SalesReceipts] WITH NOCHECK
    ADD CONSTRAINT [FK_SalesReceipts_DepositAccount] FOREIGN KEY ([DepositAccountId]) REFERENCES [dbo].[Accounts] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_PlaidAccounts_LinkedAccount]...';


GO
ALTER TABLE [dbo].[PlaidAccounts] WITH NOCHECK
    ADD CONSTRAINT [FK_PlaidAccounts_LinkedAccount] FOREIGN KEY ([LinkedAccountId]) REFERENCES [dbo].[Accounts] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_BankTransactions_SuggestedAccount]...';


GO
ALTER TABLE [dbo].[BankTransactions] WITH NOCHECK
    ADD CONSTRAINT [FK_BankTransactions_SuggestedAccount] FOREIGN KEY ([SuggestedAccountId]) REFERENCES [dbo].[Accounts] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_BankReconciliations_BankAccount]...';


GO
ALTER TABLE [dbo].[BankReconciliations] WITH NOCHECK
    ADD CONSTRAINT [FK_BankReconciliations_BankAccount] FOREIGN KEY ([BankAccountId]) REFERENCES [dbo].[Accounts] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_Payments_Accounts]...';


GO
ALTER TABLE [dbo].[Payments] WITH NOCHECK
    ADD CONSTRAINT [FK_Payments_Accounts] FOREIGN KEY ([DepositAccountId]) REFERENCES [dbo].[Accounts] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_BillPayments_Accounts]...';


GO
ALTER TABLE [dbo].[BillPayments] WITH NOCHECK
    ADD CONSTRAINT [FK_BillPayments_Accounts] FOREIGN KEY ([PaymentAccountId]) REFERENCES [dbo].[Accounts] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_CreditMemoLines_Accounts]...';


GO
ALTER TABLE [dbo].[CreditMemoLines] WITH NOCHECK
    ADD CONSTRAINT [FK_CreditMemoLines_Accounts] FOREIGN KEY ([AccountId]) REFERENCES [dbo].[Accounts] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_BillLines_Accounts]...';


GO
ALTER TABLE [dbo].[BillLines] WITH NOCHECK
    ADD CONSTRAINT [FK_BillLines_Accounts] FOREIGN KEY ([AccountId]) REFERENCES [dbo].[Accounts] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_ProductsServices_IncomeAccount]...';


GO
ALTER TABLE [dbo].[ProductsServices] WITH NOCHECK
    ADD CONSTRAINT [FK_ProductsServices_IncomeAccount] FOREIGN KEY ([IncomeAccountId]) REFERENCES [dbo].[Accounts] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_BankTransactions_ApprovedAccount]...';


GO
ALTER TABLE [dbo].[BankTransactions] WITH NOCHECK
    ADD CONSTRAINT [FK_BankTransactions_ApprovedAccount] FOREIGN KEY ([ApprovedAccountId]) REFERENCES [dbo].[Accounts] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_CustomerDeposits_DepositAccount]...';


GO
ALTER TABLE [dbo].[CustomerDeposits] WITH NOCHECK
    ADD CONSTRAINT [FK_CustomerDeposits_DepositAccount] FOREIGN KEY ([DepositAccountId]) REFERENCES [dbo].[Accounts] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_CustomerDeposits_LiabilityAccount]...';


GO
ALTER TABLE [dbo].[CustomerDeposits] WITH NOCHECK
    ADD CONSTRAINT [FK_CustomerDeposits_LiabilityAccount] FOREIGN KEY ([LiabilityAccountId]) REFERENCES [dbo].[Accounts] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_SalesReceiptLines_Accounts]...';


GO
ALTER TABLE [dbo].[SalesReceiptLines] WITH NOCHECK
    ADD CONSTRAINT [FK_SalesReceiptLines_Accounts] FOREIGN KEY ([AccountId]) REFERENCES [dbo].[Accounts] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_ProductsServices_ExpenseAccount]...';


GO
ALTER TABLE [dbo].[ProductsServices] WITH NOCHECK
    ADD CONSTRAINT [FK_ProductsServices_ExpenseAccount] FOREIGN KEY ([ExpenseAccountId]) REFERENCES [dbo].[Accounts] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_InvoiceLines_RevenueAccount]...';


GO
ALTER TABLE [dbo].[InvoiceLines] WITH NOCHECK
    ADD CONSTRAINT [FK_InvoiceLines_RevenueAccount] FOREIGN KEY ([RevenueAccountId]) REFERENCES [dbo].[Accounts] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_BankTransactionImports_Accounts]...';


GO
ALTER TABLE [dbo].[BankTransactionImports] WITH NOCHECK
    ADD CONSTRAINT [FK_BankTransactionImports_Accounts] FOREIGN KEY ([BankAccountId]) REFERENCES [dbo].[Accounts] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_Bills_Vendors]...';


GO
ALTER TABLE [dbo].[Bills] WITH NOCHECK
    ADD CONSTRAINT [FK_Bills_Vendors] FOREIGN KEY ([VendorId]) REFERENCES [dbo].[Vendors] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_PurchaseOrders_Bills]...';


GO
ALTER TABLE [dbo].[PurchaseOrders] WITH NOCHECK
    ADD CONSTRAINT [FK_PurchaseOrders_Bills] FOREIGN KEY ([ConvertedToBillId]) REFERENCES [dbo].[Bills] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_BillLines_Bills]...';


GO
ALTER TABLE [dbo].[BillLines] WITH NOCHECK
    ADD CONSTRAINT [FK_BillLines_Bills] FOREIGN KEY ([BillId]) REFERENCES [dbo].[Bills] ([Id]) ON DELETE CASCADE;


GO
PRINT N'Creating Foreign Key [dbo].[FK_BillPaymentApplications_Bills]...';


GO
ALTER TABLE [dbo].[BillPaymentApplications] WITH NOCHECK
    ADD CONSTRAINT [FK_BillPaymentApplications_Bills] FOREIGN KEY ([BillId]) REFERENCES [dbo].[Bills] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_VendorCreditApplications_Bills]...';


GO
ALTER TABLE [dbo].[VendorCreditApplications] WITH NOCHECK
    ADD CONSTRAINT [FK_VendorCreditApplications_Bills] FOREIGN KEY ([BillId]) REFERENCES [dbo].[Bills] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_MileageTrips_Customers]...';


GO
ALTER TABLE [dbo].[MileageTrips] WITH NOCHECK
    ADD CONSTRAINT [FK_MileageTrips_Customers] FOREIGN KEY ([CustomerId]) REFERENCES [dbo].[Customers] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_Invoices_Customers]...';


GO
ALTER TABLE [dbo].[Invoices] WITH NOCHECK
    ADD CONSTRAINT [FK_Invoices_Customers] FOREIGN KEY ([CustomerId]) REFERENCES [dbo].[Customers] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_Estimates_Customers]...';


GO
ALTER TABLE [dbo].[Estimates] WITH NOCHECK
    ADD CONSTRAINT [FK_Estimates_Customers] FOREIGN KEY ([CustomerId]) REFERENCES [dbo].[Customers] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_SalesReceipts_Customers]...';


GO
ALTER TABLE [dbo].[SalesReceipts] WITH NOCHECK
    ADD CONSTRAINT [FK_SalesReceipts_Customers] FOREIGN KEY ([CustomerId]) REFERENCES [dbo].[Customers] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_CreditMemos_Customers]...';


GO
ALTER TABLE [dbo].[CreditMemos] WITH NOCHECK
    ADD CONSTRAINT [FK_CreditMemos_Customers] FOREIGN KEY ([CustomerId]) REFERENCES [dbo].[Customers] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_Payments_Customers]...';


GO
ALTER TABLE [dbo].[Payments] WITH NOCHECK
    ADD CONSTRAINT [FK_Payments_Customers] FOREIGN KEY ([CustomerId]) REFERENCES [dbo].[Customers] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_Expenses_Customers]...';


GO
ALTER TABLE [dbo].[Expenses] WITH NOCHECK
    ADD CONSTRAINT [FK_Expenses_Customers] FOREIGN KEY ([CustomerId]) REFERENCES [dbo].[Customers] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_BankRules_AssignCustomer]...';


GO
ALTER TABLE [dbo].[BankRules] WITH NOCHECK
    ADD CONSTRAINT [FK_BankRules_AssignCustomer] FOREIGN KEY ([AssignCustomerId]) REFERENCES [dbo].[Customers] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_CustomerDeposits_Customers]...';


GO
ALTER TABLE [dbo].[CustomerDeposits] WITH NOCHECK
    ADD CONSTRAINT [FK_CustomerDeposits_Customers] FOREIGN KEY ([CustomerId]) REFERENCES [dbo].[Customers] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_TimeEntries_Customers]...';


GO
ALTER TABLE [dbo].[TimeEntries] WITH NOCHECK
    ADD CONSTRAINT [FK_TimeEntries_Customers] FOREIGN KEY ([CustomerId]) REFERENCES [dbo].[Customers] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_Projects_Customers]...';


GO
ALTER TABLE [dbo].[Projects] WITH NOCHECK
    ADD CONSTRAINT [FK_Projects_Customers] FOREIGN KEY ([CustomerId]) REFERENCES [dbo].[Customers] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_Refunds_Customers]...';


GO
ALTER TABLE [dbo].[Refunds] WITH NOCHECK
    ADD CONSTRAINT [FK_Refunds_Customers] FOREIGN KEY ([CustomerId]) REFERENCES [dbo].[Customers] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_EmployeeWorkStates_Employee]...';


GO
ALTER TABLE [dbo].[EmployeeWorkStates] WITH NOCHECK
    ADD CONSTRAINT [FK_EmployeeWorkStates_Employee] FOREIGN KEY ([EmployeeId]) REFERENCES [dbo].[Employees] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_PayStubs_Employee]...';


GO
ALTER TABLE [dbo].[PayStubs] WITH NOCHECK
    ADD CONSTRAINT [FK_PayStubs_Employee] FOREIGN KEY ([EmployeeId]) REFERENCES [dbo].[Employees] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_Receipts_Expenses]...';


GO
ALTER TABLE [dbo].[Receipts] WITH NOCHECK
    ADD CONSTRAINT [FK_Receipts_Expenses] FOREIGN KEY ([ExpenseId]) REFERENCES [dbo].[Expenses] ([Id]) ON DELETE SET NULL;


GO
PRINT N'Creating Foreign Key [dbo].[FK_Expenses_Projects]...';


GO
ALTER TABLE [dbo].[Expenses] WITH NOCHECK
    ADD CONSTRAINT [FK_Expenses_Projects] FOREIGN KEY ([ProjectId]) REFERENCES [dbo].[Projects] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_Expenses_Classes]...';


GO
ALTER TABLE [dbo].[Expenses] WITH NOCHECK
    ADD CONSTRAINT [FK_Expenses_Classes] FOREIGN KEY ([ClassId]) REFERENCES [dbo].[Classes] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_Expenses_BankTransactions]...';


GO
ALTER TABLE [dbo].[Expenses] WITH NOCHECK
    ADD CONSTRAINT [FK_Expenses_BankTransactions] FOREIGN KEY ([BankTransactionId]) REFERENCES [dbo].[BankTransactions] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_Expenses_JournalEntries]...';


GO
ALTER TABLE [dbo].[Expenses] WITH NOCHECK
    ADD CONSTRAINT [FK_Expenses_JournalEntries] FOREIGN KEY ([JournalEntryId]) REFERENCES [dbo].[JournalEntries] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_Expenses_Vendors]...';


GO
ALTER TABLE [dbo].[Expenses] WITH NOCHECK
    ADD CONSTRAINT [FK_Expenses_Vendors] FOREIGN KEY ([VendorId]) REFERENCES [dbo].[Vendors] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_MileageTrips_Projects]...';


GO
ALTER TABLE [dbo].[MileageTrips] WITH NOCHECK
    ADD CONSTRAINT [FK_MileageTrips_Projects] FOREIGN KEY ([ProjectId]) REFERENCES [dbo].[Projects] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_MileageTrips_Vehicles]...';


GO
ALTER TABLE [dbo].[MileageTrips] WITH NOCHECK
    ADD CONSTRAINT [FK_MileageTrips_Vehicles] FOREIGN KEY ([VehicleId]) REFERENCES [dbo].[Vehicles] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_PaymentApplications_Payments]...';


GO
ALTER TABLE [dbo].[PaymentApplications] WITH NOCHECK
    ADD CONSTRAINT [FK_PaymentApplications_Payments] FOREIGN KEY ([PaymentId]) REFERENCES [dbo].[Payments] ([Id]) ON DELETE CASCADE;


GO
PRINT N'Creating Foreign Key [dbo].[FK_InventoryTransactions_Product]...';


GO
ALTER TABLE [dbo].[InventoryTransactions] WITH NOCHECK
    ADD CONSTRAINT [FK_InventoryTransactions_Product] FOREIGN KEY ([ProductId]) REFERENCES [dbo].[ProductsServices] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_PurchaseOrderLines_ProductsServices]...';


GO
ALTER TABLE [dbo].[PurchaseOrderLines] WITH NOCHECK
    ADD CONSTRAINT [FK_PurchaseOrderLines_ProductsServices] FOREIGN KEY ([ProductServiceId]) REFERENCES [dbo].[ProductsServices] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_ProductsServices_DefaultLocation]...';


GO
ALTER TABLE [dbo].[ProductsServices] WITH NOCHECK
    ADD CONSTRAINT [FK_ProductsServices_DefaultLocation] FOREIGN KEY ([DefaultLocationId]) REFERENCES [dbo].[InventoryLocations] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_VendorCreditLines_ProductsServices]...';


GO
ALTER TABLE [dbo].[VendorCreditLines] WITH NOCHECK
    ADD CONSTRAINT [FK_VendorCreditLines_ProductsServices] FOREIGN KEY ([ProductServiceId]) REFERENCES [dbo].[ProductsServices] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_EstimateLines_ProductsServices]...';


GO
ALTER TABLE [dbo].[EstimateLines] WITH NOCHECK
    ADD CONSTRAINT [FK_EstimateLines_ProductsServices] FOREIGN KEY ([ProductServiceId]) REFERENCES [dbo].[ProductsServices] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_CreditMemoLines_ProductsServices]...';


GO
ALTER TABLE [dbo].[CreditMemoLines] WITH NOCHECK
    ADD CONSTRAINT [FK_CreditMemoLines_ProductsServices] FOREIGN KEY ([ProductServiceId]) REFERENCES [dbo].[ProductsServices] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_SalesReceiptLines_ProductsServices]...';


GO
ALTER TABLE [dbo].[SalesReceiptLines] WITH NOCHECK
    ADD CONSTRAINT [FK_SalesReceiptLines_ProductsServices] FOREIGN KEY ([ProductServiceId]) REFERENCES [dbo].[ProductsServices] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_InvoiceLines_ProductsServices]...';


GO
ALTER TABLE [dbo].[InvoiceLines] WITH NOCHECK
    ADD CONSTRAINT [FK_InvoiceLines_ProductsServices] FOREIGN KEY ([ProductServiceId]) REFERENCES [dbo].[ProductsServices] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_SalesReceiptLines_SalesReceipts]...';


GO
ALTER TABLE [dbo].[SalesReceiptLines] WITH NOCHECK
    ADD CONSTRAINT [FK_SalesReceiptLines_SalesReceipts] FOREIGN KEY ([SalesReceiptId]) REFERENCES [dbo].[SalesReceipts] ([Id]) ON DELETE CASCADE;


GO
PRINT N'Creating Foreign Key [dbo].[FK_SalesReceipts_TaxRates]...';


GO
ALTER TABLE [dbo].[SalesReceipts] WITH NOCHECK
    ADD CONSTRAINT [FK_SalesReceipts_TaxRates] FOREIGN KEY ([TaxRateId]) REFERENCES [dbo].[TaxRates] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_SalesReceipts_JournalEntries]...';


GO
ALTER TABLE [dbo].[SalesReceipts] WITH NOCHECK
    ADD CONSTRAINT [FK_SalesReceipts_JournalEntries] FOREIGN KEY ([JournalEntryId]) REFERENCES [dbo].[JournalEntries] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_SalesReceipts_Classes]...';


GO
ALTER TABLE [dbo].[SalesReceipts] WITH NOCHECK
    ADD CONSTRAINT [FK_SalesReceipts_Classes] FOREIGN KEY ([ClassId]) REFERENCES [dbo].[Classes] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_SalesReceipts_Locations]...';


GO
ALTER TABLE [dbo].[SalesReceipts] WITH NOCHECK
    ADD CONSTRAINT [FK_SalesReceipts_Locations] FOREIGN KEY ([LocationId]) REFERENCES [dbo].[Locations] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_SalesReceiptLines_TaxRates]...';


GO
ALTER TABLE [dbo].[SalesReceiptLines] WITH NOCHECK
    ADD CONSTRAINT [FK_SalesReceiptLines_TaxRates] FOREIGN KEY ([TaxRateId]) REFERENCES [dbo].[TaxRates] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_Invoices_TaxRates]...';


GO
ALTER TABLE [dbo].[Invoices] WITH NOCHECK
    ADD CONSTRAINT [FK_Invoices_TaxRates] FOREIGN KEY ([TaxRateId]) REFERENCES [dbo].[TaxRates] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_TaxCalcSettings_TaxRates]...';


GO
ALTER TABLE [dbo].[TaxCalculationSettings] WITH NOCHECK
    ADD CONSTRAINT [FK_TaxCalcSettings_TaxRates] FOREIGN KEY ([FallbackTaxRateId]) REFERENCES [dbo].[TaxRates] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_VendorCredits_Vendors]...';


GO
ALTER TABLE [dbo].[VendorCredits] WITH NOCHECK
    ADD CONSTRAINT [FK_VendorCredits_Vendors] FOREIGN KEY ([VendorId]) REFERENCES [dbo].[Vendors] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_PurchaseOrders_Vendors]...';


GO
ALTER TABLE [dbo].[PurchaseOrders] WITH NOCHECK
    ADD CONSTRAINT [FK_PurchaseOrders_Vendors] FOREIGN KEY ([VendorId]) REFERENCES [dbo].[Vendors] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_BankRules_AssignVendor]...';


GO
ALTER TABLE [dbo].[BankRules] WITH NOCHECK
    ADD CONSTRAINT [FK_BankRules_AssignVendor] FOREIGN KEY ([AssignVendorId]) REFERENCES [dbo].[Vendors] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_BillPayments_Vendors]...';


GO
ALTER TABLE [dbo].[BillPayments] WITH NOCHECK
    ADD CONSTRAINT [FK_BillPayments_Vendors] FOREIGN KEY ([VendorId]) REFERENCES [dbo].[Vendors] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_YearEndCloseEntries_Accounts]...';


GO
ALTER TABLE [dbo].[YearEndCloseEntries] WITH NOCHECK
    ADD CONSTRAINT [FK_YearEndCloseEntries_Accounts] FOREIGN KEY ([RetainedEarningsAccountId]) REFERENCES [dbo].[Accounts] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_YearEndCloseEntries_JournalEntries]...';


GO
ALTER TABLE [dbo].[YearEndCloseEntries] WITH NOCHECK
    ADD CONSTRAINT [FK_YearEndCloseEntries_JournalEntries] FOREIGN KEY ([JournalEntryId]) REFERENCES [dbo].[JournalEntries] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_YearEndCloseEntries_AccountingPeriods]...';


GO
ALTER TABLE [dbo].[YearEndCloseEntries] WITH NOCHECK
    ADD CONSTRAINT [FK_YearEndCloseEntries_AccountingPeriods] FOREIGN KEY ([AccountingPeriodId]) REFERENCES [dbo].[AccountingPeriods] ([Id]);


GO
PRINT N'Creating Foreign Key [dbo].[FK_SubmissionAttachments_Submissions]...';


GO
ALTER TABLE [dbo].[SubmissionAttachments] WITH NOCHECK
    ADD CONSTRAINT [FK_SubmissionAttachments_Submissions] FOREIGN KEY ([SubmissionId]) REFERENCES [dbo].[Submissions] ([Id]) ON DELETE CASCADE;


GO
PRINT N'Creating Check Constraint [dbo].[CK_ProductsServices_Status]...';


GO
ALTER TABLE [dbo].[ProductsServices] WITH NOCHECK
    ADD CONSTRAINT [CK_ProductsServices_Status] CHECK ([Status] IN ('Active', 'Inactive'));


GO
PRINT N'Creating Check Constraint [dbo].[CK_ProductsServices_Type]...';


GO
ALTER TABLE [dbo].[ProductsServices] WITH NOCHECK
    ADD CONSTRAINT [CK_ProductsServices_Type] CHECK ([Type] IN ('Inventory', 'NonInventory', 'Service'));


GO
PRINT N'Creating Check Constraint [dbo].[CK_ProductsServices_ValuationMethod]...';


GO
ALTER TABLE [dbo].[ProductsServices] WITH NOCHECK
    ADD CONSTRAINT [CK_ProductsServices_ValuationMethod] CHECK ([InventoryValuationMethod] IN ('FIFO', 'AverageCost', 'LIFO'));


GO
PRINT N'Creating Check Constraint [dbo].[CK_VendorCredits_Status]...';


GO
ALTER TABLE [dbo].[VendorCredits] WITH NOCHECK
    ADD CONSTRAINT [CK_VendorCredits_Status] CHECK ([Status] IN ('Open', 'Applied', 'Partial', 'Voided'));


GO
PRINT N'Creating Check Constraint [dbo].[CK_AuditLog_Action]...';


GO
ALTER TABLE [dbo].[AuditLog] WITH NOCHECK
    ADD CONSTRAINT [CK_AuditLog_Action] CHECK ([Action] IN ('Create', 'Update', 'Delete', 'View', 'Login', 'Logout', 'Export', 'Import', 'System'));


GO
PRINT N'Creating Check Constraint [dbo].[CK_BankRules_MatchField]...';


GO
ALTER TABLE [dbo].[BankRules] WITH NOCHECK
    ADD CONSTRAINT [CK_BankRules_MatchField] CHECK ([MatchField] IN ('Description', 'Amount', 'Both'));


GO
PRINT N'Creating Check Constraint [dbo].[CK_BankRules_MatchType]...';


GO
ALTER TABLE [dbo].[BankRules] WITH NOCHECK
    ADD CONSTRAINT [CK_BankRules_MatchType] CHECK ([MatchType] IN ('Contains', 'StartsWith', 'Equals', 'Regex'));


GO
PRINT N'Creating Check Constraint [dbo].[CK_BankRules_TransactionType]...';


GO
ALTER TABLE [dbo].[BankRules] WITH NOCHECK
    ADD CONSTRAINT [CK_BankRules_TransactionType] CHECK ([TransactionType] IS NULL OR [TransactionType] IN ('Debit', 'Credit'));


GO
PRINT N'Creating Check Constraint [dbo].[CK_CreditMemos_Status]...';


GO
ALTER TABLE [dbo].[CreditMemos] WITH NOCHECK
    ADD CONSTRAINT [CK_CreditMemos_Status] CHECK ([Status] IN ('Open', 'Applied', 'PartiallyApplied', 'Refunded', 'Voided'));


GO
PRINT N'Creating Check Constraint [dbo].[CK_CustomerDeposits_Status]...';


GO
ALTER TABLE [dbo].[CustomerDeposits] WITH NOCHECK
    ADD CONSTRAINT [CK_CustomerDeposits_Status] CHECK ([Status] IN ('Open', 'PartiallyApplied', 'Applied', 'Refunded'));


GO
PRINT N'Creating Check Constraint [dbo].[CK_InventoryLocations_Status]...';


GO
ALTER TABLE [dbo].[InventoryLocations] WITH NOCHECK
    ADD CONSTRAINT [CK_InventoryLocations_Status] CHECK ([Status] IN ('Active', 'Inactive'));


GO
PRINT N'Creating Check Constraint [dbo].[CK_InventoryTransactions_TransactionType]...';


GO
ALTER TABLE [dbo].[InventoryTransactions] WITH NOCHECK
    ADD CONSTRAINT [CK_InventoryTransactions_TransactionType] CHECK ([TransactionType] IN ('Purchase', 'Sale', 'Adjustment', 'Transfer'));


GO
PRINT N'Creating Check Constraint [dbo].[CHK_RecurringSchedules_Status]...';


GO
ALTER TABLE [dbo].[RecurringSchedules] WITH NOCHECK
    ADD CONSTRAINT [CHK_RecurringSchedules_Status] CHECK ([Status] IN ('Pending', 'Created', 'Skipped', 'Failed'));


GO
PRINT N'Creating Check Constraint [dbo].[CHK_RecurringSchedules_TransactionType]...';


GO
ALTER TABLE [dbo].[RecurringSchedules] WITH NOCHECK
    ADD CONSTRAINT [CHK_RecurringSchedules_TransactionType] CHECK ([TransactionType] IN ('Invoice', 'Bill', 'JournalEntry'));


GO
PRINT N'Creating Check Constraint [dbo].[CHK_RecurringTemplates_Frequency]...';


GO
ALTER TABLE [dbo].[RecurringTemplates] WITH NOCHECK
    ADD CONSTRAINT [CHK_RecurringTemplates_Frequency] CHECK ([Frequency] IN ('Daily', 'Weekly', 'Monthly', 'Yearly'));


GO
PRINT N'Creating Check Constraint [dbo].[CHK_RecurringTemplates_Status]...';


GO
ALTER TABLE [dbo].[RecurringTemplates] WITH NOCHECK
    ADD CONSTRAINT [CHK_RecurringTemplates_Status] CHECK ([Status] IN ('Active', 'Paused', 'Completed'));


GO
PRINT N'Creating Check Constraint [dbo].[CHK_RecurringTemplates_TransactionType]...';


GO
ALTER TABLE [dbo].[RecurringTemplates] WITH NOCHECK
    ADD CONSTRAINT [CHK_RecurringTemplates_TransactionType] CHECK ([TransactionType] IN ('Invoice', 'Bill', 'JournalEntry'));


GO
PRINT N'Creating Check Constraint [dbo].[CK_Refunds_Status]...';


GO
ALTER TABLE [dbo].[Refunds] WITH NOCHECK
    ADD CONSTRAINT [CK_Refunds_Status] CHECK ([Status] IN ('Pending', 'Completed', 'Voided'));


GO
PRINT N'Creating Check Constraint [dbo].[CK_TaxCalcSettings_Method]...';


GO
ALTER TABLE [dbo].[TaxCalculationSettings] WITH NOCHECK
    ADD CONSTRAINT [CK_TaxCalcSettings_Method] CHECK ([CalculationMethod] IN ('manual', 'zip_api', 'paid_api'));


GO
PRINT N'Creating Check Constraint [dbo].[CK_Tenants_SubscriptionTier]...';


GO
ALTER TABLE [dbo].[Tenants] WITH NOCHECK
    ADD CONSTRAINT [CK_Tenants_SubscriptionTier] CHECK ([SubscriptionTier] IN ('Free', 'Starter', 'Professional', 'Enterprise'));


GO
PRINT N'Creating Check Constraint [dbo].[CK_Users_AuthProvider]...';


GO
ALTER TABLE [dbo].[Users] WITH NOCHECK
    ADD CONSTRAINT [CK_Users_AuthProvider] CHECK ([AuthProvider] IN ('EntraID', 'B2C'));


GO
PRINT N'Creating Check Constraint [dbo].[CK_Deployments_Status]...';


GO
ALTER TABLE [dbo].[Deployments] WITH NOCHECK
    ADD CONSTRAINT [CK_Deployments_Status] CHECK ([Status] IN ('pending', 'in-progress', 'deployed', 'failed'));


GO
PRINT N'Creating Check Constraint [dbo].[CK_Enhancements_Status]...';


GO
ALTER TABLE [dbo].[Enhancements] WITH NOCHECK
    ADD CONSTRAINT [CK_Enhancements_Status] CHECK ([Status] IN ('pending', 'in-progress', 'deployed', 'reverted', 'failed'));


GO
PRINT N'Creating Check Constraint [dbo].[CK_Submissions_Priority]...';


GO
ALTER TABLE [dbo].[Submissions] WITH NOCHECK
    ADD CONSTRAINT [CK_Submissions_Priority] CHECK ([Priority] IN ('Low', 'Medium', 'High', 'Critical'));


GO
PRINT N'Creating Check Constraint [dbo].[CK_Submissions_Status]...';


GO
ALTER TABLE [dbo].[Submissions] WITH NOCHECK
    ADD CONSTRAINT [CK_Submissions_Status] CHECK ([Status] IN ('Open', 'InProgress', 'Resolved', 'Closed'));


GO
PRINT N'Creating Check Constraint [dbo].[CK_Submissions_Type]...';


GO
ALTER TABLE [dbo].[Submissions] WITH NOCHECK
    ADD CONSTRAINT [CK_Submissions_Type] CHECK ([Type] IN ('Bug', 'Enhancement', 'Question'));


GO
PRINT N'Creating Trigger [dbo].[TR_AuditLog_PreventModification]...';


GO
-- Trigger: TR_AuditLog_PreventModification
-- Purpose: Prevent modification or deletion of audit log records
-- This ensures the audit trail cannot be tampered with (compliance requirement)

CREATE TRIGGER [dbo].[TR_AuditLog_PreventModification]
ON [dbo].[AuditLog]
INSTEAD OF UPDATE, DELETE
AS
BEGIN
    SET NOCOUNT ON;

    -- Prevent any updates or deletes
    RAISERROR ('Audit log records cannot be modified or deleted. This is required for compliance.', 16, 1);
    ROLLBACK TRANSACTION;
END
GO
PRINT N'Refreshing View [dbo].[v_SalesReceiptLines]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[v_SalesReceiptLines]';


GO
PRINT N'Refreshing View [dbo].[v_Refunds]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[v_Refunds]';


GO
PRINT N'Refreshing View [dbo].[v_CustomerDeposits]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[v_CustomerDeposits]';


GO
PRINT N'Refreshing View [dbo].[v_CreditMemoLines]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[v_CreditMemoLines]';


GO
PRINT N'Refreshing View [dbo].[v_Payments]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[v_Payments]';


GO
PRINT N'Refreshing View [dbo].[v_Expenses]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[v_Expenses]';


GO
PRINT N'Refreshing View [dbo].[v_BillPayments]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[v_BillPayments]';


GO
PRINT N'Refreshing View [dbo].[v_BankTransactionImports]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[v_BankTransactionImports]';


GO
PRINT N'Refreshing View [dbo].[v_BillPaymentApplications]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[v_BillPaymentApplications]';


GO
PRINT N'Refreshing View [dbo].[v_VendorCreditApplications]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[v_VendorCreditApplications]';


GO
PRINT N'Refreshing View [dbo].[v_Bills]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[v_Bills]';


GO
PRINT N'Altering View [dbo].[v_MileageTrips]...';


GO
ALTER VIEW [dbo].[v_MileageTrips] AS
SELECT
    mt.[Id],
    mt.[VehicleId],
    v.[Name] AS VehicleName,
    CONCAT(v.[Year], ' ', v.[Make], ' ', v.[Model]) AS VehicleDescription,
    mt.[TripDate],
    mt.[StartLocation],
    mt.[EndLocation],
    mt.[StartOdometer],
    mt.[EndOdometer],
    mt.[Distance],
    mt.[Purpose],
    mt.[Category],
    mt.[RatePerMile],
    mt.[DeductibleAmount],
    mt.[CustomerId],
    c.[Name] AS CustomerName,
    mt.[ProjectId],
    p.[Name] AS ProjectName,
    mt.[Notes],
    mt.[IsRoundTrip],
    mt.[Status],
    mt.[IsPersonal],
    mt.[CreatedBy],
    mt.[CreatedAt],
    mt.[UpdatedAt]
FROM
    [dbo].[MileageTrips] mt
    LEFT JOIN [dbo].[Vehicles] v ON mt.[VehicleId] = v.[Id]
    LEFT JOIN [dbo].[Customers] c ON mt.[CustomerId] = c.[Id]
    LEFT JOIN [dbo].[Projects] p ON mt.[ProjectId] = p.[Id]
GO
PRINT N'Refreshing View [dbo].[v_BankTransactionMatches]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[v_BankTransactionMatches]';


GO
PRINT N'Refreshing View [dbo].[v_CreditApplications]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[v_CreditApplications]';


GO
PRINT N'Refreshing View [dbo].[v_Estimates]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[v_Estimates]';


GO
PRINT N'Refreshing View [dbo].[v_CreditMemos]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[v_CreditMemos]';


GO
PRINT N'Refreshing View [dbo].[v_Projects]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[v_Projects]';


GO
PRINT N'Refreshing View [dbo].[v_DepositApplications]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[v_DepositApplications]';


GO
PRINT N'Refreshing View [dbo].[v_PayStubs]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[v_PayStubs]';


GO
PRINT N'Refreshing View [dbo].[v_Employees]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[v_Employees]';


GO
PRINT N'Altering View [dbo].[v_EmployeeWorkStates]...';


GO
ALTER VIEW [dbo].[v_EmployeeWorkStates] AS
SELECT
    ews.[Id],
    ews.[EmployeeId],
    e.[FirstName] + ' ' + e.[LastName] AS [EmployeeName],
    e.[EmployeeNumber],
    ews.[StateCode],
    ews.[Percentage],
    ews.[EffectiveDate],
    ews.[EndDate],
    ews.[IsPrimary],
    ews.[Notes],
    ews.[CreatedAt],
    ews.[UpdatedAt],
    CASE WHEN ews.[EndDate] IS NULL OR ews.[EndDate] > GETDATE() THEN 1 ELSE 0 END AS [IsActive]
FROM [dbo].[EmployeeWorkStates] ews
INNER JOIN [dbo].[Employees] e ON ews.[EmployeeId] = e.[Id]
GO
PRINT N'Refreshing View [dbo].[v_Receipts]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[v_Receipts]';


GO
PRINT N'Refreshing View [dbo].[v_PaymentApplications]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[v_PaymentApplications]';


GO
PRINT N'Refreshing View [dbo].[v_VendorCredits]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[v_VendorCredits]';


GO
PRINT N'Refreshing View [dbo].[v_PurchaseOrders]...';


GO
EXECUTE sp_refreshsqlmodule N'[dbo].[v_PurchaseOrders]';


GO
PRINT N'Creating View [dbo].[v_Invoices]...';


GO
CREATE VIEW [dbo].[v_Invoices] AS
SELECT
    i.[Id],
    i.[InvoiceNumber],
    i.[CustomerId],
    c.[Name] AS CustomerName,
    i.[IssueDate],
    i.[DueDate],
    i.[Subtotal],
    i.[TaxRateId],
    tr.[Name] AS TaxRateName,
    tr.[Rate] AS TaxRate,
    i.[TaxAmount],
    i.[TotalAmount],
    i.[AmountPaid],
    (i.[TotalAmount] - i.[AmountPaid]) AS BalanceDue,
    CASE
        WHEN i.[Status] = 'Paid' THEN 'Paid'
        WHEN i.[AmountPaid] > 0 AND i.[AmountPaid] < i.[TotalAmount] THEN 'Partial'
        WHEN i.[DueDate] < CAST(GETDATE() AS DATE) AND i.[Status] NOT IN ('Paid', 'Draft') THEN 'Overdue'
        ELSE i.[Status]
    END AS Status,
    i.[SourceSystem],
    i.[SourceId],
    i.[ClaimId],
    i.[IsPersonal],
    i.[CreatedAt],
    i.[UpdatedAt]
FROM
    [dbo].[Invoices] i
    LEFT JOIN [dbo].[Customers] c ON i.[CustomerId] = c.[Id]
    LEFT JOIN [dbo].[TaxRates] tr ON i.[TaxRateId] = tr.[Id]
GO
PRINT N'Creating View [dbo].[v_SalesReceipts]...';


GO
CREATE VIEW [dbo].[v_SalesReceipts] AS
SELECT
    sr.[Id],
    sr.[SalesReceiptNumber],
    sr.[CustomerId],
    c.[Name] AS CustomerName,
    sr.[SaleDate],
    sr.[DepositAccountId],
    da.[Name] AS DepositAccountName,
    sr.[PaymentMethod],
    sr.[Reference],
    sr.[Subtotal],
    sr.[TaxRateId],
    CONCAT(tr.[TaxType], ' - ', tr.[StateCode], ' (', tr.[Rate], '%)') AS TaxRateName,
    tr.[Rate] AS TaxRate,
    sr.[TaxAmount],
    sr.[TotalAmount],
    sr.[Memo],
    sr.[Status],
    sr.[JournalEntryId],
    sr.[ClassId],
    cl.[Name] AS ClassName,
    sr.[LocationId],
    loc.[Name] AS LocationName,
    sr.[SourceSystem],
    sr.[SourceId],
    sr.[TenantId],
    sr.[IsPersonal],
    sr.[CreatedAt],
    sr.[UpdatedAt]
FROM
    [dbo].[SalesReceipts] sr
    LEFT JOIN [dbo].[Customers] c ON sr.[CustomerId] = c.[Id]
    LEFT JOIN [dbo].[Accounts] da ON sr.[DepositAccountId] = da.[Id]
    LEFT JOIN [dbo].[TaxRates] tr ON sr.[TaxRateId] = tr.[Id]
    LEFT JOIN [dbo].[Classes] cl ON sr.[ClassId] = cl.[Id]
    LEFT JOIN [dbo].[Locations] loc ON sr.[LocationId] = loc.[Id]
GO
PRINT N'Creating View [dbo].[v_YearEndCloseEntries]...';


GO
CREATE VIEW [dbo].[v_YearEndCloseEntries]
AS
SELECT
    y.Id,
    y.AccountingPeriodId,
    y.FiscalYear,
    y.CloseDate,
    y.RetainedEarningsAccountId,
    a.Name AS RetainedEarningsAccountName,
    a.Code AS RetainedEarningsAccountCode,
    y.JournalEntryId,
    j.Reference AS JournalEntryReference,
    y.NetIncome,
    y.TotalRevenue,
    y.TotalExpenses,
    y.Status,
    y.CreatedBy,
    y.CreatedAt,
    y.TenantId,
    ap.FiscalYearStart,
    ap.FiscalYearEnd,
    ap.IsLocked AS PeriodIsLocked
FROM [dbo].[YearEndCloseEntries] y
INNER JOIN [dbo].[Accounts] a ON y.RetainedEarningsAccountId = a.Id
INNER JOIN [dbo].[JournalEntries] j ON y.JournalEntryId = j.Id
INNER JOIN [dbo].[AccountingPeriods] ap ON y.AccountingPeriodId = ap.Id
GO
/*
Post-Deployment Script - Seed Data
--------------------------------------------------------------------------------------
This script seeds the database with initial data for development and testing.
Uses MERGE statements for idempotent operations (safe to run multiple times).
--------------------------------------------------------------------------------------
*/

-- ============================================================================
-- ACCOUNTS - Chart of Accounts
-- ============================================================================
IF NOT EXISTS (SELECT 1 FROM [dbo].[Accounts])
BEGIN
    PRINT 'Seeding Accounts...'

    INSERT INTO [dbo].[Accounts] ([Id], [Code], [Name], [Type], [Subtype], [Description])
    VALUES
    -- Assets (1xxx)
    (NEWID(), '1000', 'Checking Account', 'Asset', 'Bank', 'Primary business checking account'),
    (NEWID(), '1010', 'Savings Account', 'Asset', 'Bank', 'Business savings account'),
    (NEWID(), '1100', 'Accounts Receivable', 'Asset', 'Receivable', 'Money owed by customers'),
    (NEWID(), '1200', 'Inventory', 'Asset', 'Inventory', 'Goods held for sale'),
    (NEWID(), '1300', 'Prepaid Expenses', 'Asset', 'OtherCurrentAsset', 'Expenses paid in advance'),
    (NEWID(), '1500', 'Office Equipment', 'Asset', 'FixedAsset', 'Computers, furniture, etc.'),
    (NEWID(), '1510', 'Accumulated Depreciation - Equipment', 'Asset', 'FixedAsset', 'Depreciation contra account'),

    -- Liabilities (2xxx)
    (NEWID(), '2000', 'Accounts Payable', 'Liability', 'Payable', 'Money owed to vendors'),
    (NEWID(), '2100', 'Credit Card Payable', 'Liability', 'CreditCard', 'Business credit card balance'),
    (NEWID(), '2200', 'Accrued Expenses', 'Liability', 'OtherCurrentLiability', 'Expenses incurred but not yet paid'),
    (NEWID(), '2300', 'Sales Tax Payable', 'Liability', 'OtherCurrentLiability', 'Sales tax collected'),
    (NEWID(), '2400', 'Payroll Liabilities', 'Liability', 'OtherCurrentLiability', 'Payroll taxes and withholdings'),

    -- Equity (3xxx)
    (NEWID(), '3000', 'Owner''s Equity', 'Equity', 'OwnersEquity', 'Owner''s investment in the business'),
    (NEWID(), '3100', 'Retained Earnings', 'Equity', 'RetainedEarnings', 'Accumulated profits'),
    (NEWID(), '3200', 'Owner''s Draw', 'Equity', 'OwnersEquity', 'Owner withdrawals'),

    -- Revenue (4xxx)
    (NEWID(), '4000', 'Sales Revenue', 'Revenue', 'Sales', 'Income from product sales'),
    (NEWID(), '4100', 'Service Revenue', 'Revenue', 'Service', 'Income from services'),
    (NEWID(), '4200', 'Consulting Revenue', 'Revenue', 'Service', 'Income from consulting'),
    (NEWID(), '4300', 'Interest Income', 'Revenue', 'OtherIncome', 'Interest earned'),
    (NEWID(), '4900', 'Other Income', 'Revenue', 'OtherIncome', 'Miscellaneous income'),

    -- Expenses (5xxx-6xxx)
    (NEWID(), '5000', 'Cost of Goods Sold', 'Expense', 'CostOfGoodsSold', 'Direct costs of products sold'),
    (NEWID(), '5100', 'Subcontractor Expense', 'Expense', 'CostOfGoodsSold', 'Payments to subcontractors'),
    (NEWID(), '6000', 'Advertising & Marketing', 'Expense', 'Operating', 'Marketing and advertising costs'),
    (NEWID(), '6100', 'Bank Fees', 'Expense', 'Operating', 'Bank service charges'),
    (NEWID(), '6200', 'Insurance', 'Expense', 'Operating', 'Business insurance'),
    (NEWID(), '6300', 'Office Supplies', 'Expense', 'Operating', 'Office supplies and materials'),
    (NEWID(), '6400', 'Professional Services', 'Expense', 'Operating', 'Legal, accounting, etc.'),
    (NEWID(), '6500', 'Rent Expense', 'Expense', 'Operating', 'Office/facility rent'),
    (NEWID(), '6600', 'Software & Subscriptions', 'Expense', 'Operating', 'Software and SaaS costs'),
    (NEWID(), '6700', 'Telephone & Internet', 'Expense', 'Operating', 'Communication costs'),
    (NEWID(), '6800', 'Travel & Entertainment', 'Expense', 'Operating', 'Business travel and meals'),
    (NEWID(), '6900', 'Utilities', 'Expense', 'Operating', 'Electric, gas, water'),
    (NEWID(), '7000', 'Payroll Expense', 'Expense', 'Payroll', 'Employee wages and salaries'),
    (NEWID(), '7100', 'Payroll Tax Expense', 'Expense', 'Payroll', 'Employer payroll taxes'),
    (NEWID(), '7200', 'Employee Benefits', 'Expense', 'Payroll', 'Health insurance, 401k, etc.'),
    (NEWID(), '8000', 'Depreciation Expense', 'Expense', 'Operating', 'Asset depreciation'),
    (NEWID(), '9000', 'Miscellaneous Expense', 'Expense', 'Operating', 'Other expenses')
END
GO

-- ============================================================================
-- CUSTOMERS
-- ============================================================================
IF NOT EXISTS (SELECT 1 FROM [dbo].[Customers])
BEGIN
    PRINT 'Seeding Customers...'

    INSERT INTO [dbo].[Customers] ([Id], [Name], [Email], [Phone], [Address])
    VALUES
    (NEWID(), 'Acme Corporation', 'billing@acme.com', '555-0100', '123 Main St, New York, NY 10001'),
    (NEWID(), 'TechStart Inc.', 'accounts@techstart.io', '555-0101', '456 Innovation Way, San Francisco, CA 94105'),
    (NEWID(), 'Global Dynamics', 'finance@globaldynamics.com', '555-0102', '789 Enterprise Blvd, Chicago, IL 60601'),
    (NEWID(), 'Smith & Associates', 'info@smithassoc.com', '555-0103', '321 Legal Lane, Boston, MA 02101'),
    (NEWID(), 'Riverside Manufacturing', 'ap@riverside-mfg.com', '555-0104', '555 Industrial Park, Detroit, MI 48201'),
    (NEWID(), 'Creative Solutions LLC', 'hello@creativesolutions.co', '555-0105', '888 Design District, Austin, TX 78701'),
    (NEWID(), 'Healthcare Partners', 'billing@healthcarepartners.org', '555-0106', '200 Medical Center Dr, Phoenix, AZ 85001'),
    (NEWID(), 'Summit Consulting Group', 'invoices@summitcg.com', '555-0107', '1000 Business Park, Denver, CO 80202')
END
GO

-- ============================================================================
-- VENDORS
-- ============================================================================
DECLARE @OfficeSuppliesAccountId UNIQUEIDENTIFIER = (SELECT [Id] FROM [dbo].[Accounts] WHERE [Code] = '6300')
DECLARE @SoftwareAccountId UNIQUEIDENTIFIER = (SELECT [Id] FROM [dbo].[Accounts] WHERE [Code] = '6600')
DECLARE @ProfServicesAccountId UNIQUEIDENTIFIER = (SELECT [Id] FROM [dbo].[Accounts] WHERE [Code] = '6400')
DECLARE @RentAccountId UNIQUEIDENTIFIER = (SELECT [Id] FROM [dbo].[Accounts] WHERE [Code] = '6500')
DECLARE @UtilitiesAccountId UNIQUEIDENTIFIER = (SELECT [Id] FROM [dbo].[Accounts] WHERE [Code] = '6900')
DECLARE @SubcontractorAccountId UNIQUEIDENTIFIER = (SELECT [Id] FROM [dbo].[Accounts] WHERE [Code] = '5100')

IF NOT EXISTS (SELECT 1 FROM [dbo].[Vendors])
BEGIN
    PRINT 'Seeding Vendors...'

    INSERT INTO [dbo].[Vendors] ([Id], [Name], [Email], [Phone], [Address], [PaymentTerms], [Is1099Vendor], [DefaultExpenseAccountId], [Status])
    VALUES
    (NEWID(), 'Office Depot', 'business@officedepot.com', '800-555-0001', 'PO Box 1234, Chicago, IL 60601', 'Net 30', 0, @OfficeSuppliesAccountId, 'Active'),
    (NEWID(), 'Amazon Web Services', 'aws-billing@amazon.com', '800-555-0002', 'PO Box 5678, Seattle, WA 98101', 'Net 30', 0, @SoftwareAccountId, 'Active'),
    (NEWID(), 'Microsoft Corporation', 'billing@microsoft.com', '800-555-0003', 'One Microsoft Way, Redmond, WA 98052', 'Net 30', 0, @SoftwareAccountId, 'Active'),
    (NEWID(), 'Johnson & Johnson CPA', 'accounting@jjcpa.com', '555-0200', '100 Financial Plaza, Boston, MA 02101', 'Net 15', 1, @ProfServicesAccountId, 'Active'),
    (NEWID(), 'Premier Property Management', 'rent@premierprop.com', '555-0201', '500 Real Estate Ave, Los Angeles, CA 90001', 'Due on Receipt', 0, @RentAccountId, 'Active'),
    (NEWID(), 'City Power & Light', 'billing@citypower.com', '555-0202', 'PO Box 9999, Dallas, TX 75201', 'Net 21', 0, @UtilitiesAccountId, 'Active'),
    (NEWID(), 'Freelance Developer - John Smith', 'john.smith@email.com', '555-0203', '123 Remote Lane, Portland, OR 97201', 'Net 15', 1, @SubcontractorAccountId, 'Active'),
    (NEWID(), 'Design Studio Pro', 'hello@designstudiopro.com', '555-0204', '456 Creative Blvd, Miami, FL 33101', 'Net 30', 1, @SubcontractorAccountId, 'Active')
END
GO

-- ============================================================================
-- PRODUCTS & SERVICES
-- ============================================================================
DECLARE @SalesRevenueAccountId UNIQUEIDENTIFIER = (SELECT [Id] FROM [dbo].[Accounts] WHERE [Code] = '4000')
DECLARE @ServiceRevenueAccountId UNIQUEIDENTIFIER = (SELECT [Id] FROM [dbo].[Accounts] WHERE [Code] = '4100')
DECLARE @ConsultingRevenueAccountId UNIQUEIDENTIFIER = (SELECT [Id] FROM [dbo].[Accounts] WHERE [Code] = '4200')
DECLARE @COGSAccountId UNIQUEIDENTIFIER = (SELECT [Id] FROM [dbo].[Accounts] WHERE [Code] = '5000')
DECLARE @InventoryAccountId UNIQUEIDENTIFIER = (SELECT [Id] FROM [dbo].[Accounts] WHERE [Code] = '1200')

IF NOT EXISTS (SELECT 1 FROM [dbo].[ProductsServices])
BEGIN
    PRINT 'Seeding Products & Services...'

    INSERT INTO [dbo].[ProductsServices] ([Id], [Name], [SKU], [Type], [Description], [SalesPrice], [PurchaseCost], [IncomeAccountId], [ExpenseAccountId], [InventoryAssetAccountId], [Category], [Taxable], [Status])
    VALUES
    -- Services
    (NEWID(), 'Consulting - Hourly', 'SVC-CONSULT-HR', 'Service', 'Professional consulting services billed hourly', 150.00, NULL, @ConsultingRevenueAccountId, NULL, NULL, 'Consulting', 0, 'Active'),
    (NEWID(), 'Software Development - Hourly', 'SVC-DEV-HR', 'Service', 'Custom software development services', 175.00, NULL, @ServiceRevenueAccountId, NULL, NULL, 'Development', 0, 'Active'),
    (NEWID(), 'Project Management', 'SVC-PM-HR', 'Service', 'Project management and coordination', 125.00, NULL, @ServiceRevenueAccountId, NULL, NULL, 'Management', 0, 'Active'),
    (NEWID(), 'Training Session', 'SVC-TRAIN', 'Service', 'On-site or virtual training session (full day)', 1500.00, NULL, @ServiceRevenueAccountId, NULL, NULL, 'Training', 0, 'Active'),
    (NEWID(), 'Technical Support - Monthly', 'SVC-SUPPORT-MO', 'Service', 'Monthly technical support package', 500.00, NULL, @ServiceRevenueAccountId, NULL, NULL, 'Support', 0, 'Active'),

    -- Non-Inventory Products
    (NEWID(), 'Software License - Basic', 'LIC-BASIC', 'NonInventory', 'Basic software license (1 user)', 299.00, NULL, @SalesRevenueAccountId, NULL, NULL, 'Software', 1, 'Active'),
    (NEWID(), 'Software License - Professional', 'LIC-PRO', 'NonInventory', 'Professional software license (5 users)', 999.00, NULL, @SalesRevenueAccountId, NULL, NULL, 'Software', 1, 'Active'),
    (NEWID(), 'Software License - Enterprise', 'LIC-ENT', 'NonInventory', 'Enterprise software license (unlimited)', 4999.00, NULL, @SalesRevenueAccountId, NULL, NULL, 'Software', 1, 'Active'),

    -- Inventory Products
    (NEWID(), 'Branded USB Drive 16GB', 'HW-USB-16', 'Inventory', 'Company branded USB flash drive', 15.00, 5.00, @SalesRevenueAccountId, @COGSAccountId, @InventoryAccountId, 'Hardware', 1, 'Active'),
    (NEWID(), 'Branded Notebook', 'MERCH-NB', 'Inventory', 'Company branded notebook', 12.00, 4.00, @SalesRevenueAccountId, @COGSAccountId, @InventoryAccountId, 'Merchandise', 1, 'Active'),
    (NEWID(), 'Welcome Kit', 'KIT-WELCOME', 'Inventory', 'New client welcome kit with branded items', 45.00, 20.00, @SalesRevenueAccountId, @COGSAccountId, @InventoryAccountId, 'Kits', 1, 'Active')
END
GO

-- ============================================================================
-- PROJECTS (for Time Tracking)
-- ============================================================================
IF NOT EXISTS (SELECT 1 FROM [dbo].[Projects])
BEGIN
    PRINT 'Seeding Projects...'

    DECLARE @Customer1Id UNIQUEIDENTIFIER = (SELECT TOP 1 [Id] FROM [dbo].[Customers] WHERE [Name] = 'Acme Corporation')
    DECLARE @Customer2Id UNIQUEIDENTIFIER = (SELECT TOP 1 [Id] FROM [dbo].[Customers] WHERE [Name] = 'TechStart Inc.')
    DECLARE @Customer3Id UNIQUEIDENTIFIER = (SELECT TOP 1 [Id] FROM [dbo].[Customers] WHERE [Name] = 'Global Dynamics')

    INSERT INTO [dbo].[Projects] ([Id], [Name], [CustomerId], [Description], [Status], [StartDate], [EndDate], [BudgetedHours], [BudgetedAmount])
    VALUES
    (NEWID(), 'Website Redesign', @Customer1Id, 'Complete redesign of corporate website', 'Active', DATEADD(month, -2, GETDATE()), DATEADD(month, 2, GETDATE()), 200, 30000.00),
    (NEWID(), 'ERP Implementation', @Customer2Id, 'Enterprise resource planning system implementation', 'Active', DATEADD(month, -1, GETDATE()), DATEADD(month, 6, GETDATE()), 500, 87500.00),
    (NEWID(), 'Security Audit', @Customer3Id, 'Annual security assessment and recommendations', 'Active', GETDATE(), DATEADD(month, 1, GETDATE()), 80, 12000.00),
    (NEWID(), 'Mobile App Development', @Customer1Id, 'iOS and Android app for customer portal', 'Active', DATEADD(month, -3, GETDATE()), DATEADD(month, 3, GETDATE()), 400, 70000.00),
    (NEWID(), 'Data Migration', @Customer2Id, 'Legacy system data migration to cloud', 'Completed', DATEADD(month, -6, GETDATE()), DATEADD(month, -2, GETDATE()), 150, 22500.00)
END
GO

PRINT 'Seed data deployment complete.'
GO

GO
PRINT N'Checking existing data against newly created constraints';


GO
USE [$(DatabaseName)];


GO
ALTER TABLE [dbo].[ProductsServices] WITH CHECK CHECK CONSTRAINT [FK_ProductsServices_InventoryAssetAccount];

ALTER TABLE [dbo].[Refunds] WITH CHECK CHECK CONSTRAINT [FK_Refunds_PaymentAccount];

ALTER TABLE [dbo].[Vendors] WITH CHECK CHECK CONSTRAINT [FK_Vendors_DefaultExpenseAccount];

ALTER TABLE [dbo].[BankTransactions] WITH CHECK CHECK CONSTRAINT [FK_BankTransactions_SourceAccount];

ALTER TABLE [dbo].[Expenses] WITH CHECK CHECK CONSTRAINT [FK_Expenses_Accounts];

ALTER TABLE [dbo].[BankRules] WITH CHECK CHECK CONSTRAINT [FK_BankRules_BankAccount];

ALTER TABLE [dbo].[VendorCreditLines] WITH CHECK CHECK CONSTRAINT [FK_VendorCreditLines_Accounts];

ALTER TABLE [dbo].[Expenses] WITH CHECK CHECK CONSTRAINT [FK_Expenses_PaymentAccounts];

ALTER TABLE [dbo].[BankRules] WITH CHECK CHECK CONSTRAINT [FK_BankRules_AssignAccount];

ALTER TABLE [dbo].[SalesReceipts] WITH CHECK CHECK CONSTRAINT [FK_SalesReceipts_DepositAccount];

ALTER TABLE [dbo].[PlaidAccounts] WITH CHECK CHECK CONSTRAINT [FK_PlaidAccounts_LinkedAccount];

ALTER TABLE [dbo].[BankTransactions] WITH CHECK CHECK CONSTRAINT [FK_BankTransactions_SuggestedAccount];

ALTER TABLE [dbo].[BankReconciliations] WITH CHECK CHECK CONSTRAINT [FK_BankReconciliations_BankAccount];

ALTER TABLE [dbo].[Payments] WITH CHECK CHECK CONSTRAINT [FK_Payments_Accounts];

ALTER TABLE [dbo].[BillPayments] WITH CHECK CHECK CONSTRAINT [FK_BillPayments_Accounts];

ALTER TABLE [dbo].[CreditMemoLines] WITH CHECK CHECK CONSTRAINT [FK_CreditMemoLines_Accounts];

ALTER TABLE [dbo].[BillLines] WITH CHECK CHECK CONSTRAINT [FK_BillLines_Accounts];

ALTER TABLE [dbo].[ProductsServices] WITH CHECK CHECK CONSTRAINT [FK_ProductsServices_IncomeAccount];

ALTER TABLE [dbo].[BankTransactions] WITH CHECK CHECK CONSTRAINT [FK_BankTransactions_ApprovedAccount];

ALTER TABLE [dbo].[CustomerDeposits] WITH CHECK CHECK CONSTRAINT [FK_CustomerDeposits_DepositAccount];

ALTER TABLE [dbo].[CustomerDeposits] WITH CHECK CHECK CONSTRAINT [FK_CustomerDeposits_LiabilityAccount];

ALTER TABLE [dbo].[SalesReceiptLines] WITH CHECK CHECK CONSTRAINT [FK_SalesReceiptLines_Accounts];

ALTER TABLE [dbo].[ProductsServices] WITH CHECK CHECK CONSTRAINT [FK_ProductsServices_ExpenseAccount];

ALTER TABLE [dbo].[InvoiceLines] WITH CHECK CHECK CONSTRAINT [FK_InvoiceLines_RevenueAccount];

ALTER TABLE [dbo].[BankTransactionImports] WITH CHECK CHECK CONSTRAINT [FK_BankTransactionImports_Accounts];

ALTER TABLE [dbo].[Bills] WITH CHECK CHECK CONSTRAINT [FK_Bills_Vendors];

ALTER TABLE [dbo].[PurchaseOrders] WITH CHECK CHECK CONSTRAINT [FK_PurchaseOrders_Bills];

ALTER TABLE [dbo].[BillLines] WITH CHECK CHECK CONSTRAINT [FK_BillLines_Bills];

ALTER TABLE [dbo].[BillPaymentApplications] WITH CHECK CHECK CONSTRAINT [FK_BillPaymentApplications_Bills];

ALTER TABLE [dbo].[VendorCreditApplications] WITH CHECK CHECK CONSTRAINT [FK_VendorCreditApplications_Bills];

ALTER TABLE [dbo].[MileageTrips] WITH CHECK CHECK CONSTRAINT [FK_MileageTrips_Customers];

ALTER TABLE [dbo].[Invoices] WITH CHECK CHECK CONSTRAINT [FK_Invoices_Customers];

ALTER TABLE [dbo].[Estimates] WITH CHECK CHECK CONSTRAINT [FK_Estimates_Customers];

ALTER TABLE [dbo].[SalesReceipts] WITH CHECK CHECK CONSTRAINT [FK_SalesReceipts_Customers];

ALTER TABLE [dbo].[CreditMemos] WITH CHECK CHECK CONSTRAINT [FK_CreditMemos_Customers];

ALTER TABLE [dbo].[Payments] WITH CHECK CHECK CONSTRAINT [FK_Payments_Customers];

ALTER TABLE [dbo].[Expenses] WITH CHECK CHECK CONSTRAINT [FK_Expenses_Customers];

ALTER TABLE [dbo].[BankRules] WITH CHECK CHECK CONSTRAINT [FK_BankRules_AssignCustomer];

ALTER TABLE [dbo].[CustomerDeposits] WITH CHECK CHECK CONSTRAINT [FK_CustomerDeposits_Customers];

ALTER TABLE [dbo].[TimeEntries] WITH CHECK CHECK CONSTRAINT [FK_TimeEntries_Customers];

ALTER TABLE [dbo].[Projects] WITH CHECK CHECK CONSTRAINT [FK_Projects_Customers];

ALTER TABLE [dbo].[Refunds] WITH CHECK CHECK CONSTRAINT [FK_Refunds_Customers];

ALTER TABLE [dbo].[EmployeeWorkStates] WITH CHECK CHECK CONSTRAINT [FK_EmployeeWorkStates_Employee];

ALTER TABLE [dbo].[PayStubs] WITH CHECK CHECK CONSTRAINT [FK_PayStubs_Employee];

ALTER TABLE [dbo].[Receipts] WITH CHECK CHECK CONSTRAINT [FK_Receipts_Expenses];

ALTER TABLE [dbo].[Expenses] WITH CHECK CHECK CONSTRAINT [FK_Expenses_Projects];

ALTER TABLE [dbo].[Expenses] WITH CHECK CHECK CONSTRAINT [FK_Expenses_Classes];

ALTER TABLE [dbo].[Expenses] WITH CHECK CHECK CONSTRAINT [FK_Expenses_BankTransactions];

ALTER TABLE [dbo].[Expenses] WITH CHECK CHECK CONSTRAINT [FK_Expenses_JournalEntries];

ALTER TABLE [dbo].[Expenses] WITH CHECK CHECK CONSTRAINT [FK_Expenses_Vendors];

ALTER TABLE [dbo].[MileageTrips] WITH CHECK CHECK CONSTRAINT [FK_MileageTrips_Projects];

ALTER TABLE [dbo].[MileageTrips] WITH CHECK CHECK CONSTRAINT [FK_MileageTrips_Vehicles];

ALTER TABLE [dbo].[PaymentApplications] WITH CHECK CHECK CONSTRAINT [FK_PaymentApplications_Payments];

ALTER TABLE [dbo].[InventoryTransactions] WITH CHECK CHECK CONSTRAINT [FK_InventoryTransactions_Product];

ALTER TABLE [dbo].[PurchaseOrderLines] WITH CHECK CHECK CONSTRAINT [FK_PurchaseOrderLines_ProductsServices];

ALTER TABLE [dbo].[ProductsServices] WITH CHECK CHECK CONSTRAINT [FK_ProductsServices_DefaultLocation];

ALTER TABLE [dbo].[VendorCreditLines] WITH CHECK CHECK CONSTRAINT [FK_VendorCreditLines_ProductsServices];

ALTER TABLE [dbo].[EstimateLines] WITH CHECK CHECK CONSTRAINT [FK_EstimateLines_ProductsServices];

ALTER TABLE [dbo].[CreditMemoLines] WITH CHECK CHECK CONSTRAINT [FK_CreditMemoLines_ProductsServices];

ALTER TABLE [dbo].[SalesReceiptLines] WITH CHECK CHECK CONSTRAINT [FK_SalesReceiptLines_ProductsServices];

ALTER TABLE [dbo].[InvoiceLines] WITH CHECK CHECK CONSTRAINT [FK_InvoiceLines_ProductsServices];

ALTER TABLE [dbo].[SalesReceiptLines] WITH CHECK CHECK CONSTRAINT [FK_SalesReceiptLines_SalesReceipts];

ALTER TABLE [dbo].[SalesReceipts] WITH CHECK CHECK CONSTRAINT [FK_SalesReceipts_TaxRates];

ALTER TABLE [dbo].[SalesReceipts] WITH CHECK CHECK CONSTRAINT [FK_SalesReceipts_JournalEntries];

ALTER TABLE [dbo].[SalesReceipts] WITH CHECK CHECK CONSTRAINT [FK_SalesReceipts_Classes];

ALTER TABLE [dbo].[SalesReceipts] WITH CHECK CHECK CONSTRAINT [FK_SalesReceipts_Locations];

ALTER TABLE [dbo].[SalesReceiptLines] WITH CHECK CHECK CONSTRAINT [FK_SalesReceiptLines_TaxRates];

ALTER TABLE [dbo].[Invoices] WITH CHECK CHECK CONSTRAINT [FK_Invoices_TaxRates];

ALTER TABLE [dbo].[TaxCalculationSettings] WITH CHECK CHECK CONSTRAINT [FK_TaxCalcSettings_TaxRates];

ALTER TABLE [dbo].[VendorCredits] WITH CHECK CHECK CONSTRAINT [FK_VendorCredits_Vendors];

ALTER TABLE [dbo].[PurchaseOrders] WITH CHECK CHECK CONSTRAINT [FK_PurchaseOrders_Vendors];

ALTER TABLE [dbo].[BankRules] WITH CHECK CHECK CONSTRAINT [FK_BankRules_AssignVendor];

ALTER TABLE [dbo].[BillPayments] WITH CHECK CHECK CONSTRAINT [FK_BillPayments_Vendors];

ALTER TABLE [dbo].[YearEndCloseEntries] WITH CHECK CHECK CONSTRAINT [FK_YearEndCloseEntries_Accounts];

ALTER TABLE [dbo].[YearEndCloseEntries] WITH CHECK CHECK CONSTRAINT [FK_YearEndCloseEntries_JournalEntries];

ALTER TABLE [dbo].[YearEndCloseEntries] WITH CHECK CHECK CONSTRAINT [FK_YearEndCloseEntries_AccountingPeriods];

ALTER TABLE [dbo].[SubmissionAttachments] WITH CHECK CHECK CONSTRAINT [FK_SubmissionAttachments_Submissions];

ALTER TABLE [dbo].[ProductsServices] WITH CHECK CHECK CONSTRAINT [CK_ProductsServices_Status];

ALTER TABLE [dbo].[ProductsServices] WITH CHECK CHECK CONSTRAINT [CK_ProductsServices_Type];

ALTER TABLE [dbo].[ProductsServices] WITH CHECK CHECK CONSTRAINT [CK_ProductsServices_ValuationMethod];

ALTER TABLE [dbo].[VendorCredits] WITH CHECK CHECK CONSTRAINT [CK_VendorCredits_Status];

ALTER TABLE [dbo].[AuditLog] WITH CHECK CHECK CONSTRAINT [CK_AuditLog_Action];

ALTER TABLE [dbo].[BankRules] WITH CHECK CHECK CONSTRAINT [CK_BankRules_MatchField];

ALTER TABLE [dbo].[BankRules] WITH CHECK CHECK CONSTRAINT [CK_BankRules_MatchType];

ALTER TABLE [dbo].[BankRules] WITH CHECK CHECK CONSTRAINT [CK_BankRules_TransactionType];

ALTER TABLE [dbo].[CreditMemos] WITH CHECK CHECK CONSTRAINT [CK_CreditMemos_Status];

ALTER TABLE [dbo].[CustomerDeposits] WITH CHECK CHECK CONSTRAINT [CK_CustomerDeposits_Status];

ALTER TABLE [dbo].[InventoryLocations] WITH CHECK CHECK CONSTRAINT [CK_InventoryLocations_Status];

ALTER TABLE [dbo].[InventoryTransactions] WITH CHECK CHECK CONSTRAINT [CK_InventoryTransactions_TransactionType];

ALTER TABLE [dbo].[RecurringSchedules] WITH CHECK CHECK CONSTRAINT [CHK_RecurringSchedules_Status];

ALTER TABLE [dbo].[RecurringSchedules] WITH CHECK CHECK CONSTRAINT [CHK_RecurringSchedules_TransactionType];

ALTER TABLE [dbo].[RecurringTemplates] WITH CHECK CHECK CONSTRAINT [CHK_RecurringTemplates_Frequency];

ALTER TABLE [dbo].[RecurringTemplates] WITH CHECK CHECK CONSTRAINT [CHK_RecurringTemplates_Status];

ALTER TABLE [dbo].[RecurringTemplates] WITH CHECK CHECK CONSTRAINT [CHK_RecurringTemplates_TransactionType];

ALTER TABLE [dbo].[Refunds] WITH CHECK CHECK CONSTRAINT [CK_Refunds_Status];

ALTER TABLE [dbo].[TaxCalculationSettings] WITH CHECK CHECK CONSTRAINT [CK_TaxCalcSettings_Method];

ALTER TABLE [dbo].[Tenants] WITH CHECK CHECK CONSTRAINT [CK_Tenants_SubscriptionTier];

ALTER TABLE [dbo].[Users] WITH CHECK CHECK CONSTRAINT [CK_Users_AuthProvider];

ALTER TABLE [dbo].[Deployments] WITH CHECK CHECK CONSTRAINT [CK_Deployments_Status];

ALTER TABLE [dbo].[Enhancements] WITH CHECK CHECK CONSTRAINT [CK_Enhancements_Status];

ALTER TABLE [dbo].[Submissions] WITH CHECK CHECK CONSTRAINT [CK_Submissions_Priority];

ALTER TABLE [dbo].[Submissions] WITH CHECK CHECK CONSTRAINT [CK_Submissions_Status];

ALTER TABLE [dbo].[Submissions] WITH CHECK CHECK CONSTRAINT [CK_Submissions_Type];


GO
PRINT N'Update complete.';


GO
